{
  "nbformat": 4,
  "nbformat_minor": 0,
  "metadata": {
    "colab": {
      "provenance": [],
      "gpuType": "T4"
    },
    "kernelspec": {
      "name": "python3",
      "display_name": "Python 3"
    },
    "language_info": {
      "name": "python"
    },
    "accelerator": "GPU",
    "widgets": {
      "application/vnd.jupyter.widget-state+json": {
        "09b5f1e4e915457ca2bf70d4bfde96e5": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_c72e20d4d4c449ad9ca97dc7cdb0108a",
              "IPY_MODEL_1e5b0571afc247f587fa8be0c499ed0a",
              "IPY_MODEL_a128750574454adda07535ab3f143306"
            ],
            "layout": "IPY_MODEL_cc0dfb9dda4b46eebebd8905ce2699eb"
          }
        },
        "c72e20d4d4c449ad9ca97dc7cdb0108a": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_13005411d6de49a2ad937f14f65daaf9",
            "placeholder": "​",
            "style": "IPY_MODEL_e76faf33c10f4e9aa96dd668a9c269b3",
            "value": "config.json: 100%"
          }
        },
        "1e5b0571afc247f587fa8be0c499ed0a": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_5193f699630e4888add51c8273032ae6",
            "max": 629,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_dac1284edc434b42a82931e74e4f1899",
            "value": 629
          }
        },
        "a128750574454adda07535ab3f143306": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_b0f36841774842b6b259c36f90344fec",
            "placeholder": "​",
            "style": "IPY_MODEL_b3b6e718b62a47c2991a97754ef1b602",
            "value": " 629/629 [00:00&lt;00:00, 61.4kB/s]"
          }
        },
        "cc0dfb9dda4b46eebebd8905ce2699eb": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "13005411d6de49a2ad937f14f65daaf9": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "e76faf33c10f4e9aa96dd668a9c269b3": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "5193f699630e4888add51c8273032ae6": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "dac1284edc434b42a82931e74e4f1899": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "b0f36841774842b6b259c36f90344fec": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "b3b6e718b62a47c2991a97754ef1b602": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "199d7c6c673b419f970294e08e2e0166": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_3069e046272f4049ac51258ec491d81a",
              "IPY_MODEL_f0a3253e61fa41a0a00f0a93d8fd03b1",
              "IPY_MODEL_3e13927cd5f9462299db03a330b60a0b"
            ],
            "layout": "IPY_MODEL_d8764e5192944439a838572c849b2290"
          }
        },
        "3069e046272f4049ac51258ec491d81a": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_d8b4229e16bc450fb7cc4973e48d0c14",
            "placeholder": "​",
            "style": "IPY_MODEL_abebe936ff904ca2a90bc912813139f2",
            "value": "model.safetensors: 100%"
          }
        },
        "f0a3253e61fa41a0a00f0a93d8fd03b1": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_c650ebe33046415d9e5cad777efa7a3c",
            "max": 1421495516,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_a5e973b3a1954de7bb4c8578c3990ccc",
            "value": 1421495516
          }
        },
        "3e13927cd5f9462299db03a330b60a0b": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_50d1fcc69381452bbe2786fcc9b79c67",
            "placeholder": "​",
            "style": "IPY_MODEL_8afcad4bdd6a493491c9ca893c0008b0",
            "value": " 1.42G/1.42G [00:29&lt;00:00, 62.5MB/s]"
          }
        },
        "d8764e5192944439a838572c849b2290": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "d8b4229e16bc450fb7cc4973e48d0c14": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "abebe936ff904ca2a90bc912813139f2": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "c650ebe33046415d9e5cad777efa7a3c": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "a5e973b3a1954de7bb4c8578c3990ccc": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "50d1fcc69381452bbe2786fcc9b79c67": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "8afcad4bdd6a493491c9ca893c0008b0": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "f24c6faf34c441b1abd3a8a29b87dbe2": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_51a04756889d453a9e8431e8804ebf78",
              "IPY_MODEL_55887ee3451740ceaf25f82d68c8e693",
              "IPY_MODEL_08be1db8aae644bd941443a2644d5ed8"
            ],
            "layout": "IPY_MODEL_ea88633b1e5643cb81b07f0fa8f56034"
          }
        },
        "51a04756889d453a9e8431e8804ebf78": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_ae537262e3994156b850e14ccf995473",
            "placeholder": "​",
            "style": "IPY_MODEL_40a0edfa9e984217a52c336dc0ec8a1b",
            "value": "tokenizer_config.json: "
          }
        },
        "55887ee3451740ceaf25f82d68c8e693": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_6183b389a2c0499093c09c9b7f46c87b",
            "max": 1,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_8883ce6882464dfdaf843bf9f09cbc5e",
            "value": 1
          }
        },
        "08be1db8aae644bd941443a2644d5ed8": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_7b27cf35428949378658a5b480b981a2",
            "placeholder": "​",
            "style": "IPY_MODEL_06610b1cef544b5f86a8483f35d7ad52",
            "value": " 1.33k/? [00:00&lt;00:00, 142kB/s]"
          }
        },
        "ea88633b1e5643cb81b07f0fa8f56034": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "ae537262e3994156b850e14ccf995473": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "40a0edfa9e984217a52c336dc0ec8a1b": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "6183b389a2c0499093c09c9b7f46c87b": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": "20px"
          }
        },
        "8883ce6882464dfdaf843bf9f09cbc5e": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "7b27cf35428949378658a5b480b981a2": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "06610b1cef544b5f86a8483f35d7ad52": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "142e95a07703441e8235227fb8bb9474": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_c95221df669c4a538a1040f70b9c5a43",
              "IPY_MODEL_8efe281f362f4aa9a36ac4594f396768",
              "IPY_MODEL_9b86857b1e2847afaa8a00653e36de83"
            ],
            "layout": "IPY_MODEL_f9bc9132e186435eb89a4248b676f425"
          }
        },
        "c95221df669c4a538a1040f70b9c5a43": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_b04a600f949d4290a48e2ebb4a7587d9",
            "placeholder": "​",
            "style": "IPY_MODEL_b23a4231f5094e80a8242af51e0035bc",
            "value": "vocab.json: "
          }
        },
        "8efe281f362f4aa9a36ac4594f396768": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_d1107661d1aa48c590b677d73244af25",
            "max": 1,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_9b35bdab71d84a89a14786ec94d64068",
            "value": 1
          }
        },
        "9b86857b1e2847afaa8a00653e36de83": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_5fb1accd05ac49a9acefa1ff4329440e",
            "placeholder": "​",
            "style": "IPY_MODEL_75ac1fe59aaf4d1293153dfac7e5996e",
            "value": " 798k/? [00:00&lt;00:00, 1.12MB/s]"
          }
        },
        "f9bc9132e186435eb89a4248b676f425": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "b04a600f949d4290a48e2ebb4a7587d9": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "b23a4231f5094e80a8242af51e0035bc": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "d1107661d1aa48c590b677d73244af25": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": "20px"
          }
        },
        "9b35bdab71d84a89a14786ec94d64068": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "5fb1accd05ac49a9acefa1ff4329440e": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "75ac1fe59aaf4d1293153dfac7e5996e": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "c2bbf39478be49358fa775a498b76b58": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_b96afdb284db4c8e9bb4dac5360bf432",
              "IPY_MODEL_18bb7b01808e40128c8685457be05b6a",
              "IPY_MODEL_b89db6210af84cd7aef80f4ebfe9ff18"
            ],
            "layout": "IPY_MODEL_4e5317ae06cc434095769c547b2f6f6f"
          }
        },
        "b96afdb284db4c8e9bb4dac5360bf432": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_eac10115bbd0425b93826aa0a3998878",
            "placeholder": "​",
            "style": "IPY_MODEL_96f6616f1047414694ea183e8bb23cd8",
            "value": "merges.txt: "
          }
        },
        "18bb7b01808e40128c8685457be05b6a": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_61779299760944fda534fee3cf1da2e1",
            "max": 1,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_1ee66368c10746788314639987e81504",
            "value": 1
          }
        },
        "b89db6210af84cd7aef80f4ebfe9ff18": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_9659de0f0985461886faa3a9e75e7d32",
            "placeholder": "​",
            "style": "IPY_MODEL_836b5406ed6e496ca8781245e44142ee",
            "value": " 456k/? [00:00&lt;00:00, 6.78MB/s]"
          }
        },
        "4e5317ae06cc434095769c547b2f6f6f": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "eac10115bbd0425b93826aa0a3998878": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "96f6616f1047414694ea183e8bb23cd8": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "61779299760944fda534fee3cf1da2e1": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": "20px"
          }
        },
        "1ee66368c10746788314639987e81504": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "9659de0f0985461886faa3a9e75e7d32": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "836b5406ed6e496ca8781245e44142ee": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "695eb59bb62748a7b0562824d6b9ad49": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_f17ad7b6c61c48ad8bad54b6dd839b3c",
              "IPY_MODEL_a08e31ff21904e7ea201d51d3dd1b5b7",
              "IPY_MODEL_0368f78592f94a06a65aca73e7594147"
            ],
            "layout": "IPY_MODEL_337cd0ca29834aacab439742a102a1dc"
          }
        },
        "f17ad7b6c61c48ad8bad54b6dd839b3c": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_f7271c864fde4a01be2f17745d115666",
            "placeholder": "​",
            "style": "IPY_MODEL_94166791d1ba43b2bd09aae63ce095f6",
            "value": "tokenizer.json: "
          }
        },
        "a08e31ff21904e7ea201d51d3dd1b5b7": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_d0e1f9b4bad141e79e975b0d2c4e2177",
            "max": 1,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_271e563038ae429f9038dfae5bd954fa",
            "value": 1
          }
        },
        "0368f78592f94a06a65aca73e7594147": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_0c41773e6d3c4a10a4b9a72194098424",
            "placeholder": "​",
            "style": "IPY_MODEL_17757038d23541ebbbac3d37e2aa6e85",
            "value": " 3.56M/? [00:00&lt;00:00, 17.7MB/s]"
          }
        },
        "337cd0ca29834aacab439742a102a1dc": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "f7271c864fde4a01be2f17745d115666": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "94166791d1ba43b2bd09aae63ce095f6": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "d0e1f9b4bad141e79e975b0d2c4e2177": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": "20px"
          }
        },
        "271e563038ae429f9038dfae5bd954fa": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "0c41773e6d3c4a10a4b9a72194098424": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "17757038d23541ebbbac3d37e2aa6e85": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "44bad325f8924a9d8a9f142092ef54c3": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_e224de5282d44c07ad2b51f3abf8c0f5",
              "IPY_MODEL_bb07d5f9f8ea43fcb71a6ac87297c931",
              "IPY_MODEL_afb539fe1b994a36b923ea62822bc192"
            ],
            "layout": "IPY_MODEL_eac12633d31d477bad0c3e56281c2939"
          }
        },
        "e224de5282d44c07ad2b51f3abf8c0f5": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_3a64ba2223f54f788b25a15726154227",
            "placeholder": "​",
            "style": "IPY_MODEL_5d5e02909fdb49f7a8cd35c40b99abe0",
            "value": "special_tokens_map.json: "
          }
        },
        "bb07d5f9f8ea43fcb71a6ac87297c931": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_7f188c98477e4d73a772db04713bab2a",
            "max": 1,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_3ec6dd613dd24469b669ab8300ffa1bf",
            "value": 1
          }
        },
        "afb539fe1b994a36b923ea62822bc192": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_0ef2661e79b24bfb9890b160a276fb32",
            "placeholder": "​",
            "style": "IPY_MODEL_02bdc2268b40439bbf18d2fe095e8a81",
            "value": " 1.01k/? [00:00&lt;00:00, 116kB/s]"
          }
        },
        "eac12633d31d477bad0c3e56281c2939": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "3a64ba2223f54f788b25a15726154227": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "5d5e02909fdb49f7a8cd35c40b99abe0": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "7f188c98477e4d73a772db04713bab2a": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": "20px"
          }
        },
        "3ec6dd613dd24469b669ab8300ffa1bf": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "0ef2661e79b24bfb9890b160a276fb32": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "02bdc2268b40439bbf18d2fe095e8a81": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "ff172bba325d476c969dbbde23194ffe": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HBoxModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HBoxModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HBoxView",
            "box_style": "",
            "children": [
              "IPY_MODEL_950d8cff561843d28b8babedf4800e47",
              "IPY_MODEL_b87833978ee549f6afe5dbeee7bfc919",
              "IPY_MODEL_0a8ad999794f4b6e95174d8e8a89434a"
            ],
            "layout": "IPY_MODEL_8453c76b047947dda0efc1b15f59858a"
          }
        },
        "950d8cff561843d28b8babedf4800e47": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_2c8ac80910bf4a739b3e66fdc0465f5b",
            "placeholder": "​",
            "style": "IPY_MODEL_0a341e67003842c8bd017361c1f8cc59",
            "value": "README.md: "
          }
        },
        "b87833978ee549f6afe5dbeee7bfc919": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "FloatProgressModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "FloatProgressModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "ProgressView",
            "bar_style": "success",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_5e69dd06a98b4cdcbe670d16a323e85b",
            "max": 1,
            "min": 0,
            "orientation": "horizontal",
            "style": "IPY_MODEL_53670c12f42a48fa904fc6b3eb5267b4",
            "value": 1
          }
        },
        "0a8ad999794f4b6e95174d8e8a89434a": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "HTMLModel",
          "model_module_version": "1.5.0",
          "state": {
            "_dom_classes": [],
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "HTMLModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/controls",
            "_view_module_version": "1.5.0",
            "_view_name": "HTMLView",
            "description": "",
            "description_tooltip": null,
            "layout": "IPY_MODEL_129a5014c6c04988913143251fd7b980",
            "placeholder": "​",
            "style": "IPY_MODEL_9bfbffca3bea45b082d870eca9537ae3",
            "value": " 1.14k/? [00:00&lt;00:00, 109kB/s]"
          }
        },
        "8453c76b047947dda0efc1b15f59858a": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "2c8ac80910bf4a739b3e66fdc0465f5b": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "0a341e67003842c8bd017361c1f8cc59": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        },
        "5e69dd06a98b4cdcbe670d16a323e85b": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": "20px"
          }
        },
        "53670c12f42a48fa904fc6b3eb5267b4": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "ProgressStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "ProgressStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "bar_color": null,
            "description_width": ""
          }
        },
        "129a5014c6c04988913143251fd7b980": {
          "model_module": "@jupyter-widgets/base",
          "model_name": "LayoutModel",
          "model_module_version": "1.2.0",
          "state": {
            "_model_module": "@jupyter-widgets/base",
            "_model_module_version": "1.2.0",
            "_model_name": "LayoutModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "LayoutView",
            "align_content": null,
            "align_items": null,
            "align_self": null,
            "border": null,
            "bottom": null,
            "display": null,
            "flex": null,
            "flex_flow": null,
            "grid_area": null,
            "grid_auto_columns": null,
            "grid_auto_flow": null,
            "grid_auto_rows": null,
            "grid_column": null,
            "grid_gap": null,
            "grid_row": null,
            "grid_template_areas": null,
            "grid_template_columns": null,
            "grid_template_rows": null,
            "height": null,
            "justify_content": null,
            "justify_items": null,
            "left": null,
            "margin": null,
            "max_height": null,
            "max_width": null,
            "min_height": null,
            "min_width": null,
            "object_fit": null,
            "object_position": null,
            "order": null,
            "overflow": null,
            "overflow_x": null,
            "overflow_y": null,
            "padding": null,
            "right": null,
            "top": null,
            "visibility": null,
            "width": null
          }
        },
        "9bfbffca3bea45b082d870eca9537ae3": {
          "model_module": "@jupyter-widgets/controls",
          "model_name": "DescriptionStyleModel",
          "model_module_version": "1.5.0",
          "state": {
            "_model_module": "@jupyter-widgets/controls",
            "_model_module_version": "1.5.0",
            "_model_name": "DescriptionStyleModel",
            "_view_count": null,
            "_view_module": "@jupyter-widgets/base",
            "_view_module_version": "1.2.0",
            "_view_name": "StyleView",
            "description_width": ""
          }
        }
      }
    }
  },
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "f8c29b28"
      },
      "source": [
        "# Task\n",
        "Create a project to learn and compare advanced retrieval techniques using a real-world scenario and a provided PDF document. The project should involve implementing several retrieval methods, including naive approaches and advanced techniques from the provided list, and evaluating their performance on the dataset derived from the PDF and potentially other sources. The project should also include detailed explanations of the implemented advanced techniques."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "0ff9f5e8"
      },
      "source": [
        "## Project definition\n",
        "\n",
        "### Subtask:\n",
        "Define a real-world project scenario where advanced retrieval techniques can be applied.\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "3f1e83d2"
      },
      "source": [
        "**Reasoning**:\n",
        "Define a real-world project scenario, its scope, and objectives for applying advanced retrieval techniques.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "60e6775a",
        "outputId": "accd3358-9752-4cbb-846e-73c9e82dfb88"
      },
      "source": [
        "# Define the real-world project scenario\n",
        "scenario = \"\"\"\n",
        "Scenario: Building a Legal Case Research Assistant\n",
        "\n",
        "A law firm needs an efficient way to research relevant case law and legal documents for their ongoing cases.\n",
        "They have a vast internal database of legal documents, including past case filings, court opinions, legal briefs, and research papers,\n",
        "as well as access to public legal databases. Manually sifting through these documents is time-consuming and can lead to missed\n",
        "relevant information. They need a system that can quickly and accurately retrieve the most pertinent documents based on a query\n",
        "related to a specific legal issue or fact pattern.\n",
        "\"\"\"\n",
        "\n",
        "# Define the scope of the project\n",
        "scope = \"\"\"\n",
        "Scope:\n",
        "- The project will focus on retrieving legal documents from a provided collection (initially a PDF document containing case law\n",
        "  summaries or a section of a legal textbook, and potentially expanding to other formats and sources).\n",
        "- The type of information to be retrieved will be specific legal precedents, arguments, and relevant facts related to a user's query.\n",
        "- Expected use cases include:\n",
        "    - Finding similar cases to a current one.\n",
        "    - Identifying relevant statutes or regulations.\n",
        "    - Gathering supporting arguments for a legal brief.\n",
        "    - Researching the history of a particular legal issue.\n",
        "\"\"\"\n",
        "\n",
        "# State the objectives of the project\n",
        "objectives = \"\"\"\n",
        "Objectives:\n",
        "- To implement and compare the performance of various retrieval techniques, including naive methods (e.g., keyword matching)\n",
        "  and advanced techniques (e.g., vector embeddings, semantic search, potentially incorporating legal domain-specific knowledge).\n",
        "- To evaluate the accuracy and efficiency of each technique based on metrics such as precision, recall, and retrieval time.\n",
        "- To demonstrate how advanced retrieval techniques can significantly improve the speed and relevance of legal research compared to traditional methods.\n",
        "- To provide a clear explanation of the implemented advanced techniques and their advantages in this specific legal context.\n",
        "\"\"\"\n",
        "\n",
        "print(scenario)\n",
        "print(scope)\n",
        "print(objectives)"
      ],
      "execution_count": 1,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "\n",
            "Scenario: Building a Legal Case Research Assistant\n",
            "\n",
            "A law firm needs an efficient way to research relevant case law and legal documents for their ongoing cases.\n",
            "They have a vast internal database of legal documents, including past case filings, court opinions, legal briefs, and research papers,\n",
            "as well as access to public legal databases. Manually sifting through these documents is time-consuming and can lead to missed\n",
            "relevant information. They need a system that can quickly and accurately retrieve the most pertinent documents based on a query\n",
            "related to a specific legal issue or fact pattern.\n",
            "\n",
            "\n",
            "Scope:\n",
            "- The project will focus on retrieving legal documents from a provided collection (initially a PDF document containing case law\n",
            "  summaries or a section of a legal textbook, and potentially expanding to other formats and sources).\n",
            "- The type of information to be retrieved will be specific legal precedents, arguments, and relevant facts related to a user's query.\n",
            "- Expected use cases include:\n",
            "    - Finding similar cases to a current one.\n",
            "    - Identifying relevant statutes or regulations.\n",
            "    - Gathering supporting arguments for a legal brief.\n",
            "    - Researching the history of a particular legal issue.\n",
            "\n",
            "\n",
            "Objectives:\n",
            "- To implement and compare the performance of various retrieval techniques, including naive methods (e.g., keyword matching)\n",
            "  and advanced techniques (e.g., vector embeddings, semantic search, potentially incorporating legal domain-specific knowledge).\n",
            "- To evaluate the accuracy and efficiency of each technique based on metrics such as precision, recall, and retrieval time.\n",
            "- To demonstrate how advanced retrieval techniques can significantly improve the speed and relevance of legal research compared to traditional methods.\n",
            "- To provide a clear explanation of the implemented advanced techniques and their advantages in this specific legal context.\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "a9eeb47b"
      },
      "source": [
        "## Data acquisition and preparation\n",
        "\n",
        "### Subtask:\n",
        "Use the provided sample PDF and potentially other relevant data to create a dataset. This will involve extracting text from the PDF, cleaning the data, and structuring it for retrieval.\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "d14178f1"
      },
      "source": [
        "**Reasoning**:\n",
        "Load the provided PDF document and extract the text content. Then clean the extracted text by removing irrelevant characters and structure it into a dataset.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "!pip install PyMuPDF"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "SSJAM5pYlwZB",
        "outputId": "29b6a616-837a-4161-9ede-075d2966d23a"
      },
      "execution_count": 2,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Requirement already satisfied: PyMuPDF in /usr/local/lib/python3.12/dist-packages (1.26.5)\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 406
        },
        "id": "b5579ea5",
        "outputId": "5ae2ac2c-f9d7-4b78-9352-33f14d2d5850"
      },
      "source": [
        "import pandas as pd\n",
        "import json\n",
        "\n",
        "# Define the path to the JSON file containing the document chunks\n",
        "json_path = './data/legal_chunks_conceptual.json'\n",
        "\n",
        "# Load the JSON data\n",
        "with open(json_path, 'r') as f:\n",
        "    # Assuming the JSON file contains a list of dictionaries,\n",
        "    # where each dictionary represents a chunk and has a 'text' key\n",
        "    # Adjust the loading logic if your JSON structure is different\n",
        "    json_data = json.load(f)\n",
        "\n",
        "# Create a pandas DataFrame from the JSON data\n",
        "# Assuming the JSON is a list of chunk objects, e.g., [{'text': 'chunk1'}, {'text': 'chunk2'}, ...]\n",
        "# If your JSON structure is different, you might need to adjust this line\n",
        "df = pd.DataFrame(json_data)\n",
        "\n",
        "print(f\"Loaded {len(df)} chunks from '{json_path}'.\")\n",
        "display(df.head())\n",
        "display(df.info())"
      ],
      "execution_count": 3,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Loaded 46 chunks from './data/legal_chunks_conceptual.json'.\n"
          ]
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "  chunk_id                                               text\n",
              "0  chunk_0  BOARD OF GOVERNORS  New York State Unified Cou...\n",
              "1  chunk_1  Herrick v. Lyon 7 A.D. 3d 571, 777 N.Y.S.2d 14...\n",
              "2  chunk_2  Rotker v. Rotker, 195 Misc.2d 768,777, 761 N.Y...\n",
              "3  chunk_3  Gottlieb v. Marusya , 2004 NY Slip Op 51816U; ...\n",
              "4  chunk_4  Sieratzki v. Sei Global, 2009 WL 4009128, 2009..."
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-726777a6-d43e-4cd3-9602-c0d447750595\" class=\"colab-df-container\">\n",
              "    <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>chunk_id</th>\n",
              "      <th>text</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>chunk_0</td>\n",
              "      <td>BOARD OF GOVERNORS  New York State Unified Cou...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>chunk_1</td>\n",
              "      <td>Herrick v. Lyon 7 A.D. 3d 571, 777 N.Y.S.2d 14...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>chunk_2</td>\n",
              "      <td>Rotker v. Rotker, 195 Misc.2d 768,777, 761 N.Y...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>chunk_3</td>\n",
              "      <td>Gottlieb v. Marusya , 2004 NY Slip Op 51816U; ...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>chunk_4</td>\n",
              "      <td>Sieratzki v. Sei Global, 2009 WL 4009128, 2009...</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "    <div class=\"colab-df-buttons\">\n",
              "\n",
              "  <div class=\"colab-df-container\">\n",
              "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-726777a6-d43e-4cd3-9602-c0d447750595')\"\n",
              "            title=\"Convert this dataframe to an interactive table.\"\n",
              "            style=\"display:none;\">\n",
              "\n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
              "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
              "  </svg>\n",
              "    </button>\n",
              "\n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    .colab-df-buttons div {\n",
              "      margin-bottom: 4px;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "    <script>\n",
              "      const buttonEl =\n",
              "        document.querySelector('#df-726777a6-d43e-4cd3-9602-c0d447750595 button.colab-df-convert');\n",
              "      buttonEl.style.display =\n",
              "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "      async function convertToInteractive(key) {\n",
              "        const element = document.querySelector('#df-726777a6-d43e-4cd3-9602-c0d447750595');\n",
              "        const dataTable =\n",
              "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                    [key], {});\n",
              "        if (!dataTable) return;\n",
              "\n",
              "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "          + ' to learn more about interactive tables.';\n",
              "        element.innerHTML = '';\n",
              "        dataTable['output_type'] = 'display_data';\n",
              "        await google.colab.output.renderOutput(dataTable, element);\n",
              "        const docLink = document.createElement('div');\n",
              "        docLink.innerHTML = docLinkHtml;\n",
              "        element.appendChild(docLink);\n",
              "      }\n",
              "    </script>\n",
              "  </div>\n",
              "\n",
              "\n",
              "    <div id=\"df-23f358f4-fd03-4db6-a369-41f9a3546e07\">\n",
              "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-23f358f4-fd03-4db6-a369-41f9a3546e07')\"\n",
              "                title=\"Suggest charts\"\n",
              "                style=\"display:none;\">\n",
              "\n",
              "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "     width=\"24px\">\n",
              "    <g>\n",
              "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
              "    </g>\n",
              "</svg>\n",
              "      </button>\n",
              "\n",
              "<style>\n",
              "  .colab-df-quickchart {\n",
              "      --bg-color: #E8F0FE;\n",
              "      --fill-color: #1967D2;\n",
              "      --hover-bg-color: #E2EBFA;\n",
              "      --hover-fill-color: #174EA6;\n",
              "      --disabled-fill-color: #AAA;\n",
              "      --disabled-bg-color: #DDD;\n",
              "  }\n",
              "\n",
              "  [theme=dark] .colab-df-quickchart {\n",
              "      --bg-color: #3B4455;\n",
              "      --fill-color: #D2E3FC;\n",
              "      --hover-bg-color: #434B5C;\n",
              "      --hover-fill-color: #FFFFFF;\n",
              "      --disabled-bg-color: #3B4455;\n",
              "      --disabled-fill-color: #666;\n",
              "  }\n",
              "\n",
              "  .colab-df-quickchart {\n",
              "    background-color: var(--bg-color);\n",
              "    border: none;\n",
              "    border-radius: 50%;\n",
              "    cursor: pointer;\n",
              "    display: none;\n",
              "    fill: var(--fill-color);\n",
              "    height: 32px;\n",
              "    padding: 0;\n",
              "    width: 32px;\n",
              "  }\n",
              "\n",
              "  .colab-df-quickchart:hover {\n",
              "    background-color: var(--hover-bg-color);\n",
              "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "    fill: var(--button-hover-fill-color);\n",
              "  }\n",
              "\n",
              "  .colab-df-quickchart-complete:disabled,\n",
              "  .colab-df-quickchart-complete:disabled:hover {\n",
              "    background-color: var(--disabled-bg-color);\n",
              "    fill: var(--disabled-fill-color);\n",
              "    box-shadow: none;\n",
              "  }\n",
              "\n",
              "  .colab-df-spinner {\n",
              "    border: 2px solid var(--fill-color);\n",
              "    border-color: transparent;\n",
              "    border-bottom-color: var(--fill-color);\n",
              "    animation:\n",
              "      spin 1s steps(1) infinite;\n",
              "  }\n",
              "\n",
              "  @keyframes spin {\n",
              "    0% {\n",
              "      border-color: transparent;\n",
              "      border-bottom-color: var(--fill-color);\n",
              "      border-left-color: var(--fill-color);\n",
              "    }\n",
              "    20% {\n",
              "      border-color: transparent;\n",
              "      border-left-color: var(--fill-color);\n",
              "      border-top-color: var(--fill-color);\n",
              "    }\n",
              "    30% {\n",
              "      border-color: transparent;\n",
              "      border-left-color: var(--fill-color);\n",
              "      border-top-color: var(--fill-color);\n",
              "      border-right-color: var(--fill-color);\n",
              "    }\n",
              "    40% {\n",
              "      border-color: transparent;\n",
              "      border-right-color: var(--fill-color);\n",
              "      border-top-color: var(--fill-color);\n",
              "    }\n",
              "    60% {\n",
              "      border-color: transparent;\n",
              "      border-right-color: var(--fill-color);\n",
              "    }\n",
              "    80% {\n",
              "      border-color: transparent;\n",
              "      border-right-color: var(--fill-color);\n",
              "      border-bottom-color: var(--fill-color);\n",
              "    }\n",
              "    90% {\n",
              "      border-color: transparent;\n",
              "      border-bottom-color: var(--fill-color);\n",
              "    }\n",
              "  }\n",
              "</style>\n",
              "\n",
              "      <script>\n",
              "        async function quickchart(key) {\n",
              "          const quickchartButtonEl =\n",
              "            document.querySelector('#' + key + ' button');\n",
              "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
              "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
              "          try {\n",
              "            const charts = await google.colab.kernel.invokeFunction(\n",
              "                'suggestCharts', [key], {});\n",
              "          } catch (error) {\n",
              "            console.error('Error during call to suggestCharts:', error);\n",
              "          }\n",
              "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
              "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
              "        }\n",
              "        (() => {\n",
              "          let quickchartButtonEl =\n",
              "            document.querySelector('#df-23f358f4-fd03-4db6-a369-41f9a3546e07 button');\n",
              "          quickchartButtonEl.style.display =\n",
              "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "        })();\n",
              "      </script>\n",
              "    </div>\n",
              "\n",
              "    </div>\n",
              "  </div>\n"
            ],
            "application/vnd.google.colaboratory.intrinsic+json": {
              "type": "dataframe",
              "summary": "{\n  \"name\": \"display(df\",\n  \"rows\": 5,\n  \"fields\": [\n    {\n      \"column\": \"chunk_id\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"chunk_1\",\n          \"chunk_4\",\n          \"chunk_2\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"text\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"Herrick v. Lyon 7 A.D. 3d 571, 777 N.Y.S.2d 141 (App. Div. Second Dept. 2004). Plaintiff attorney commenced an action in Supreme Court to recover fees and disbursements for his representation of defendant client involving the enforcement of provisions of a divorce judgement. Defendant client moved to dismiss on the ground that plaintiff attorney failed to provide her notice of her right to arbitrate pursuant to 22 NYCRR 136.5(a). The Supreme Court denied the motion and client appealed. The Appellate Division held that Part 136 applied to an attorney who seeks to represent a client in action to enforce a judgement of divorce. Plaintiff\\u2019s failure to not only provide notice but also failure to plead in the complaint that notice was provided, but client failed to timely elect, required dismissal of attorney\\u2019s complaint for fees. Rotker v. Rotker 195 Misc.2d 768, 761 N.Y.S.2d 787 (Sup. Ct., Westchester County 2003). The Westchester County Supreme Court applied the holding in Scordio to fee disputes covered by Part 137. Attorney\\u2019s failure to provide notice of client\\u2019s right to arbitrate did not divest attorney of right to receive fee for services rendered because client never explicitly disputed attorney\\u2019s fee. Where client discharged attorney (allegedly for cause) and attorney asserted a retaining lien, the court concluded that it must hold a hearing to determine whether the discharge was for cause. If so, attorney is not entitled to a fee and must deliver client\\u2019s file to incoming counsel. If not, then client may commence arbitration on the fee dispute. Regarding client\\u2019s file, court held that attorney would be required to convey client\\u2019s file to incoming counsel if assets other than client\\u2019s file were available to secure attorney\\u2019s lien (if there were no such assets, client would have to proceed in litigation without the file). Scordio v. Scordio 270 A.D.2d 328, 705 N.Y.S.2d 58 (App. Div. 2d Dept. 2000). (Part 136) The Second Department declined to follow Paikin and held that the attorney could recover fees without participating in arbitration where the attorney did not send the 30-day notice of client\\u2019s right to arbitrate because the client never explicitly disputed the fee. Paikin v. Tsirelman 266 A.D.2d 136, 699 N.Y.S.2d 32 (App. Div. 1st Dept. 1999). (Part 136) Outgoing counsel is required to provide client with 30-day notice of right to arbitrate, even in the absence of any explicit fee disagreement. Failure to do so will result in dismissal of the complaint. Attorney could not rely on the principle of an account stated as reason for not complying with the notice requirements of Part 136. Such an interpretation would allow an attorney to circumvent the rules concerning matrimonial fee arbitration. As found by the  4 court in Lewis & Merrittv Smith, to interpret the common-law principles of an account stated, so as to find that a matrimonial client's failure to affirmatively object to his or her attorney's billings may provide a basis for circumventing the notice and pleading requirements of 22 NYCRR 136.5, would effectively eviscerate the fee arbitration rules governing domestic relations matters. Julien v Machson , 245 AD2d 122, 666 NYS2d 147 (1st Dept. 1997). Failure to give client notice of right to arbitrate results \\u201cin preclusion from recovering such legal fees\\u201d. N.B. attorney also failed to provide written retainer agreement and to submit itemized bills. Gretz (Matter of) v. Goldman (Sup. Ct., Westchester County, July 11, 2002, Spolzino, J., Index No. 08302/00, as reported in\",\n          \"Sieratzki v. Sei Global, 2009 WL 4009128, 2009 NY Slip Op 32656(U), (Sup. Ct. NY 2009). Where attorney represented client on four separate claims and fees were disputed in each claim, the court viewed the amount in dispute in the aggregate. Attorney was hired to represent client as corporate and securities counsel. All claims have a matter of fact in common. As such the amount in dispute was greater than 50K and Part 137 did not apply. Furthermore, the attorney properly plead the exception to the rule. Goldfarb v. Hoffman , 2016 WL 2636867 (App Div First Dept 2016). Despite the clause in the parties\\u2019 contract that stated the client had the right to arbitrate \\u201cas provided by [Part 137]\\u201d, the court held that the client did not have the right to arbitrate because the attorney represented client in a criminal matter and Part 137 does not apply to representation in criminal matters. Substantial Legal Questions, Malpractice, Misconduct Lorin v. 501 Second Street LLC and Dorothy Nash , 769 N.Y.S.2d 361 (Civ. Ct. Kings County 2003). Court dismissed plaintiff/ attorney\\u2019s action for fees because of attorney\\u2019s failure to provide notice of client\\u2019s right to arbitration. Plaintiff/ attorney, on motion to reargue, argued that Part 137 did not apply because client claimed malpractice as an affirmative defense to non-  8 payment. The Court said it would be in violation of public policy and the purpose of the rule to allow attorneys to avoid compliance by stating, \\u201c... the attorney knows the client will allege malpractice\\u201d. The Court said it is up to the \\u201cLocal Administrative Body\\u201d to determine if \\u201c... malpractice is inextricably intertwined with the plaintiff\\u2019s claim for payment...\\u201d not the lawyer. \\u201cTwo-Year\\u201d Exception Cooper, P.C. v Asch , 2014 N.Y. Misc. LEXIS 34, *4-5 (N.Y. Sup. Ct. Jan. 2, 2014) Where attorney\\u2019s services had not been rendered for more than two years, the dispute was not covered by Part 137 and the notice requirements did not apply. The attorney, however, failed to plead that the dispute was not covered by Part 137 pursuant to 137.6(b) and the court dismissed the complaint without prejudice. Borah, Goldstein, Altschuler, Schwartz, & Nahins, PC v. Gayle Lubnitzki a/k/a Gayle Shaul, 13 Misc. 3d 823 (New York City Civil Court). Hon. Barbara Jaffe. Index No. 30025TSN2006, The court dismissed plaintiff/ attorney\\u2019s suit to recover legal fees for failure to comply with Part 137. Plaintiff sued Defendant/Client to recover legal fees. Defendant claimed Plaintiff failed to comply with Part 137, by failing to notify her of her right to arbitrate the dispute. Plaintiff, amending his complaint, alleged that Part 137 did not apply as legal services had not been rendered in over two years. The court held that by actively litigating the fee dispute within two years, the plaintiff could not now claim the exception applied. The court held the plaintiff\\u2019s amended complaint related back to the original complaint for these purposes and, as the exemption would not have applied at the time the plaintiff sued, the plaintiff did not comply with Part 137. Fee Paid by Statute, F-P v. E.L.P 2015 N.Y. Slip Op. 51338 (Supreme Court, Bronx County). Court sanctioned attorney for participating in fee arbitration, in order to collect additional fees from client, after the court issued an order that determined attorney\\u2019s fees. The order also stated the attorney was not entitled to further compensation, and noted that attorney had already been paid in full pursuant to the retainer agreement.\",\n          \"Rotker v. Rotker, 195 Misc.2d 768,777, 761 N.Y.S.2d 787 (Sup.Ct., Westchester County 2003). By sending a notice of the right to arbitrate, counsel had triggered the client\\u2019s right to elect arbitration and could not thereafter refuse to submit the fee dispute to arbitration, despite the fact that the request was submitted after the 30-day statutory period had expired. Williams v Foubister , 176 Misc.2d 702, 673 NYS2d 840 (Monroe Co. Ct. 1998). Attorney sued in City Court while fee dispute was pending in arbitration program. Attorney demanded a trial de novo, challenging the constitutionality of the fee dispute program on several grounds, including equal protection and right to jury trial. Court dismissed the action. Account Stated Lewis & Merritt, L.L.P. v Smith , 170 Misc.2d 192, 650 NYS2d 921 (Sup.Ct., Nassau Co. 1996). Attorney cannot rely on account stated as basis for summary judgment. Court granted client\\u2019s cross motion for summary judgment dismissing complaint based on account stated. Attorney argued that because client never expressly objected to the fee, client assented to correctness of the account. Therefore, according to attorney, he was entitled to summary judgment based on account stated. Court rejected that contention, holding that it had to consider \\u201cthe factual circumstances attending the particular transaction to determine if an account stated may properly be implied\\u201d. N.B. The court also held that the guarantor of the fee obligation is not entitled to his or her own notice of the right to arbitrate.  5 Paikin v. Tsirelman 266 A.D.2d 136, 699 N.Y.S.2d 32 (App. Div. 1st Dept. 1999). Outgoing counsel is required to provide client with 30-day notice of right to arbitrate, even in the absence of any explicit fee disagreement. Failure to do so will result in dismissal of the complaint. Attorney could not rely on the principle of an account stated as reason for not complying with the notice requirements of Part 136. Such an interpretation would allow an attorney to circumvent the rules concerning matrimonial fee arbitration. As found by the court in Lewis & Merrittv Smith, to interpret the common-law principles of an account stated, so as to find that a matrimonial client's failure to affirmatively object to his or her attorney's billings may provide a basis for circumventing the notice and pleading requirements of 22 NYCRR 136.5, would effectively eviscerate the fee arbitration rules governing domestic relations matters. Bartning v. Bartning , 16 A.D.3d 249, 791 N.Y.S.2d 541 (App. Div. 1st Dept. 2005). The Appellate Division applied the rule that an account stated exists where a party to a contract receives bills or invoices and does not protest them within a reasonable time. The Appellate Division held that the trial court should have granted the attorney\\u2019s request to fix his fee and impose a lien, and that lower court should also have refrained from imposing its own determination of the reasonable value of the attorney\\u2019s services in lieu of the amount actually billed, to which the client failed to object in a timely manner. Account stated was basis for summary judgment and client\\u2019s mere assertion in open court that he disputed the bills when attorney sent them was not enough to raise an issue of fact to overcome summary judgment. Here, the attorney sent the client the final billing, then sent notice and another request for payment by certified mail return receipt requested which was returned to sender, then by regular mail which was not returned but client also did not respond. Sufficiency of Notice Calendar, PC v. Edwards , 2006 NY Slip Op. 26402, 822 N.Y.S.2d 422 (N.Y.C. Civ. Ct., Queens County 2006). When client disputed fee, attorney sent client a letter by certified mail and advised client to download the relevant forms to commence fee dispute arbitration from the website for the Part 137 Program. The New York City Civil Court held that this notice did not comport with 22 NYCRR \\u00a7 137.6(a) and dismissed the attorney\\u2019s action to recover fees in the Small Claims Part. Exceptions to Part 137  6\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "<class 'pandas.core.frame.DataFrame'>\n",
            "RangeIndex: 46 entries, 0 to 45\n",
            "Data columns (total 2 columns):\n",
            " #   Column    Non-Null Count  Dtype \n",
            "---  ------    --------------  ----- \n",
            " 0   chunk_id  46 non-null     object\n",
            " 1   text      46 non-null     object\n",
            "dtypes: object(2)\n",
            "memory usage: 868.0+ bytes\n"
          ]
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "None"
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "fc3cd926",
        "outputId": "a67dd021-7f8d-4391-d8d5-df72eab55236"
      },
      "source": [
        "def naive_keyword_search(query, dataframe, text_snippet_length=300):\n",
        "    \"\"\"\n",
        "    Performs a simple keyword search on the text column of a DataFrame and displays snippets.\n",
        "\n",
        "    Args:\n",
        "        query (str): The search query string.\n",
        "        dataframe (pd.DataFrame): The DataFrame containing the text data in a 'text' column.\n",
        "        text_snippet_length (int): The maximum length of the text snippet to display.\n",
        "\n",
        "    Returns:\n",
        "        pd.DataFrame: A DataFrame containing the rows from the input DataFrame\n",
        "                      that contain any of the keywords in the query.\n",
        "    \"\"\"\n",
        "    # Split the query into individual keywords\n",
        "    keywords = query.lower().split()\n",
        "\n",
        "    # Create a boolean mask for rows containing any of the keywords\n",
        "    # We'll check if any keyword is present in the lowercase version of the text\n",
        "    mask = dataframe['text'].str.lower().apply(lambda x: any(keyword in x for keyword in keywords))\n",
        "\n",
        "    # Filter the DataFrame based on the mask\n",
        "    results_df = dataframe[mask].copy()\n",
        "\n",
        "    print(f\"Naive keyword search results for query: '{query}'\")\n",
        "    if not results_df.empty:\n",
        "        for index, row in results_df.iterrows():\n",
        "            snippet = row['text'][:text_snippet_length] + '...' if len(row['text']) > text_snippet_length else row['text']\n",
        "            print(f\"Document Index: {index}\")\n",
        "            print(f\"Snippet: {snippet}\\n\")\n",
        "    else:\n",
        "        print(\"No documents found.\")\n",
        "\n",
        "    return results_df\n",
        "\n",
        "# Example usage of the naive keyword search\n",
        "query = \"legal precedent\"\n",
        "naive_results = naive_keyword_search(query, df)"
      ],
      "execution_count": 4,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Naive keyword search results for query: 'legal precedent'\n",
            "Document Index: 0\n",
            "Snippet: BOARD OF GOVERNORS  New York State Unified Court System Office of Court Administration Office of ADR Programs January 8, 2018 These case summaries are provided for informational purposes only and for the convenience of th ose interested in learning more about the Attorney-Client Fee Arbitration Prog...\n",
            "\n",
            "Document Index: 1\n",
            "Snippet: Herrick v. Lyon 7 A.D. 3d 571, 777 N.Y.S.2d 141 (App. Div. Second Dept. 2004). Plaintiff attorney commenced an action in Supreme Court to recover fees and disbursements for his representation of defendant client involving the enforcement of provisions of a divorce judgement. Defendant client moved t...\n",
            "\n",
            "Document Index: 3\n",
            "Snippet: Gottlieb v. Marusya , 2004 NY Slip Op 51816U; 6 Misc. 3d 1023A; 800 N.Y.S.2d 346; 2004 N.Y. Misc. LEXIS 2988; 233 N.Y.L.J. 6, (Civil Court New York 2004). Attorney was not required to provide notice to client of the right to arbitrate because representation began in December 2001, prior to the effec...\n",
            "\n",
            "Document Index: 4\n",
            "Snippet: Sieratzki v. Sei Global, 2009 WL 4009128, 2009 NY Slip Op 32656(U), (Sup. Ct. NY 2009). Where attorney represented client on four separate claims and fees were disputed in each claim, the court viewed the amount in dispute in the aggregate. Attorney was hired to represent client as corporate and sec...\n",
            "\n",
            "Document Index: 5\n",
            "Snippet: Williams v. Jacqueline Jackson , 2005 NY Slip Op 25496; 10 Misc. 3d 58; 809 N.Y.S.2d 771; 2005 N.Y. Misc. LEXIS (App. Term. 2d Dept. 2005).  9 Attorney’s claim for fees in a Mental Hygiene Law article 81 proceeding was dismissed due to attorney’s failure to notify client of right to arbitrate. Supre...\n",
            "\n",
            "Document Index: 6\n",
            "Snippet: LLC v. CBC Capital Ventures, Inc 2008 NY Slip Op 50126(U); 2008 WL 183722 (Sup. Ct. Nassau County 2008). “…[A] New York attorney suing New York residents in New York for a fee must at least plead an exception to the New York State Fee Dispute Resolution Program and by not doing so incurs dismissal.”...\n",
            "\n",
            "Document Index: 7\n",
            "Snippet: PC v. Finkelstein , NYLJ January 25, 2006, at 19 (NY County Supreme Court). The court denied law firm’s application for reargument because firm had not argued that the dispute fell outside of the Part 137 Program on their prior motion as is required by CPLR 2221(d) 2. The law firm participated in th...\n",
            "\n",
            "Document Index: 8\n",
            "Snippet: Gahagan v. Gahagan, 51 A.D.3d 863 (N.Y. App. Div. 2d Dep't 2008); Attorney is precluded from recovering legal fees where he or she did not comply with 22 NYCRR 1400.3, requiring attorney to execute and file a retainer agreement that sets forth, inter alia, the terms of compensation and the nature of...\n",
            "\n",
            "Document Index: 9\n",
            "Snippet: Plant v. Channing , 299 A.D.2d 696, 698 (N.Y. App. Div. 3d Dep't 2002). Upheld a fee arbitration award finding that the attorney was not entitled to any fees based on several violations of the matrimonial rules, including failure to provide a written retainer, failure to provide a statement of clien...\n",
            "\n",
            "Document Index: 10\n",
            "Snippet: Jones v. Wright , 2007 NY Slip Op 51494U; 16 Misc. 3d 133A; 2007 N.Y. Misc. LEXIS 5381 (Appellate Term, 2d Dept. 2007). Citing Rubenstein, court ordered a new trial where court below found that defendant was barred from retaining any legal fees due to lack of letter of engagement. Court found that a...\n",
            "\n",
            "Document Index: 16\n",
            "Snippet: Friedman v. Vuksanovic , 2010 NY Slip Op 30021(U), 2010 WL 147154 (Sup. Ct. New York County). Respondent/ client failed to show a basis under CPLR 7511 to vacate the award. The Part 137 Program run by NYCLA gave Respondent several adjournments. Respondent failed to show on the date of the hearing. T...\n",
            "\n",
            "Document Index: 18\n",
            "Snippet: Jacobson v. Sassower (66 NY2d 991[1985]), the court reasoned that any ambiguity in the language should be construed against the petitioner, who drafted the agreement. (Jacobson: Additionally, and as a matter of public policy, courts pay particular attention to fee arrangements between attorneys and ...\n",
            "\n",
            "Document Index: 19\n",
            "Snippet: LLP v. Altman , 2009 NY Slip Op 31294(U), 2009 WL 1725926 (Sup. Ct. New York County). “Therefore, since the subject Retainer Agreement did not conform with the written waiver form prescribed by the Board of Governors, the Court adheres to its prior determination that the parties did not waive their ...\n",
            "\n",
            "Document Index: 20\n",
            "Snippet: C. v. Bethany M. Killeen, (235 A.D.2d 17, 663 N.Y.S.2d 356 (3d Dept. 1997). Court held that an arbitration panel convened pursuant to Part 136 exceeded its authority by making an imperfectly executed award; the award did not contain any rationale for the panel’s decision, and since there was no reco...\n",
            "\n",
            "Document Index: 21\n",
            "Snippet: Ween v. Dow , 2006 NY Slip Op 7227, 2006 N.Y. App. Div. LEXIS 12033 (First Dept. 2006). The Court framed the issue as: Whether a provision in a retainer agreement, which holds the client liable for attorneys’ fees incurred in the collection of fees generated under the retainer agreement, is void as ...\n",
            "\n",
            "Document Index: 24\n",
            "Snippet: Division upheld the lower court’s determination that client was precluded from pursuing the malpractice action. Wallenstein v. Cohen , 2007 NY Slip Op 9023; 2007 N.Y. App. Div. LEXIS 11874 (App. Div. 2d Dept. 2007) (Part 136) Plaintiff/ Client complained to the Grievance Committee that attorney char...\n",
            "\n",
            "Document Index: 26\n",
            "Snippet: Angel v. Greenhaus , 105349/09 (Sup. Ct. NY County 2009). Client requested fee arbitration claiming she was “basically destitute” and unable to pay legal fees. Arbitrators awarded defendant /attorney $22,300.82 in legal fees. Court held that plaintiff’s claim that defendant is not entitled to fees b...\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "!pip install rank_bm25"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "UeDQP9J5tsLT",
        "outputId": "233bb43e-cead-46dd-c990-234d527116ee"
      },
      "execution_count": 5,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Requirement already satisfied: rank_bm25 in /usr/local/lib/python3.12/dist-packages (0.2.2)\n",
            "Requirement already satisfied: numpy in /usr/local/lib/python3.12/dist-packages (from rank_bm25) (2.0.2)\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "import nltk\n",
        "nltk.download('punkt_tab')"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "5OIuhwIrtlUA",
        "outputId": "fc456032-f4d5-4651-e793-e68294bd7dec"
      },
      "execution_count": 6,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "[nltk_data] Downloading package punkt_tab to /root/nltk_data...\n",
            "[nltk_data]   Package punkt_tab is already up-to-date!\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "True"
            ]
          },
          "metadata": {},
          "execution_count": 6
        }
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "735f074d",
        "outputId": "753a6cb0-6060-4e75-eed4-accb895d31ac"
      },
      "source": [
        "from rank_bm25 import BM25Okapi\n",
        "from nltk.tokenize import word_tokenize\n",
        "\n",
        "# Tokenize the text in the DataFrame\n",
        "tokenized_corpus = [word_tokenize(doc.lower()) for doc in df['text']]\n",
        "\n",
        "# Initialize BM25 with the tokenized corpus\n",
        "bm25 = BM25Okapi(tokenized_corpus)\n",
        "\n",
        "# Example usage of BM25\n",
        "query = \"legal precedent\"\n",
        "tokenized_query = word_tokenize(query.lower())\n",
        "\n",
        "# Get the scores for each document\n",
        "doc_scores = bm25.get_scores(tokenized_query)\n",
        "\n",
        "# Get the top N documents\n",
        "top_n = 5\n",
        "top_n_indices = doc_scores.argsort()[-top_n:][::-1] # Get indices of top scores and reverse to get descending order\n",
        "\n",
        "print(f\"BM25 retrieval scores for query: '{query}'\")\n",
        "# Display the top documents and their scores with snippets\n",
        "text_snippet_length = 300 # Define snippet length\n",
        "\n",
        "for i in top_n_indices:\n",
        "    snippet = df.iloc[i]['text'][:text_snippet_length] + '...' if len(df.iloc[i]['text']) > text_snippet_length else df.iloc[i]['text']\n",
        "    print(f\"Document Index: {i}, Score: {doc_scores[i]:.4f}\")\n",
        "    print(f\"Snippet: {snippet}\\n\")"
      ],
      "execution_count": 7,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "BM25 retrieval scores for query: 'legal precedent'\n",
            "Document Index: 0, Score: 2.8125\n",
            "Snippet: BOARD OF GOVERNORS  New York State Unified Court System Office of Court Administration Office of ADR Programs January 8, 2018 These case summaries are provided for informational purposes only and for the convenience of th ose interested in learning more about the Attorney-Client Fee Arbitration Prog...\n",
            "\n",
            "Document Index: 26, Score: 1.0575\n",
            "Snippet: Angel v. Greenhaus , 105349/09 (Sup. Ct. NY County 2009). Client requested fee arbitration claiming she was “basically destitute” and unable to pay legal fees. Arbitrators awarded defendant /attorney $22,300.82 in legal fees. Court held that plaintiff’s claim that defendant is not entitled to fees b...\n",
            "\n",
            "Document Index: 10, Score: 0.8668\n",
            "Snippet: Jones v. Wright , 2007 NY Slip Op 51494U; 16 Misc. 3d 133A; 2007 N.Y. Misc. LEXIS 5381 (Appellate Term, 2d Dept. 2007). Citing Rubenstein, court ordered a new trial where court below found that defendant was barred from retaining any legal fees due to lack of letter of engagement. Court found that a...\n",
            "\n",
            "Document Index: 8, Score: 0.8664\n",
            "Snippet: Gahagan v. Gahagan, 51 A.D.3d 863 (N.Y. App. Div. 2d Dep't 2008); Attorney is precluded from recovering legal fees where he or she did not comply with 22 NYCRR 1400.3, requiring attorney to execute and file a retainer agreement that sets forth, inter alia, the terms of compensation and the nature of...\n",
            "\n",
            "Document Index: 7, Score: 0.7897\n",
            "Snippet: PC v. Finkelstein , NYLJ January 25, 2006, at 19 (NY County Supreme Court). The court denied law firm’s application for reargument because firm had not argued that the dispute fell outside of the Part 137 Program on their prior motion as is required by CPLR 2221(d) 2. The law firm participated in th...\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "ec48db85"
      },
      "source": [
        "# Task\n",
        "Implement a Retrieval Augmented Generation (RAG) system using an LLM to improve the results of the previously implemented BM25 retrieval on the uploaded PDF document \"attention_is_all_you_need.pdf\". The implementation should involve using the LLM to synthesize an answer based on the retrieved chunks from the PDF. The process should be explained step-by-step, demonstrating the improvement over the naive retrieval methods."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "bf0c6310"
      },
      "source": [
        "## Set up llm access\n",
        "\n",
        "### Subtask:\n",
        "Configure access to an LLM API (e.g., Google Gemini, OpenAI, Groq) by installing libraries and setting up API keys.\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "69e35ac5"
      },
      "source": [
        "**Reasoning**:\n",
        "Install the necessary library for accessing the Google Gemini API.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "fc9769cd",
        "outputId": "f8544b7d-5ad5-4707-eff9-e776708d3c6b"
      },
      "source": [
        "!pip install langchain_groq"
      ],
      "execution_count": 8,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Requirement already satisfied: langchain_groq in /usr/local/lib/python3.12/dist-packages (0.3.8)\n",
            "Requirement already satisfied: langchain-core<1.0.0,>=0.3.75 in /usr/local/lib/python3.12/dist-packages (from langchain_groq) (0.3.77)\n",
            "Requirement already satisfied: groq<1,>=0.30.0 in /usr/local/lib/python3.12/dist-packages (from langchain_groq) (0.32.0)\n",
            "Requirement already satisfied: anyio<5,>=3.5.0 in /usr/local/lib/python3.12/dist-packages (from groq<1,>=0.30.0->langchain_groq) (4.11.0)\n",
            "Requirement already satisfied: distro<2,>=1.7.0 in /usr/local/lib/python3.12/dist-packages (from groq<1,>=0.30.0->langchain_groq) (1.9.0)\n",
            "Requirement already satisfied: httpx<1,>=0.23.0 in /usr/local/lib/python3.12/dist-packages (from groq<1,>=0.30.0->langchain_groq) (0.28.1)\n",
            "Requirement already satisfied: pydantic<3,>=1.9.0 in /usr/local/lib/python3.12/dist-packages (from groq<1,>=0.30.0->langchain_groq) (2.12.0)\n",
            "Requirement already satisfied: sniffio in /usr/local/lib/python3.12/dist-packages (from groq<1,>=0.30.0->langchain_groq) (1.3.1)\n",
            "Requirement already satisfied: typing-extensions<5,>=4.10 in /usr/local/lib/python3.12/dist-packages (from groq<1,>=0.30.0->langchain_groq) (4.15.0)\n",
            "Requirement already satisfied: langsmith<1.0.0,>=0.3.45 in /usr/local/lib/python3.12/dist-packages (from langchain-core<1.0.0,>=0.3.75->langchain_groq) (0.4.31)\n",
            "Requirement already satisfied: tenacity!=8.4.0,<10.0.0,>=8.1.0 in /usr/local/lib/python3.12/dist-packages (from langchain-core<1.0.0,>=0.3.75->langchain_groq) (8.5.0)\n",
            "Requirement already satisfied: jsonpatch<2.0.0,>=1.33.0 in /usr/local/lib/python3.12/dist-packages (from langchain-core<1.0.0,>=0.3.75->langchain_groq) (1.33)\n",
            "Requirement already satisfied: PyYAML<7.0.0,>=5.3.0 in /usr/local/lib/python3.12/dist-packages (from langchain-core<1.0.0,>=0.3.75->langchain_groq) (6.0.3)\n",
            "Requirement already satisfied: packaging<26.0.0,>=23.2.0 in /usr/local/lib/python3.12/dist-packages (from langchain-core<1.0.0,>=0.3.75->langchain_groq) (25.0)\n",
            "Requirement already satisfied: idna>=2.8 in /usr/local/lib/python3.12/dist-packages (from anyio<5,>=3.5.0->groq<1,>=0.30.0->langchain_groq) (3.10)\n",
            "Requirement already satisfied: certifi in /usr/local/lib/python3.12/dist-packages (from httpx<1,>=0.23.0->groq<1,>=0.30.0->langchain_groq) (2025.8.3)\n",
            "Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.12/dist-packages (from httpx<1,>=0.23.0->groq<1,>=0.30.0->langchain_groq) (1.0.9)\n",
            "Requirement already satisfied: h11>=0.16 in /usr/local/lib/python3.12/dist-packages (from httpcore==1.*->httpx<1,>=0.23.0->groq<1,>=0.30.0->langchain_groq) (0.16.0)\n",
            "Requirement already satisfied: jsonpointer>=1.9 in /usr/local/lib/python3.12/dist-packages (from jsonpatch<2.0.0,>=1.33.0->langchain-core<1.0.0,>=0.3.75->langchain_groq) (3.0.0)\n",
            "Requirement already satisfied: orjson>=3.9.14 in /usr/local/lib/python3.12/dist-packages (from langsmith<1.0.0,>=0.3.45->langchain-core<1.0.0,>=0.3.75->langchain_groq) (3.11.3)\n",
            "Requirement already satisfied: requests-toolbelt>=1.0.0 in /usr/local/lib/python3.12/dist-packages (from langsmith<1.0.0,>=0.3.45->langchain-core<1.0.0,>=0.3.75->langchain_groq) (1.0.0)\n",
            "Requirement already satisfied: requests>=2.0.0 in /usr/local/lib/python3.12/dist-packages (from langsmith<1.0.0,>=0.3.45->langchain-core<1.0.0,>=0.3.75->langchain_groq) (2.32.4)\n",
            "Requirement already satisfied: zstandard>=0.23.0 in /usr/local/lib/python3.12/dist-packages (from langsmith<1.0.0,>=0.3.45->langchain-core<1.0.0,>=0.3.75->langchain_groq) (0.25.0)\n",
            "Requirement already satisfied: annotated-types>=0.6.0 in /usr/local/lib/python3.12/dist-packages (from pydantic<3,>=1.9.0->groq<1,>=0.30.0->langchain_groq) (0.7.0)\n",
            "Requirement already satisfied: pydantic-core==2.41.1 in /usr/local/lib/python3.12/dist-packages (from pydantic<3,>=1.9.0->groq<1,>=0.30.0->langchain_groq) (2.41.1)\n",
            "Requirement already satisfied: typing-inspection>=0.4.2 in /usr/local/lib/python3.12/dist-packages (from pydantic<3,>=1.9.0->groq<1,>=0.30.0->langchain_groq) (0.4.2)\n",
            "Requirement already satisfied: charset_normalizer<4,>=2 in /usr/local/lib/python3.12/dist-packages (from requests>=2.0.0->langsmith<1.0.0,>=0.3.45->langchain-core<1.0.0,>=0.3.75->langchain_groq) (3.4.3)\n",
            "Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests>=2.0.0->langsmith<1.0.0,>=0.3.45->langchain-core<1.0.0,>=0.3.75->langchain_groq) (2.5.0)\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "098b952d"
      },
      "source": [
        "**Reasoning**:\n",
        "Import the google.generativeai library and set up the API key.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "id": "f75d3b0b"
      },
      "source": [
        "import os\n",
        "from google.colab import userdata\n",
        "\n",
        "os.environ[\"GROQ_API_KEY\"] = userdata.get(\"GROQ_API_KEY\")\n",
        "\n",
        "from langchain_groq import ChatGroq\n",
        "\n",
        "llm = ChatGroq(model=\"openai/gpt-oss-20b\")"
      ],
      "execution_count": 9,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "d2948397"
      },
      "source": [
        "## Perform bm25 retrieval\n",
        "\n",
        "### Subtask:\n",
        "Use the existing BM25 code to retrieve the top N relevant chunks for a given query.\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "90441a27"
      },
      "source": [
        "**Reasoning**:\n",
        "Use the pre-initialized BM25 object and tokenized corpus to retrieve the top N relevant chunks for a given query.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "63e4cf96",
        "outputId": "3add2498-43f2-4b02-e207-85b927602a21"
      },
      "source": [
        "# Define the query\n",
        "query = \"requirements for recovering legal fees\"\n",
        "\n",
        "# Tokenize the query\n",
        "tokenized_query = word_tokenize(query.lower())\n",
        "\n",
        "# Get the scores for each document\n",
        "doc_scores = bm25.get_scores(tokenized_query)\n",
        "\n",
        "# Get the indices of the top N documents\n",
        "top_n_indices = doc_scores.argsort()[-top_n:][::-1]\n",
        "\n",
        "# Extract the text content of the top N documents\n",
        "retrieved_chunks = [df.iloc[i]['text'] for i in top_n_indices]\n",
        "\n",
        "print(f\"Retrieved {len(retrieved_chunks)} chunks for query: '{query}'\")\n",
        "# Optionally display the retrieved chunks\n",
        "for i, chunk in enumerate(retrieved_chunks):\n",
        "    print(f\"Chunk {i+1}: {chunk[:300]}...\\n\")"
      ],
      "execution_count": 10,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Retrieved 5 chunks for query: 'requirements for recovering legal fees'\n",
            "Chunk 1: PC v. Finkelstein , NYLJ January 25, 2006, at 19 (NY County Supreme Court). The court denied law firm’s application for reargument because firm had not argued that the dispute fell outside of the Part 137 Program on their prior motion as is required by CPLR 2221(d) 2. The law firm participated in th...\n",
            "\n",
            "Chunk 2: Gahagan v. Gahagan, 51 A.D.3d 863 (N.Y. App. Div. 2d Dep't 2008); Attorney is precluded from recovering legal fees where he or she did not comply with 22 NYCRR 1400.3, requiring attorney to execute and file a retainer agreement that sets forth, inter alia, the terms of compensation and the nature of...\n",
            "\n",
            "Chunk 3: Herrick v. Lyon 7 A.D. 3d 571, 777 N.Y.S.2d 141 (App. Div. Second Dept. 2004). Plaintiff attorney commenced an action in Supreme Court to recover fees and disbursements for his representation of defendant client involving the enforcement of provisions of a divorce judgement. Defendant client moved t...\n",
            "\n",
            "Chunk 4: Jones v. Wright , 2007 NY Slip Op 51494U; 16 Misc. 3d 133A; 2007 N.Y. Misc. LEXIS 5381 (Appellate Term, 2d Dept. 2007). Citing Rubenstein, court ordered a new trial where court below found that defendant was barred from retaining any legal fees due to lack of letter of engagement. Court found that a...\n",
            "\n",
            "Chunk 5: Plant v. Channing , 299 A.D.2d 696, 698 (N.Y. App. Div. 3d Dep't 2002). Upheld a fee arbitration award finding that the attorney was not entitled to any fees based on several violations of the matrimonial rules, including failure to provide a written retainer, failure to provide a statement of clien...\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "c6118452"
      },
      "source": [
        "## Prepare context for llm\n",
        "\n",
        "### Subtask:\n",
        "Format the retrieved text chunks and the user's query into a suitable prompt for the LLM.\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "bfd59b2f"
      },
      "source": [
        "**Reasoning**:\n",
        "Format the retrieved text chunks and the user's query into a suitable prompt for the LLM as described in the instructions.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "8d4d6bcd",
        "outputId": "995bd05a-210a-43c6-db56-c30f1974566d"
      },
      "source": [
        "# 1. Create a prompt template string\n",
        "prompt_template = \"\"\"\n",
        "Based on the following context, answer the question.\n",
        "If the answer cannot be found in the context, respond with \"I cannot answer this question based on the provided information.\"\n",
        "\n",
        "Context:\n",
        "{context}\n",
        "\n",
        "Question:\n",
        "{question}\n",
        "\n",
        "Answer:\n",
        "\"\"\"\n",
        "\n",
        "# 2. Join the retrieved text chunks into a single string\n",
        "# Using a separator to distinguish between chunks\n",
        "context_string = \"\\n---\\n\".join(retrieved_chunks)\n",
        "\n",
        "# 3. Format the prompt string\n",
        "formatted_prompt = prompt_template.format(context=context_string, question=query)\n",
        "\n",
        "# 4. Store the final formatted prompt string in a variable (already done in step 3)\n",
        "# The variable `formatted_prompt` now holds the final prompt string.\n",
        "\n",
        "print(\"Formatted prompt created, ready to be sent to the LLM.\")\n",
        "print(\"--- Formatted Prompt Preview ---\")\n",
        "print(formatted_prompt[:500] + \"...\") # Print a preview of the formatted prompt"
      ],
      "execution_count": 11,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Formatted prompt created, ready to be sent to the LLM.\n",
            "--- Formatted Prompt Preview ---\n",
            "\n",
            "Based on the following context, answer the question.\n",
            "If the answer cannot be found in the context, respond with \"I cannot answer this question based on the provided information.\"\n",
            "\n",
            "Context:\n",
            "PC v. Finkelstein , NYLJ January 25, 2006, at 19 (NY County Supreme Court). The court denied law firm’s application for reargument because firm had not argued that the dispute fell outside of the Part 137 Program on their prior motion as is required by CPLR 2221(d) 2. The law firm participated in the underlyi...\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "7f71a1db"
      },
      "source": [
        "## Generate response with llm\n",
        "\n",
        "### Subtask:\n",
        "Send the prompt to the LLM and get a generated response based on the provided context.\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "f3ce40fe"
      },
      "source": [
        "**Reasoning**:\n",
        "Create an instance of the generative model and send the formatted prompt to get the LLM's response.\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "e76039d8",
        "outputId": "e757bf34-70d7-409d-c1f8-f4d09d0f82e2"
      },
      "source": [
        "# Generate the response using the Groq LLM\n",
        "# The 'formatted_prompt' variable contains the query and retrieved context\n",
        "llm_response = llm.invoke(formatted_prompt)\n",
        "\n",
        "# Print the generated response\n",
        "print(\"--- LLM Generated Answer ---\")\n",
        "print(llm_response.content)"
      ],
      "execution_count": 12,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "--- LLM Generated Answer ---\n",
            "**Key requirements for recovering legal fees in New York (domestic‑relations and non‑domestic‑relations matters)**  \n",
            "\n",
            "| Step | Requirement | Why it matters | Typical remedy if the requirement is missing |\n",
            "|------|-------------|----------------|---------------------------------------------|\n",
            "| **1. Identify the applicable fee‑arbitration regime** | • Part 137 (domestic‑relations fee arbitration) or Part 1400 (particular rules for matrimonial cases). <br>• Part 136 (notice of right to arbitrate). <br>• 22 NYCRR 1215.1 (letter of engagement for non‑matrimonial work). | The rules differ by practice area; the court will first determine whether the fee dispute is governed by a Part 137/1400 or by the general rules. | • If the dispute falls under Part 137/1400, the attorney must meet those specific procedural requirements. <br>• If the dispute is outside Part 137, the attorney may still recover fees under a quantum‑meruit or account‑stated theory, but must still comply with 1215.1 (or provide a written letter of engagement). |\n",
            "| **2. Provide a written retainer agreement (Part 1400 § 3)** | • Must set out the scope of services, fee schedule, and client’s rights and responsibilities. <br>• Must be signed and filed with the court (if required). | Failure to do so precludes recovery of fees in matrimonial matters; the court can dismiss the fee‑claim or reduce it. | • Attorney may be barred from recovering any fee, or may be allowed to recover only a reduced amount if the court finds “substantial compliance.” |\n",
            "| **3. Provide a statement of the client’s rights and responsibilities (Part 1400 § 2)** | • Must be given before the retainer is signed. | Failure to provide this statement also precludes fee recovery in matrimonial cases. | Same as above. |\n",
            "| **4. Provide written, itemized bills at least every 60 days (Part 1400 § 2)** | • Bills must be itemized and sent to the client every 60 days. | Non‑compliance leads to preclusion from recovery; the court may reduce the fee proportionally. | • Attorney may still recover a reduced amount if the court finds substantial compliance. |\n",
            "| **5. Give the client a 30‑day notice of the right to arbitrate (Part 136 § 5(a))** | • Notice must be served and must be pleaded in the complaint if the attorney is suing for fees. | Failure to give notice can result in dismissal of the fee claim, even if the client never explicitly disputes the fee. | • Attorney may still recover fees if the client never disputed them and the attorney can prove substantial compliance. |\n",
            "| **6. File a letter of engagement or written retainer (22 NYCRR 1215.1)** | • Required for non‑matrimonial work. <br>• If omitted, the attorney can still recover a fee on a quantum‑meruit basis, but must prove the terms of the fee arrangement were fair, fully understood, and agreed to. | Courts have held that non‑compliance does **not** automatically bar recovery, but it places a burden on the attorney to demonstrate the fairness and understanding of the fee arrangement. | • Attorney may recover on a quantum‑meruit basis if able to prove the terms were fair and understood. |\n",
            "| **7. Ensure the fee dispute is not “new” (re‑argument rules)** | • The attorney must argue that the dispute falls outside Part 137 on the **same motion** as the original request for re‑argument. <br>• A new theory of liability or a new fee dispute that was not previously advanced is not eligible for re‑argument. | Courts deny re‑argument if the attorney simply introduces a new theory of liability or a new fee dispute that was not raised earlier. | • The attorney must file a prior motion that identifies the dispute as outside Part 137. |\n",
            "| **8. Demonstrate substantial compliance (if partial violations)** | • If the attorney fails to meet one or more of the above requirements, the court may still allow fee recovery if the attorney can show “substantial compliance” (e.g., provided most of the required documents, or the client was not harmed). | Substantial compliance can preserve the fee claim, though the court may reduce the amount proportionally. | • The court may reduce the fee but not eliminate it entirely. |\n",
            "| **9. Provide evidence of services rendered (quantum‑meruit)** | • Invoices, billing statements, client correspondence, and any evidence that the client received and did not object to the services. | Required to establish the value of services when the fee arrangement is not clearly defined. | • Failure to provide such evidence can bar recovery. |\n",
            "| **10. Attend any required arbitration or mediation** | • If the dispute is governed by Part 137 or Part 136, the attorney must participate in the arbitration process. | Non‑participation or failure to comply with the arbitration notice can result in dismissal of the fee claim. | • Attorney may still recover fees if the client never disputed them and the attorney can prove substantial compliance. |\n",
            "\n",
            "### Practical take‑aways\n",
            "\n",
            "1. **Follow the specific procedural rules** (Part 137/1400 for matrimonial cases; Part 136 for notice of right to arbitrate; 1215.1 for non‑matrimonial work).  \n",
            "2. **Document everything**: signed retainer, statement of rights, itemized bills, and 30‑day notice of arbitration.  \n",
            "3. **If a rule is missed**, the attorney can still recover on a quantum‑meruit basis, but must prove the fee arrangement was fair and understood, and the court will likely reduce the award proportionally.  \n",
            "4. **Avoid re‑argument**: any new theory of liability or fee dispute must be raised in the original motion; otherwise, the court will deny re‑argument.  \n",
            "\n",
            "These requirements are derived from the cases cited in the context (e.g., *PC v. Finkelstein*, *Julien v. Machson*, *Gahagan v. Gahagan*, *Herrick v. Lyon*, *Seth Rubenstein v. Ganea*, and others).\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "5e1cf65b"
      },
      "source": [
        "## Embedding-based retrieval: setup with vector database\n",
        "\n",
        "### Subtask:\n",
        "Choose a vector database (Weaviate or Qdrant), install necessary libraries for the chosen vector database and an embedding model, set up and connect to the vector database (e.g., in-memory instance for demonstration), choose and load an appropriate embedding model, generate embeddings for all text chunks in the DataFrame, and ingest the text chunks and their embeddings into the vector database."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "1e98dd15"
      },
      "source": [
        "**Reasoning**:\n",
        "Install the necessary libraries for Qdrant, sentence-transformers, and torch to set up the vector database and embedding model."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "1432092b",
        "outputId": "5025f25e-f0cc-406d-abca-1792f7a78a58"
      },
      "source": [
        "!pip install qdrant-client sentence-transformers torch"
      ],
      "execution_count": 13,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Requirement already satisfied: qdrant-client in /usr/local/lib/python3.12/dist-packages (1.15.1)\n",
            "Requirement already satisfied: sentence-transformers in /usr/local/lib/python3.12/dist-packages (5.1.1)\n",
            "Requirement already satisfied: torch in /usr/local/lib/python3.12/dist-packages (2.8.0+cu126)\n",
            "Requirement already satisfied: grpcio>=1.41.0 in /usr/local/lib/python3.12/dist-packages (from qdrant-client) (1.75.1)\n",
            "Requirement already satisfied: httpx>=0.20.0 in /usr/local/lib/python3.12/dist-packages (from httpx[http2]>=0.20.0->qdrant-client) (0.28.1)\n",
            "Requirement already satisfied: numpy>=1.26 in /usr/local/lib/python3.12/dist-packages (from qdrant-client) (2.0.2)\n",
            "Requirement already satisfied: portalocker<4.0,>=2.7.0 in /usr/local/lib/python3.12/dist-packages (from qdrant-client) (3.2.0)\n",
            "Requirement already satisfied: protobuf>=3.20.0 in /usr/local/lib/python3.12/dist-packages (from qdrant-client) (5.29.5)\n",
            "Requirement already satisfied: pydantic!=2.0.*,!=2.1.*,!=2.2.0,>=1.10.8 in /usr/local/lib/python3.12/dist-packages (from qdrant-client) (2.12.0)\n",
            "Requirement already satisfied: urllib3<3,>=1.26.14 in /usr/local/lib/python3.12/dist-packages (from qdrant-client) (2.5.0)\n",
            "Requirement already satisfied: transformers<5.0.0,>=4.41.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (4.56.2)\n",
            "Requirement already satisfied: tqdm in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (4.67.1)\n",
            "Requirement already satisfied: scikit-learn in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (1.6.1)\n",
            "Requirement already satisfied: scipy in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (1.16.2)\n",
            "Requirement already satisfied: huggingface-hub>=0.20.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (0.35.3)\n",
            "Requirement already satisfied: Pillow in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (11.3.0)\n",
            "Requirement already satisfied: typing_extensions>=4.5.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (4.15.0)\n",
            "Requirement already satisfied: filelock in /usr/local/lib/python3.12/dist-packages (from torch) (3.19.1)\n",
            "Requirement already satisfied: setuptools in /usr/local/lib/python3.12/dist-packages (from torch) (75.2.0)\n",
            "Requirement already satisfied: sympy>=1.13.3 in /usr/local/lib/python3.12/dist-packages (from torch) (1.13.3)\n",
            "Requirement already satisfied: networkx in /usr/local/lib/python3.12/dist-packages (from torch) (3.5)\n",
            "Requirement already satisfied: jinja2 in /usr/local/lib/python3.12/dist-packages (from torch) (3.1.6)\n",
            "Requirement already satisfied: fsspec in /usr/local/lib/python3.12/dist-packages (from torch) (2025.3.0)\n",
            "Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch) (12.6.77)\n",
            "Requirement already satisfied: nvidia-cuda-runtime-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch) (12.6.77)\n",
            "Requirement already satisfied: nvidia-cuda-cupti-cu12==12.6.80 in /usr/local/lib/python3.12/dist-packages (from torch) (12.6.80)\n",
            "Requirement already satisfied: nvidia-cudnn-cu12==9.10.2.21 in /usr/local/lib/python3.12/dist-packages (from torch) (9.10.2.21)\n",
            "Requirement already satisfied: nvidia-cublas-cu12==12.6.4.1 in /usr/local/lib/python3.12/dist-packages (from torch) (12.6.4.1)\n",
            "Requirement already satisfied: nvidia-cufft-cu12==11.3.0.4 in /usr/local/lib/python3.12/dist-packages (from torch) (11.3.0.4)\n",
            "Requirement already satisfied: nvidia-curand-cu12==10.3.7.77 in /usr/local/lib/python3.12/dist-packages (from torch) (10.3.7.77)\n",
            "Requirement already satisfied: nvidia-cusolver-cu12==11.7.1.2 in /usr/local/lib/python3.12/dist-packages (from torch) (11.7.1.2)\n",
            "Requirement already satisfied: nvidia-cusparse-cu12==12.5.4.2 in /usr/local/lib/python3.12/dist-packages (from torch) (12.5.4.2)\n",
            "Requirement already satisfied: nvidia-cusparselt-cu12==0.7.1 in /usr/local/lib/python3.12/dist-packages (from torch) (0.7.1)\n",
            "Requirement already satisfied: nvidia-nccl-cu12==2.27.3 in /usr/local/lib/python3.12/dist-packages (from torch) (2.27.3)\n",
            "Requirement already satisfied: nvidia-nvtx-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch) (12.6.77)\n",
            "Requirement already satisfied: nvidia-nvjitlink-cu12==12.6.85 in /usr/local/lib/python3.12/dist-packages (from torch) (12.6.85)\n",
            "Requirement already satisfied: nvidia-cufile-cu12==1.11.1.6 in /usr/local/lib/python3.12/dist-packages (from torch) (1.11.1.6)\n",
            "Requirement already satisfied: triton==3.4.0 in /usr/local/lib/python3.12/dist-packages (from torch) (3.4.0)\n",
            "Requirement already satisfied: anyio in /usr/local/lib/python3.12/dist-packages (from httpx>=0.20.0->httpx[http2]>=0.20.0->qdrant-client) (4.11.0)\n",
            "Requirement already satisfied: certifi in /usr/local/lib/python3.12/dist-packages (from httpx>=0.20.0->httpx[http2]>=0.20.0->qdrant-client) (2025.8.3)\n",
            "Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.12/dist-packages (from httpx>=0.20.0->httpx[http2]>=0.20.0->qdrant-client) (1.0.9)\n",
            "Requirement already satisfied: idna in /usr/local/lib/python3.12/dist-packages (from httpx>=0.20.0->httpx[http2]>=0.20.0->qdrant-client) (3.10)\n",
            "Requirement already satisfied: h11>=0.16 in /usr/local/lib/python3.12/dist-packages (from httpcore==1.*->httpx>=0.20.0->httpx[http2]>=0.20.0->qdrant-client) (0.16.0)\n",
            "Requirement already satisfied: h2<5,>=3 in /usr/local/lib/python3.12/dist-packages (from httpx[http2]>=0.20.0->qdrant-client) (4.3.0)\n",
            "Requirement already satisfied: packaging>=20.9 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub>=0.20.0->sentence-transformers) (25.0)\n",
            "Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub>=0.20.0->sentence-transformers) (6.0.3)\n",
            "Requirement already satisfied: requests in /usr/local/lib/python3.12/dist-packages (from huggingface-hub>=0.20.0->sentence-transformers) (2.32.4)\n",
            "Requirement already satisfied: hf-xet<2.0.0,>=1.1.3 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub>=0.20.0->sentence-transformers) (1.1.10)\n",
            "Requirement already satisfied: annotated-types>=0.6.0 in /usr/local/lib/python3.12/dist-packages (from pydantic!=2.0.*,!=2.1.*,!=2.2.0,>=1.10.8->qdrant-client) (0.7.0)\n",
            "Requirement already satisfied: pydantic-core==2.41.1 in /usr/local/lib/python3.12/dist-packages (from pydantic!=2.0.*,!=2.1.*,!=2.2.0,>=1.10.8->qdrant-client) (2.41.1)\n",
            "Requirement already satisfied: typing-inspection>=0.4.2 in /usr/local/lib/python3.12/dist-packages (from pydantic!=2.0.*,!=2.1.*,!=2.2.0,>=1.10.8->qdrant-client) (0.4.2)\n",
            "Requirement already satisfied: mpmath<1.4,>=1.1.0 in /usr/local/lib/python3.12/dist-packages (from sympy>=1.13.3->torch) (1.3.0)\n",
            "Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.12/dist-packages (from transformers<5.0.0,>=4.41.0->sentence-transformers) (2024.11.6)\n",
            "Requirement already satisfied: tokenizers<=0.23.0,>=0.22.0 in /usr/local/lib/python3.12/dist-packages (from transformers<5.0.0,>=4.41.0->sentence-transformers) (0.22.1)\n",
            "Requirement already satisfied: safetensors>=0.4.3 in /usr/local/lib/python3.12/dist-packages (from transformers<5.0.0,>=4.41.0->sentence-transformers) (0.6.2)\n",
            "Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.12/dist-packages (from jinja2->torch) (3.0.3)\n",
            "Requirement already satisfied: joblib>=1.2.0 in /usr/local/lib/python3.12/dist-packages (from scikit-learn->sentence-transformers) (1.5.2)\n",
            "Requirement already satisfied: threadpoolctl>=3.1.0 in /usr/local/lib/python3.12/dist-packages (from scikit-learn->sentence-transformers) (3.6.0)\n",
            "Requirement already satisfied: hyperframe<7,>=6.1 in /usr/local/lib/python3.12/dist-packages (from h2<5,>=3->httpx[http2]>=0.20.0->qdrant-client) (6.1.0)\n",
            "Requirement already satisfied: hpack<5,>=4.1 in /usr/local/lib/python3.12/dist-packages (from h2<5,>=3->httpx[http2]>=0.20.0->qdrant-client) (4.1.0)\n",
            "Requirement already satisfied: sniffio>=1.1 in /usr/local/lib/python3.12/dist-packages (from anyio->httpx>=0.20.0->httpx[http2]>=0.20.0->qdrant-client) (1.3.1)\n",
            "Requirement already satisfied: charset_normalizer<4,>=2 in /usr/local/lib/python3.12/dist-packages (from requests->huggingface-hub>=0.20.0->sentence-transformers) (3.4.3)\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "4a8a51f3"
      },
      "source": [
        "**Reasoning**:\n",
        "Set up the Qdrant client to connect to Qdrant Cloud using the provided API key and URL, load the embedding model, generate embeddings for the text chunks, and ingest the data into a Qdrant collection."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "id": "67c00f8a"
      },
      "source": [
        "import os\n",
        "from google.colab import userdata\n",
        "from qdrant_client import QdrantClient, models\n",
        "from sentence_transformers import SentenceTransformer\n",
        "import numpy as np\n",
        "\n",
        "# Retrieve Qdrant Cloud API key and URL from Colab secrets\n",
        "QDRANT_API_KEY = userdata.get(\"QDRANT_API_KEY\")\n",
        "QDRANT_URL = userdata.get(\"QDRANT_URL\") # Make sure you have stored your Qdrant Cloud URL here\n",
        "\n",
        "# Initialize Qdrant Client for Qdrant Cloud\n",
        "client = QdrantClient(\n",
        "    url=QDRANT_URL,\n",
        "    api_key=QDRANT_API_KEY\n",
        ")\n",
        "\n"
      ],
      "execution_count": 14,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "# Define collection name\n",
        "collection_name = \"legal_case_summaries\"\n",
        "\n",
        "# Check if collection exists, create if not\n",
        "# Using a smaller vector size (384) for 'all-MiniLM-L6-v2'\n",
        "vector_size = 384\n",
        "if not client.collection_exists(collection_name=collection_name):\n",
        "    client.create_collection(\n",
        "        collection_name=collection_name,\n",
        "        vectors_config=models.VectorParams(size=vector_size, distance=models.Distance.COSINE)\n",
        "    )\n",
        "    print(f\"Collection '{collection_name}' created.\")\n",
        "else:\n",
        "    print(f\"Collection '{collection_name}' already exists.\")\n",
        "\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "UdhJtJ1w0UD7",
        "outputId": "95ee4331-07ab-4d4e-e618-80493f1ff2e2"
      },
      "execution_count": 15,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Collection 'legal_case_summaries' already exists.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# # Ensure the Qdrant client and collection_name are defined\n",
        "# # (Assuming they were defined in previous setup steps)\n",
        "# # client = QdrantClient(...)\n",
        "# # collection_name = \"legal_case_summaries\"\n",
        "\n",
        "# # Clear the existing collection if it exists\n",
        "# if client.collection_exists(collection_name=collection_name):\n",
        "#     client.delete_collection(collection_name=collection_name)\n",
        "#     print(f\"Existing collection '{collection_name}' cleared.\")\n",
        "\n",
        "# # Create the collection again with the appropriate vector parameters\n",
        "# # Using a smaller vector size (384) for 'all-MiniLM-L6-v2'\n",
        "# vector_size = 384\n",
        "# client.create_collection(\n",
        "#     collection_name=collection_name,\n",
        "#     vectors_config=models.VectorParams(size=vector_size, distance=models.Distance.COSINE)\n",
        "# )\n",
        "# print(f\"Collection '{collection_name}' created for new chunks.\")\n",
        "\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "EUhRr3k01MYd",
        "outputId": "4345003c-aca7-4151-fdb5-e0feb94d5749"
      },
      "execution_count": 16,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Existing collection 'legal_case_summaries' cleared.\n",
            "Collection 'legal_case_summaries' created for new chunks.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "model = SentenceTransformer('all-MiniLM-L6-v2')\n",
        "\n",
        "print(\"Generating embeddings for new chunks...\")\n",
        "\n",
        "# Generate embeddings for the text chunks from the new DataFrame\n",
        "# We'll process in batches to manage memory\n",
        "batch_size = 100\n",
        "embeddings = []\n",
        "for i in range(0, len(df), batch_size):\n",
        "    batch_texts = df['text'][i : i + batch_size].tolist()\n",
        "    batch_embeddings = model.encode(batch_texts, show_progress_bar=False)\n",
        "    embeddings.extend(batch_embeddings)\n",
        "\n",
        "embeddings = np.array(embeddings)\n",
        "print(f\"Generated {len(embeddings)} embeddings for the new chunks.\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "DdRdDVydyeIv",
        "outputId": "ac61c438-75a3-4487-b65e-de8138c0c3be"
      },
      "execution_count": 17,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Generating embeddings for new chunks...\n",
            "Generated 46 embeddings for the new chunks.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# Prepare data for ingestion into Qdrant\n",
        "# Each point requires an id, vector, and payload (original text and chunk_id if available)\n",
        "# Assuming the DataFrame has 'chunk_id' and 'text' columns\n",
        "points = [\n",
        "    models.PointStruct(\n",
        "        # Use DataFrame index as id, or chunk_id if unique and preferred\n",
        "        id=idx, # Using index as id for consistency with potential future evaluation based on df index\n",
        "        vector=embedding.tolist(),\n",
        "        payload={\n",
        "            \"text\": row['text'],\n",
        "            \"chunk_id_from_json\": row['chunk_id'] # Store the original chunk_id from the JSON\n",
        "            }\n",
        "    )\n",
        "    for idx, (index, row) in enumerate(df.iterrows())\n",
        "    for embedding in [embeddings[index]] # Get the corresponding embedding\n",
        "]\n",
        "\n",
        "\n",
        "# Ingest points into the Qdrant collection\n",
        "# Use upsert for batching\n",
        "client.upsert(\n",
        "    collection_name=collection_name,\n",
        "    wait=True,\n",
        "    points=points\n",
        ")\n",
        "\n",
        "print(f\"Ingested {len(points)} points into collection '{collection_name}'.\")\n",
        "\n",
        "# Verify the count of points in the collection\n",
        "count_result = client.count(collection_name=collection_name, exact=True)\n",
        "print(f\"Current number of points in collection '{collection_name}': {count_result.count}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "ECODtL1_yvpF",
        "outputId": "1db2bd46-c600-418f-d75b-4c1160a6f0df"
      },
      "execution_count": 18,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Ingested 46 points into collection 'legal_case_summaries'.\n",
            "Current number of points in collection 'legal_case_summaries': 46\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "55fbd141"
      },
      "source": [
        "## Embedding-Based Retrieval: Implementation\n",
        "\n",
        "### Subtask:\n",
        "Implement Dense Retrieval using similarity search on the vector database."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "120bf81b"
      },
      "source": [
        "**Reasoning**:\n",
        "Implement the dense retrieval process by embedding the query and performing a similarity search against the embeddings stored in the Qdrant collection. This demonstrates how semantic similarity is used to find relevant documents."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "2806ae71",
        "outputId": "fbf2092d-c11c-413b-970d-299d3f02a5ad"
      },
      "source": [
        "# Define the query for dense retrieval\n",
        "query = \"requirements for recovering legal fees\"\n",
        "\n",
        "# Generate embedding for the query\n",
        "query_embedding = model.encode(query).tolist()\n",
        "\n",
        "# Perform similarity search in Qdrant\n",
        "# We'll search for the top N most similar points (chunks)\n",
        "top_n = 5\n",
        "search_result = client.search(\n",
        "    collection_name=collection_name,\n",
        "    query_vector=query_embedding,\n",
        "    limit=top_n,\n",
        "    with_payload=True # Include the original text in the results\n",
        ")\n",
        "\n",
        "print(f\"Dense retrieval (similarity search) results for query: '{query}'\")\n",
        "# Display the search results\n",
        "text_snippet_length = 300 # Define snippet length\n",
        "\n",
        "if search_result:\n",
        "    for hit in search_result:\n",
        "        snippet = hit.payload['text'][:text_snippet_length] + '...' if len(hit.payload['text']) > text_snippet_length else hit.payload['text']\n",
        "        print(f\"Document ID: {hit.id}, Score: {hit.score:.4f}\")\n",
        "        print(f\"Snippet: {snippet}\\n\")\n",
        "else:\n",
        "    print(\"No documents found.\")"
      ],
      "execution_count": 19,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Dense retrieval (similarity search) results for query: 'requirements for recovering legal fees'\n",
            "Document ID: 9, Score: 0.5955\n",
            "Snippet: Plant v. Channing , 299 A.D.2d 696, 698 (N.Y. App. Div. 3d Dep't 2002). Upheld a fee arbitration award finding that the attorney was not entitled to any fees based on several violations of the matrimonial rules, including failure to provide a written retainer, failure to provide a statement of clien...\n",
            "\n",
            "Document ID: 21, Score: 0.5867\n",
            "Snippet: Ween v. Dow , 2006 NY Slip Op 7227, 2006 N.Y. App. Div. LEXIS 12033 (First Dept. 2006). The Court framed the issue as: Whether a provision in a retainer agreement, which holds the client liable for attorneys’ fees incurred in the collection of fees generated under the retainer agreement, is void as ...\n",
            "\n",
            "Document ID: 8, Score: 0.5323\n",
            "Snippet: Gahagan v. Gahagan, 51 A.D.3d 863 (N.Y. App. Div. 2d Dep't 2008); Attorney is precluded from recovering legal fees where he or she did not comply with 22 NYCRR 1400.3, requiring attorney to execute and file a retainer agreement that sets forth, inter alia, the terms of compensation and the nature of...\n",
            "\n",
            "Document ID: 26, Score: 0.5306\n",
            "Snippet: Angel v. Greenhaus , 105349/09 (Sup. Ct. NY County 2009). Client requested fee arbitration claiming she was “basically destitute” and unable to pay legal fees. Arbitrators awarded defendant /attorney $22,300.82 in legal fees. Court held that plaintiff’s claim that defendant is not entitled to fees b...\n",
            "\n",
            "Document ID: 5, Score: 0.5270\n",
            "Snippet: Williams v. Jacqueline Jackson , 2005 NY Slip Op 25496; 10 Misc. 3d 58; 809 N.Y.S.2d 771; 2005 N.Y. Misc. LEXIS (App. Term. 2d Dept. 2005).  9 Attorney’s claim for fees in a Mental Hygiene Law article 81 proceeding was dismissed due to attorney’s failure to notify client of right to arbitrate. Supre...\n",
            "\n"
          ]
        },
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "/tmp/ipython-input-1896412414.py:10: DeprecationWarning: `search` method is deprecated and will be removed in the future. Use `query_points` instead.\n",
            "  search_result = client.search(\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "2e90b55d"
      },
      "source": [
        "## Hybrid Retrieval\n",
        "\n",
        "### Subtask:\n",
        "Implement a hybrid retrieval approach combining BM25 and Dense Retrieval."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "f7f93c4c"
      },
      "source": [
        "**Reasoning**:\n",
        "Implement a hybrid retrieval approach, such as Reciprocal Rank Fusion (RRF), to combine the results from BM25 and dense retrieval. This leverages the strengths of both term-frequency and semantic similarity methods to potentially improve overall retrieval performance."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "835ae98b",
        "outputId": "030a83f8-3cbb-4690-dfba-40eed90209ed"
      },
      "source": [
        "# Implement Reciprocal Rank Fusion (RRF)\n",
        "\n",
        "def reciprocal_rank_fusion(results_lists, k=60):\n",
        "    \"\"\"\n",
        "    Performs Reciprocal Rank Fusion on a list of ranked document lists.\n",
        "\n",
        "    Args:\n",
        "        results_lists (list of lists of tuples): Each inner list is a ranked result\n",
        "                                                list from a retrieval method. Each tuple\n",
        "                                                is (document_index, score).\n",
        "        k (int): A constant that reduces the influence of high rankings of\n",
        "                 individual methods.\n",
        "\n",
        "    Returns:\n",
        "        list of tuples: A single ranked list of document indices and their RRF scores.\n",
        "    \"\"\"\n",
        "    fused_scores = {}\n",
        "\n",
        "    for results in results_lists:\n",
        "        for rank, (doc_index, score) in enumerate(results):\n",
        "            if doc_index not in fused_scores:\n",
        "                fused_scores[doc_index] = 0\n",
        "            fused_scores[doc_index] += 1 / (k + rank + 1) # rank + 1 because rank is 0-based\n",
        "\n",
        "    # Sort documents by their fused scores in descending order\n",
        "    reranked_results = sorted(fused_scores.items(), key=lambda item: item[1], reverse=True)\n",
        "\n",
        "    return reranked_results\n",
        "\n",
        "# --- Prepare results from BM25 and Dense Retrieval for RRF ---\n",
        "\n",
        "# BM25 results (using the query from the BM25 step)\n",
        "query_bm25 = \"requirements for recovering legal fees\"\n",
        "tokenized_query_bm25 = word_tokenize(query_bm25.lower())\n",
        "doc_scores_bm25 = bm25.get_scores(tokenized_query_bm25)\n",
        "# Get all document indices and scores, not just top N, for RRF\n",
        "bm25_results_with_scores = [(i, score) for i, score in enumerate(doc_scores_bm25)]\n",
        "# Sort by score to get a ranked list for RRF\n",
        "ranked_bm25_results = sorted(bm25_results_with_scores, key=lambda item: item[1], reverse=True)\n",
        "\n",
        "\n",
        "# Dense Retrieval results (using the query from the Dense Retrieval step)\n",
        "query_dense = \"requirements for recovering legal fees\"\n",
        "query_embedding_dense = model.encode(query_dense).tolist()\n",
        "\n",
        "# Get results from Qdrant - retrieve more than top N for better RRF\n",
        "# Let's retrieve a larger number of results from Qdrant for RRF (e.g., 50 or 100)\n",
        "search_result_dense = client.search(\n",
        "    collection_name=collection_name,\n",
        "    query_vector=query_embedding_dense,\n",
        "    limit=100, # Retrieve more results for RRF\n",
        "    with_payload=True # Include the original text in the results\n",
        ")\n",
        "\n",
        "# Format dense retrieval results as list of (document_index, score) tuples\n",
        "ranked_dense_results = [(hit.id, hit.score) for hit in search_result_dense]\n",
        "\n",
        "# --- Perform RRF ---\n",
        "# Pass the ranked results from each method to RRF\n",
        "combined_results = reciprocal_rank_fusion([ranked_bm25_results, ranked_dense_results])\n",
        "\n",
        "print(\"Hybrid Retrieval (RRF) Results:\")\n",
        "\n",
        "# Display the top N results from the hybrid method\n",
        "top_n_hybrid = 5\n",
        "text_snippet_length = 300\n",
        "\n",
        "if combined_results:\n",
        "    for i, (doc_index, score) in enumerate(combined_results[:top_n_hybrid]):\n",
        "        snippet = df.iloc[doc_index]['text'][:text_snippet_length] + '...' if len(df.iloc[doc_index]['text']) > text_snippet_length else df.iloc[doc_index]['text']\n",
        "        print(f\"Rank: {i+1}, Document Index: {doc_index}, RRF Score: {score:.4f}\")\n",
        "        print(f\"Snippet: {snippet}\\n\")\n",
        "else:\n",
        "    print(\"No documents found.\")"
      ],
      "execution_count": 20,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "/tmp/ipython-input-2652513924.py:48: DeprecationWarning: `search` method is deprecated and will be removed in the future. Use `query_points` instead.\n",
            "  search_result_dense = client.search(\n"
          ]
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Hybrid Retrieval (RRF) Results:\n",
            "Rank: 1, Document Index: 8, RRF Score: 0.0320\n",
            "Snippet: Gahagan v. Gahagan, 51 A.D.3d 863 (N.Y. App. Div. 2d Dep't 2008); Attorney is precluded from recovering legal fees where he or she did not comply with 22 NYCRR 1400.3, requiring attorney to execute and file a retainer agreement that sets forth, inter alia, the terms of compensation and the nature of...\n",
            "\n",
            "Rank: 2, Document Index: 9, RRF Score: 0.0318\n",
            "Snippet: Plant v. Channing , 299 A.D.2d 696, 698 (N.Y. App. Div. 3d Dep't 2002). Upheld a fee arbitration award finding that the attorney was not entitled to any fees based on several violations of the matrimonial rules, including failure to provide a written retainer, failure to provide a statement of clien...\n",
            "\n",
            "Rank: 3, Document Index: 7, RRF Score: 0.0311\n",
            "Snippet: PC v. Finkelstein , NYLJ January 25, 2006, at 19 (NY County Supreme Court). The court denied law firm’s application for reargument because firm had not argued that the dispute fell outside of the Part 137 Program on their prior motion as is required by CPLR 2221(d) 2. The law firm participated in th...\n",
            "\n",
            "Rank: 4, Document Index: 5, RRF Score: 0.0305\n",
            "Snippet: Williams v. Jacqueline Jackson , 2005 NY Slip Op 25496; 10 Misc. 3d 58; 809 N.Y.S.2d 771; 2005 N.Y. Misc. LEXIS (App. Term. 2d Dept. 2005).  9 Attorney’s claim for fees in a Mental Hygiene Law article 81 proceeding was dismissed due to attorney’s failure to notify client of right to arbitrate. Supre...\n",
            "\n",
            "Rank: 5, Document Index: 21, RRF Score: 0.0302\n",
            "Snippet: Ween v. Dow , 2006 NY Slip Op 7227, 2006 N.Y. App. Div. LEXIS 12033 (First Dept. 2006). The Court framed the issue as: Whether a provision in a retainer agreement, which holds the client liable for attorneys’ fees incurred in the collection of fees generated under the retainer agreement, is void as ...\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "987da44e"
      },
      "source": [
        "## Evaluation: Calculating Metrics\n",
        "\n",
        "### Subtask:\n",
        "Calculate Precision@K, Recall@K, and MRR for BM25, Dense, and Hybrid retrieval using the evaluation dataset."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "0ff12a34"
      },
      "source": [
        "**Reasoning**:\n",
        "Use the evaluation dataset loaded from `eval_dataset_conceptual.json`, where `relevant_chunk_ids` align with the indices in the `df` DataFrame. Run each implemented retrieval method with the query from the dataset and calculate the defined evaluation metrics (Precision@K, Recall@K, MRR) to compare their performance."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "id": "62ca4035"
      },
      "source": [
        "# Define Evaluation Metrics Functions\n",
        "\n",
        "def precision_at_k(retrieved_ids, relevant_ids, k):\n",
        "    \"\"\"Calculates Precision@K.\"\"\"\n",
        "    if k == 0:\n",
        "        return 0.0\n",
        "    retrieved_at_k = retrieved_ids[:k]\n",
        "    num_relevant_retrieved = len(set(retrieved_at_k) & set(relevant_ids))\n",
        "    return num_relevant_retrieved / k\n",
        "\n",
        "def recall_at_k(retrieved_ids, relevant_ids, k):\n",
        "    \"\"\"Calculates Recall@K.\"\"\"\n",
        "    if not relevant_ids:\n",
        "        return 1.0 # Or 0.0 depending on how you want to handle queries with no relevant documents\n",
        "    retrieved_at_k = retrieved_ids[:k]\n",
        "    num_relevant_retrieved = len(set(retrieved_at_k) & set(relevant_ids))\n",
        "    return num_relevant_retrieved / len(relevant_ids)\n",
        "\n",
        "def reciprocal_rank(retrieved_ids, relevant_ids):\n",
        "    \"\"\"Calculates Reciprocal Rank.\"\"\"\n",
        "    for rank, doc_id in enumerate(retrieved_ids):\n",
        "        if doc_id in relevant_ids:\n",
        "            return 1.0 / (rank + 1)\n",
        "    return 0.0 # Return 0 if no relevant documents are retrieved\n",
        "\n",
        "# Note: mean_reciprocal_rank function was included in the evaluation cell,\n",
        "# but the individual metric functions are needed first."
      ],
      "execution_count": 21,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "5215f86b",
        "outputId": "235b8f72-7fde-4a47-c736-9e0da6a2600c"
      },
      "source": [
        "import json\n",
        "import pandas as pd\n",
        "from rank_bm25 import BM25Okapi\n",
        "from nltk.tokenize import word_tokenize\n",
        "from qdrant_client import QdrantClient # Assuming client is already initialized\n",
        "from sentence_transformers import SentenceTransformer # Assuming model is already loaded\n",
        "\n",
        "# Load the evaluation dataset\n",
        "eval_dataset_path = './data/eval_dataset_conceptual.json'\n",
        "with open(eval_dataset_path, 'r') as f:\n",
        "    evaluation_dataset = json.load(f)\n",
        "\n",
        "print(f\"Loaded {len(evaluation_dataset)} evaluation queries.\")\n",
        "\n",
        "# Assuming evaluation_dataset is a list of dictionaries like:\n",
        "# [{\"query\": \"...\", \"relevant_chunk_ids\": [id1, id2, ...], \"source_preview\": \"...\"}, ...]\n",
        "\n",
        "# --- Ensure retrieval methods are ready (assuming previous cells were run) ---\n",
        "\n",
        "# BM25 (re-initialize if df was reloaded)\n",
        "# Assuming df is the DataFrame with chunks from legal_chunks_conceptual.json\n",
        "tokenized_corpus = [word_tokenize(doc.lower()) for doc in df['text']]\n",
        "bm25 = BM25Okapi(tokenized_corpus)\n",
        "\n",
        "# Dense Retrieval (assuming client and model is initialized and collection is populated)\n",
        "# client = QdrantClient(...)\n",
        "# model = SentenceTransformer(...)\n",
        "# collection_name = \"legal_case_summaries\"\n",
        "\n",
        "# --- Run retrieval for each query and calculate metrics ---\n",
        "\n",
        "retrieval_results = []\n",
        "\n",
        "for query_data in evaluation_dataset:\n",
        "    query_text = query_data[\"query\"]\n",
        "    # Relevant IDs are strings like 'chunk_0', 'chunk_1' from the JSON\n",
        "    relevant_chunk_ids_from_json = query_data[\"relevant_chunk_ids\"]\n",
        "\n",
        "    print(f\"\\nEvaluating query: '{query_text}'\")\n",
        "    print(f\"Expected relevant chunk IDs (from eval dataset): {relevant_chunk_ids_from_json}\")\n",
        "\n",
        "    # 1. BM25 Retrieval\n",
        "    tokenized_query_bm25 = word_tokenize(query_text.lower())\n",
        "    doc_scores_bm25 = bm25.get_scores(tokenized_query_bm25)\n",
        "    # Get all document indices and scores\n",
        "    bm25_results_with_scores = [(i, score) for i, score in enumerate(doc_scores_bm25)]\n",
        "    # Sort by score to get a ranked list\n",
        "    ranked_bm25_results = sorted(bm25_results_with_scores, key=lambda item: item[1], reverse=True)\n",
        "    # Get the ranked indices and their corresponding original chunk_ids for evaluation\n",
        "    ranked_bm25_indices_and_ids = [(item[0], df.iloc[item[0]]['chunk_id']) for item in ranked_bm25_results]\n",
        "    ranked_bm25_indices = [item[0] for item in ranked_bm25_indices_and_ids] # For functions expecting just indices\n",
        "\n",
        "\n",
        "    # 2. Dense Retrieval\n",
        "    query_embedding_dense = model.encode(query_text).tolist()\n",
        "    # Retrieve a sufficient number of results to cover potential relevant items\n",
        "    # User requested to use the embedding list directly\n",
        "    search_result_dense = client.query_points(\n",
        "        collection_name=collection_name,\n",
        "        query=query_embedding_dense, # Using the embedding list directly\n",
        "        limit=len(df), # Retrieve up to the total number of chunks to calculate metrics correctly\n",
        "        with_payload=True # Include payload to get chunk_id_from_json\n",
        "    )\n",
        "    # Format dense retrieval results as list of (document_index, score, original_chunk_id) tuples\n",
        "    # Note: query_points results are in search_result_dense.points\n",
        "    ranked_dense_results_with_ids = [(hit.id, hit.score, hit.payload.get('chunk_id_from_json')) for hit in search_result_dense.points]\n",
        "    ranked_dense_indices = [item[0] for item in ranked_dense_results_with_ids] # For functions expecting just indices\n",
        "\n",
        "\n",
        "    # 3. Hybrid Retrieval (RRF)\n",
        "    # RRF is calculated on ranked lists of (document_index, score)\n",
        "    # We'll use the index-score pairs from BM25 and Dense retrieval for RRF input\n",
        "    # Note: RRF operates on indices, not original chunk_ids\n",
        "    combined_results_rrf = reciprocal_rank_fusion([ranked_bm25_results, ranked_dense_results])\n",
        "    # Get the ranked indices and their corresponding original chunk_ids for evaluation\n",
        "    ranked_hybrid_indices_and_ids = [(item[0], df.iloc[item[0]]['chunk_id']) for item in combined_results_rrf]\n",
        "    ranked_hybrid_indices = [item[0] for item in ranked_hybrid_indices_and_ids] # For functions expecting just indices\n",
        "\n",
        "\n",
        "    # --- Calculate Metrics for each method ---\n",
        "\n",
        "    # Define K for Precision and Recall\n",
        "    k_value = 10 # You can adjust K\n",
        "\n",
        "    # For metric calculation, we need the list of *retrieved original chunk_ids*\n",
        "    # to compare against the relevant_chunk_ids_from_json\n",
        "\n",
        "    retrieved_bm25_chunk_ids_at_k = [chunk_id for index, chunk_id in ranked_bm25_indices_and_ids[:k_value]]\n",
        "    retrieved_dense_chunk_ids_at_k = [chunk_id for index, score, chunk_id in ranked_dense_results_with_ids[:k_value]]\n",
        "    retrieved_hybrid_chunk_ids_at_k = [chunk_id for index, chunk_id in ranked_hybrid_indices_and_ids[:k_value]]\n",
        "\n",
        "    # For MRR, we need the ranked list of *retrieved original chunk_ids*\n",
        "    ranked_bm25_chunk_ids_full = [chunk_id for index, chunk_id in ranked_bm25_indices_and_ids]\n",
        "    ranked_dense_chunk_ids_full = [chunk_id for index, score, chunk_id in ranked_dense_results_with_ids]\n",
        "    ranked_hybrid_chunk_ids_full = [chunk_id for index, chunk_id in ranked_hybrid_indices_and_ids]\n",
        "\n",
        "\n",
        "    metrics = {\n",
        "        \"query\": query_text,\n",
        "        \"relevant_ids\": relevant_chunk_ids_from_json, # Use the string chunk_ids from the JSON\n",
        "        \"BM25\": {},\n",
        "        \"Dense\": {},\n",
        "        \"Hybrid\": {}\n",
        "    }\n",
        "\n",
        "    # Calculate BM25 metrics using original chunk_ids\n",
        "    metrics[\"BM25\"][\"Precision@K\"] = precision_at_k(retrieved_bm25_chunk_ids_at_k, relevant_chunk_ids_from_json, k_value)\n",
        "    metrics[\"BM25\"][\"Recall@K\"] = recall_at_k(retrieved_bm25_chunk_ids_at_k, relevant_chunk_ids_from_json, k_value)\n",
        "    metrics[\"BM25\"][\"MRR\"] = reciprocal_rank(ranked_bm25_chunk_ids_full, relevant_chunk_ids_from_json)\n",
        "\n",
        "    # Calculate Dense metrics using original chunk_ids\n",
        "    metrics[\"Dense\"][\"Precision@K\"] = precision_at_k(retrieved_dense_chunk_ids_at_k, relevant_chunk_ids_from_json, k_value)\n",
        "    metrics[\"Dense\"][\"Recall@K\"] = recall_at_k(retrieved_dense_chunk_ids_at_k, relevant_chunk_ids_from_json, k_value)\n",
        "    metrics[\"Dense\"][\"MRR\"] = reciprocal_rank(ranked_dense_chunk_ids_full, relevant_chunk_ids_from_json)\n",
        "\n",
        "    # Calculate Hybrid metrics using original chunk_ids\n",
        "    metrics[\"Hybrid\"][\"Precision@K\"] = precision_at_k(retrieved_hybrid_chunk_ids_at_k, relevant_chunk_ids_from_json, k_value)\n",
        "    metrics[\"Hybrid\"][\"Recall@K\"] = recall_at_k(retrieved_hybrid_chunk_ids_at_k, relevant_chunk_ids_from_json, k_value)\n",
        "    metrics[\"Hybrid\"][\"MRR\"] = reciprocal_rank(ranked_hybrid_chunk_ids_full, relevant_chunk_ids_from_json)\n",
        "\n",
        "\n",
        "    retrieval_results.append(metrics)\n",
        "\n",
        "\n",
        "# --- Display Evaluation Results ---\n",
        "\n",
        "print(\"\\n--- Evaluation Results ---\")\n",
        "for result in retrieval_results:\n",
        "    print(f\"Query: {result['query']}\")\n",
        "    print(f\"  Relevant Chunk IDs: {result['relevant_ids']}\")\n",
        "    print(f\"  BM25: Precision@{k_value}={result['BM25']['Precision@K']:.4f}, Recall@{k_value}={result['BM25']['Recall@K']:.4f}, MRR={result['BM25']['MRR']:.4f}\")\n",
        "    print(f\"  Dense: Precision@{k_value}={result['Dense']['Precision@K']:.4f}, Recall@{k_value}={result['Dense']['Recall@K']:.4f}, MRR={result['Dense']['MRR']:.4f}\")\n",
        "    print(f\"  Hybrid: Precision@{k_value}={result['Hybrid']['Precision@K']:.4f}, Recall@{k_value}={result['Hybrid']['Recall@K']:.4f}, MRR={result['Hybrid']['MRR']:.4f}\")\n",
        "    print(\"-\" * 20)\n",
        "\n",
        "# Optional: Calculate average metrics across all queries if you have more than one\n",
        "if len(evaluation_dataset) > 1:\n",
        "    avg_metrics = {\n",
        "        \"BM25\": {\"Precision@K\": 0, \"Recall@K\": 0, \"MRR\": 0},\n",
        "        \"Dense\": {\"Precision@K\": 0, \"Recall@K\": 0, \"MRR\": 0},\n",
        "        \"Hybrid\": {\"Precision@K\": 0, \"Recall@K\": 0, \"MRR\": 0}\n",
        "    }\n",
        "    for result in retrieval_results:\n",
        "        avg_metrics[\"BM25\"][\"Precision@K\"] += result[\"BM25\"][\"Precision@K\"]\n",
        "        avg_metrics[\"BM25\"][\"Recall@K\"] += result[\"BM25\"][\"Recall@K\"]\n",
        "        avg_metrics[\"BM25\"][\"MRR\"] += result[\"BM25\"][\"MRR\"]\n",
        "        avg_metrics[\"Dense\"][\"Precision@K\"] += result[\"Dense\"][\"Precision@K\"]\n",
        "        avg_metrics[\"Dense\"][\"Recall@K\"] += result[\"Dense\"][\"Recall@K\"]\n",
        "        avg_metrics[\"Dense\"][\"MRR\"] += result[\"Dense\"][\"MRR\"]\n",
        "        avg_metrics[\"Hybrid\"][\"Precision@K\"] += result[\"Hybrid\"][\"Precision@K\"]\n",
        "        avg_metrics[\"Hybrid\"][\"Recall@K\"] += result[\"Hybrid\"][\"Recall@K\"]\n",
        "        avg_metrics[\"Hybrid\"][\"MRR\"] += result[\"Hybrid\"][\"MRR\"]\n",
        "\n",
        "    num_queries = len(evaluation_dataset)\n",
        "    print(\"\\n--- Average Evaluation Results ---\")\n",
        "    print(f\"  BM25: Precision@{k_value}={avg_metrics['BM25']['Precision@K']/num_queries:.4f}, Recall@{k_value}={avg_metrics['BM25']['Recall@K']/num_queries:.4f}, MRR={avg_metrics['BM25']['MRR']:.4f}\")\n",
        "    print(f\"  Dense: Precision@{k_value}={avg_metrics['Dense']['Precision@K']/num_queries:.4f}, Recall@{k_value}={avg_metrics['Dense']['Recall@K']/num_queries:.4f}, MRR={avg_metrics['Dense']['MRR']:.4f}\")\n",
        "    print(f\"  Hybrid: Precision@{k_value}={avg_metrics['Hybrid']['Precision@K']/num_queries:.4f}, Recall@{k_value}={avg_metrics['Hybrid']['Recall@K']/num_queries:.4f}, MRR={avg_metrics['Hybrid']['MRR']:.4f}\")\n",
        "    print(\"-\" * 20)"
      ],
      "execution_count": 30,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Loaded 138 evaluation queries.\n",
            "\n",
            "Evaluating query: '1. What are the rules governing a lawyer's obligation to notify clients of their right to participate in the Attorney-Client Fee Arbitration Program in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_0']\n",
            "\n",
            "Evaluating query: '2. Under what circumstances can an attorney's pleading requirement be waived or modified according to Part 137 and 137.6(b) in New York's Attorney-Client Fee Arbitration Program?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_0']\n",
            "\n",
            "Evaluating query: '3. In the context of post-award procedures, what are the grounds for challenging a fee arbitration award in New York, and how does CPLR Article 75 come into play?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_0']\n",
            "\n",
            "Evaluating query: '1. What are the requirements for an attorney seeking to recover fees and disbursements in actions related to the enforcement of divorce judgements under Part 136, as established in Herrick v. Lyon?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_1']\n",
            "\n",
            "Evaluating query: '2. In fee disputes covered by Part 137, what factors must be considered when determining whether an outgoing attorney is entitled to a fee after being discharged (allegedly for cause) and asserting a retaining lien?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_1']\n",
            "\n",
            "Evaluating query: '3. What are the consequences for an attorney who fails to provide notice of a client's right to arbitrate under Part 136, as discussed in Scordio v. Scordio, Paikin v. Tsirelman, and Rotker v. Rotker?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_1']\n",
            "\n",
            "Evaluating query: '1. What are the rules regarding an attorney's obligation to provide a client with notice of the right to arbitrate fee disputes in matrimonial cases, and what happens if this obligation is not met?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_2']\n",
            "\n",
            "Evaluating query: '2. Can an attorney rely on the principle of an account stated as a basis for summary judgment in a fee dispute case, and under what circumstances would a court consider an account stated to be implied?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_2']\n",
            "\n",
            "Evaluating query: '3. In a situation where a fee dispute is pending in an arbitration program, can an attorney file a separate action in City Court challenging the constitutionality of the fee dispute program on grounds such as equal protection and right to jury trial? If so, what are the potential outcomes for such actions?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_2']\n",
            "\n",
            "Evaluating query: '1. What are the requirements for an attorney to provide notice of a client's right to arbitrate under Part 137 in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_3']\n",
            "\n",
            "Evaluating query: '2. How should retainer agreements be construed in relation to matrimonial rules governing retainers, fee disputes, and arbitration in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_3']\n",
            "\n",
            "Evaluating query: '3. In cases involving multiple matters, how is the amount in dispute calculated for purposes of determining if Part 136 applies in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_3']\n",
            "\n",
            "Evaluating query: '1. What are the circumstances under which a court will view multiple fee disputes in aggregate, and how does this impact the applicability of New York's Part 137?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_4']\n",
            "\n",
            "Evaluating query: '2. In cases where an attorney represents a client in a criminal matter, is it possible for the client to invoke the right to arbitration as provided by Part 137? If not, what are the specific reasons that prevent this invocation?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_4']\n",
            "\n",
            "Evaluating query: '3. When is it deemed a violation of public policy or against the purpose of New York's Part 137 for an attorney to avoid compliance with its requirements by stating that the client will allege malpractice? Under what circumstances would it be appropriate for the \"Local Administrative Body\" to determine if malpractice is inextricably intertwined with a client's claim for payment?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_4']\n",
            "\n",
            "Evaluating query: '1. What are the requirements for an attorney to notify their client of the right to arbitrate fees in a Mental Hygiene Law article 81 proceeding?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_5']\n",
            "\n",
            "Evaluating query: '2. In a proceeding pursuant to SCPA 2110, what is the Surrogate's responsibility regarding deciding a reasonable legal fee and how does this impact the existence of a retainer agreement or party consent?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_5']\n",
            "\n",
            "Evaluating query: '3. Under Part 137, which disputes are considered substantial legal questions and how should an attorney plead these exceptions when defending against a termination letter for cause and malpractice?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_5']\n",
            "\n",
            "Evaluating query: '1. What are the requirements for a New York attorney seeking to recover fees from clients in a New York court, regarding the pleading of an exception to the New York State Fee Dispute Resolution Program?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_6']\n",
            "\n",
            "Evaluating query: '2. In cases where a fee dispute falls outside the monetary jurisdiction of Part 137, what specific allegations must be made by the plaintiff attorney in the complaint to avoid dismissal?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_6']\n",
            "\n",
            "Evaluating query: '3. If a fee dispute is found to fall outside the scope of Part 137, but the plaintiff attorney fails to allege as such in the complaint, what legal consequence does this omission have on the case?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_6']\n",
            "\n",
            "Evaluating query: '1. What are the rules that a matrimonial lawyer must follow in New York regarding filing and compliance to be eligible for fee recovery?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_7']\n",
            "\n",
            "Evaluating query: '2. Can a law firm apply for reargument if they failed to argue that the dispute falls outside of the Part 137 Program on their prior motion as required by CPLR 2221(d)?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_7']\n",
            "\n",
            "Evaluating query: '3. In the context of fee disputes, what is the legal principle regarding substantial compliance and how does it apply to attorneys in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_7']\n",
            "\n",
            "Evaluating query: '1. What are the specific requirements outlined in 22 NYCRR 1400.3 that an attorney must comply with in order to recover legal fees in matrimonial cases in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_8']\n",
            "\n",
            "Evaluating query: '2. Can an attorney recover legal fees if there is substantial, but not complete, compliance with the rules regarding retainer agreements in matrimonial cases as outlined in 22 NYCRR 1400.3?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_8']\n",
            "\n",
            "Evaluating query: '3. In a matrimonial fee arbitration case, what factors does an arbitrator consider when determining an appropriate reduction of attorney's fees due to partial noncompliance with the rules outlined in 22 NYCRR Part 1400?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_8']\n",
            "\n",
            "Evaluating query: '1. What are the specific rules that attorneys in New York must comply with regarding providing clients with a written retainer, statement of client's rights and responsibilities, and timely itemized bills in matrimonial cases?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_9']\n",
            "\n",
            "Evaluating query: '2. Under what circumstances can an arbitrator in New York deviate from strict compliance with the rules related to attorney-client fee agreements in matrimonial cases, according to Edelstein v. Greisman case?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_9']\n",
            "\n",
            "Evaluating query: '3. In a case challenging the confirmation of a fee arbitration award, what evidence might be sufficient for a court to find that an attorney has substantially complied with the rules and is entitled to his fee, as demonstrated in 15 aff’d and Edelstein v. Greisman cases?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_9']\n",
            "\n",
            "Evaluating query: '1. What are the legal requirements for a lawyer to recover fees after an arbitration proceeding in New York, considering cases such as Jones v. Wright and Gamaliel v Papadopoulos-Vlantes?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_10']\n",
            "\n",
            "Evaluating query: '2. Under what circumstances can a lawyer be barred from retaining legal fees due to lack of a letter of engagement, according to the case Rubenstein?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_10']\n",
            "\n",
            "Evaluating query: '3. In situations where a client and a lawyer had previously participated in arbitration, is it necessary for the client to agree with the award before it becomes enforceable, considering the case Gamaliel v Papadopoulos-Vlantes?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_10']\n",
            "\n",
            "Evaluating query: '1. What are the specific rules regarding the filing of a trial de novo in Part 137 arbitrations, and under what circumstances can a court exercise discretion to excuse a late filing? (Stodolski v. Wisselman)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_11']\n",
            "\n",
            "Evaluating query: '2. In cases where a client seeks a declaration that a Part 137 arbitration award is invalid or void, what are the necessary allegations concerning the merits of the underlying fee dispute that must be included in the complaint? (Matter of Gold, Stewart, Kravitz, Benes, LLP)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_11']\n",
            "\n",
            "Evaluating query: '3. What jurisdictional limitations apply to actions for declaratory relief from a Part 137 arbitration award, and has this changed following any recent amendments or court decisions? (DeFilippo v. Gerbino)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_11']\n",
            "\n",
            "Evaluating query: '1. What are the specific requirements for a party to initiate de novo judicial review following a Part 137 arbitration decision, as outlined in Borgus v. Marianetti?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_12']\n",
            "\n",
            "Evaluating query: '2. In the context of a fee dispute, what constitutes the commencement of an action on the merits in a court of competent jurisdiction within the meaning of 137.8(a), according to Pruzan v. Levine?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_12']\n",
            "\n",
            "Evaluating query: '3. Can a party seek to set aside an arbitrator's award after the 30-day period following receipt of the award, and under what circumstances might this be granted, as per Pruzan v. Levine and related cases?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_12']\n",
            "\n",
            "Evaluating query: '1. What are the legal requirements for a de novo review of an arbitration award in New York, and under what circumstances can a court treat an action for declaratory relief as a request for such review?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_13']\n",
            "\n",
            "Evaluating query: '2. In New York, what is the admissibility status of an arbitration award during a trial de novo, and how should invoices be presented to support an attorney's claim for fees in this context?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_13']\n",
            "\n",
            "Evaluating query: '3. What are the grounds for vacating an arbitration award under CPLR 7511 in New York, and when is the time period for seeking de novo review absolute and not subject to judicial discretion?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_13']\n",
            "\n",
            "Evaluating query: '1. What are the rules and criteria for vacating a default judgment in a fee arbitration case under Part 137, considering the factors that may be considered in the interest of justice?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_14']\n",
            "\n",
            "Evaluating query: '2. In a trial de novo from a Part 137 fee arbitration, what is the time limit for filing a complaint in NYC Civil Court, and what consequences can arise if the deadline is missed?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_14']\n",
            "\n",
            "Evaluating query: '3. When does a court lack \"single act jurisdiction\" over attorneys pursuant to New York's long-arm statute, and how is this relevant to a breach of contract claim arising from a transaction in the City of New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_14']\n",
            "\n",
            "Evaluating query: '1. What are the jurisdictional limits for confirming an arbitrator's award in New York, as determined in the case of Sachs v. Zito?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_15']\n",
            "\n",
            "Evaluating query: '2. In what circumstances can a client seek to vacate an arbitrator’s decision in favor of an attorney, and under what conditions might the client waive the right to a trial de novo, as outlined in Del Vecchio & Recine, LLP v. Udell?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_15']\n",
            "\n",
            "Evaluating query: '3. Under what circumstances is a refusal or failure by an arbitrator to accept evidence considered judicially reviewable, and how does this relate to Maross Const., Inc. v. Central New York Regional Transp. Authority?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_15']\n",
            "\n",
            "Evaluating query: '1. What are the specific circumstances under which a client can vacate an arbitration award in New York, as outlined in CPLR 7511 and Part 137 rules?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_16']\n",
            "\n",
            "Evaluating query: '2. In what instances is an arbitrator not required to provide explicit reasons for their decision in New York, and how does this affect the vacating of awards under Article 75?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_16']\n",
            "\n",
            "Evaluating query: '3. Under what circumstances can a personal recording device be used during arbitration proceedings in New York, as addressed by NYCLA rules and case law such as 22 Meyers v. Sorote ?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_16']\n",
            "\n",
            "Evaluating query: '1. What are the legal requirements for a waiver of the right to reject an arbitration award and subsequently commence a trial de novo in court?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_17']\n",
            "\n",
            "Evaluating query: '2. In what circumstances can personal jurisdiction be challenged due to improper service during a client's action for de novo review?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_17']\n",
            "\n",
            "Evaluating query: '3. Can a retainer agreement render an arbitration award final and binding, thus preventing a client from seeking a trial de novo, without containing specific waiver language as prescribed by the Board of Governors?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_17']\n",
            "\n",
            "Evaluating query: '1. What are the key considerations for a court when determining the fairness and reasonableness of an attorney-client fee contract, as outlined in Jacobson v. Sassower and Smitas v. Rickett cases?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_18']\n",
            "\n",
            "Evaluating query: '2. In the context of a retainer agreement between parties, what specific language is required to validly waive the right to trial de novo, as explained in LLP v. Altman?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_18']\n",
            "\n",
            "Evaluating query: '3. How does the New York court interpret ambiguity in attorney-client fee agreements, as demonstrated in Jacobson v. Sassower and related to the principle of construing ambiguity against the party who drafted the agreement?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_18']\n",
            "\n",
            "Evaluating query: '1. What are the specific requirements for waiver of the right to arbitration under Part 137 in New York, as outlined in Pascazi Law Offices, PLLC v Pioneer Natural Pools, Inc.?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_19']\n",
            "\n",
            "Evaluating query: '2. In what circumstances is it permissible for an attorney to commence a legal action for unpaid fees without complying with Part 137 rules, according to the case Doniger & Engstrand, LLP v. Carlomagno?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_19']\n",
            "\n",
            "Evaluating query: '3. How does a court determine if there has been a valid waiver of the right to arbitrate in the context of legal fee disputes, as per the Appellate Term's ruling in Doniger & Engstrand, LLP v. Carlomagno?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_19']\n",
            "\n",
            "Evaluating query: '1. What are the requirements for an arbitration panel's award to be considered valid in a Part 136 arbitration under New York law?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_20']\n",
            "\n",
            "Evaluating query: '2. In a fee dispute, what circumstances may justify vacating an arbitrator's award under the principle that the award must have a \"rational, plausible basis founded upon the recited evidence and testimony presented\"?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_20']\n",
            "\n",
            "Evaluating query: '3. When arbitrating fees between a New York law firm and an out-of-state client, what factors might influence whether claims over fees can be arbitrated under Part 137 or an alternative arbitration agreement?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_20']\n",
            "\n",
            "Evaluating query: '1. What are the specific rules regarding the recovery of attorneys' fees in collection actions based on retainer agreements, given the principles outlined in Ween v. Dow?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_21']\n",
            "\n",
            "Evaluating query: '2. Are there limitations on a lawyer's ability to recover legal fees associated with enforcing a charging lien or seeking to recover fees, as discussed in Newkirk v. Fourmen Construction Inc.?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_21']\n",
            "\n",
            "Evaluating query: '3. In what circumstances can an attorney move within a matrimonial action to secure a charging lien and bypass the arbitration notice provisions, according to Sprole v. Sprole? Are there any specific conditions related to the disputed fees amount in such cases?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_21']\n",
            "\n",
            "Evaluating query: '1. What are the rules regarding an attorney's right to a prompt hearing to fix the amount of a retaining lien, and under what circumstances should this matter be determined by arbitration pursuant to Part 137?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_22']\n",
            "\n",
            "Evaluating query: '2. In cases where the fee has been set by court order, is there an exemption from arbitration as per Part 137 for disputes regarding attorney fees? If so, under what conditions does this exemption apply?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_22']\n",
            "\n",
            "Evaluating query: '3. When does an account stated exist between a party and their attorney according to New York law, and what are the implications for the attorney's fee and lien rights in such cases?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_22']\n",
            "\n",
            "Evaluating query: '1. What are the specific circumstances under which a client can bring a subsequent malpractice claim against an attorney after a fee arbitration, following the rules outlined in Soni v. Pryor and Mahler?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_23']\n",
            "\n",
            "Evaluating query: '2. In what situations may a client be collaterally estopped from bringing a subsequent malpractice action against an attorney who was awarded partial fees in a Part 137 arbitration, as per the court's decision in Mahler?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_23']\n",
            "\n",
            "Evaluating query: '3. How do legal proceedings differ when a client files a complaint with the Grievance Committee and it is referred to a local bar association’s voluntary fee-dispute arbitration program, as seen in Altamore v. Friedman (Part 136)?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_23']\n",
            "\n",
            "Evaluating query: '1. What are the legal principles governing whether a fee dispute between an attorney and client falls under Part 136 or Part 137 in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_24']\n",
            "\n",
            "Evaluating query: '2. Can a court award pre-award interest on an arbitration award in a case governed by New York's Part 137 rules, and if so, what are the conditions for such an award?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_24']\n",
            "\n",
            "Evaluating query: '3. How does collateral estoppel apply in cases where an arbitrator awards attorney fees, potentially barring subsequent malpractice actions against the attorney? Are there any exceptions to this rule?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_24']\n",
            "\n",
            "Evaluating query: '1. What are the guidelines for an arbitrator in determining whether interest should be allowed from the time of breach in a fee dispute case, as established in Meyers v. Sorote?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_25']\n",
            "\n",
            "Evaluating query: '2. Under what circumstances can an arbitration panel exceed its authority, as illustrated by Attorney Representation 33 Prudential Equity Group, Llc v. Ajamie?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_25']\n",
            "\n",
            "Evaluating query: '3. In what circumstances does the informality of an arbitration process prevent the application of the rule that prohibits the unauthorized practice of law, as discussed in the case involving a non-New York lawyer participating in a NYSE arbitration in New York?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_25']\n",
            "\n",
            "Evaluating query: '1. What are the legal principles governing the awarding of attorney fees in a fee arbitration case, as demonstrated in Angel v. Greenhaus?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_26']\n",
            "\n",
            "Evaluating query: '2. In what circumstances can a court lower the rate of interest on unpaid legal fees, and what factors may be considered in determining if such a reduction is warranted, as per Kutner v. Antonacci?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_26']\n",
            "\n",
            "Evaluating query: '3. When assessing the reasonableness of interest rates on unpaid legal fees, how do courts typically consider pre/post judgment interest accrual rates and other relevant market rates, as shown in Agovino & Asselta, LLP v. Ruben?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_26']\n",
            "\n",
            "Evaluating query: '1. What are the key considerations for a lawyer when seeking attorney's fees in a New York arbitration proceeding, as outlined in Altamore v. Friedman?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_27']\n",
            "\n",
            "Evaluating query: '2. How does the New York Court interpret conflicts of interest within law firms during fee disputes, as demonstrated in Borah, Goldstein, Altschuler, Schwartz, & Nahins?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_27']\n",
            "\n",
            "Evaluating query: '3. In a legal malpractice claim, how can a plaintiff prove that the attorney's breach of duty caused specific damages, and what factors may affect the recovery of fees in such cases, as per Bartning v. Bartning (2 separate questions combined)?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_27']\n",
            "\n",
            "Evaluating query: '1. What are the specific rules governing attorney-client fee disputes in New York, as interpreted in the case of Borgus v. Marianetti?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_28']\n",
            "\n",
            "Evaluating query: '2. In cases of arbitration between attorneys and clients regarding fees, what factors have been considered significant in determining whether a client waived their right to contest fees, as outlined in 17 F-P v. E.L.P?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_28']\n",
            "\n",
            "Evaluating query: '3. Under what circumstances can a law firm pursue a malpractice claim against a former client for unpaid legal fees, and how did the court rule on this issue in the case of 8 Calendar, PC v. Edwards?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_28']\n",
            "\n",
            "Evaluating query: '1. What are the key factors considered by arbitrators in determining reasonable attorney fees for legal services provided under New York law? (e.g., DeFilippo v. Gerbino)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_29']\n",
            "\n",
            "Evaluating query: '2. Can a client file a fee arbitration claim against their former attorney more than once, and if not, what are the implications for the attorney-client relationship in such cases? (e.g. 17 Del Vecchio & Recine, LLP v. Udell)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_29']\n",
            "\n",
            "Evaluating query: '3. Under New York law, when is an attorney entitled to recover unpaid legal fees through a fee arbitration process, and what factors may impact the decision on whether fees are reasonable or excessive? (e.g., DeLisi v. The Law Offices of Capetola & LLP v. Carlomagno)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_29']\n",
            "\n",
            "Evaluating query: '1. What are the key legal principles regarding attorney-client fee disputes in New York, as established by the case of Edelman v. Poster?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_30']\n",
            "\n",
            "Evaluating query: '2. In cases involving attorney-client fee disputes, what factors were considered significant in determining a reasonable fee, as described in the decision of Eiseman Levine Lehrhaupt & Kakoyiannis, PC v. Torino Jewelers, Ltd.?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_30']\n",
            "\n",
            "Evaluating query: '3. What rules and regulations govern attorney-client fee arbitration proceedings in New York, as outlined in Feder, Goldstein, Errico v. Ronan?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_30']\n",
            "\n",
            "Evaluating query: '1. What are the key legal principles governing attorney-client fee disputes in New York arbitration cases, as illustrated by the cases: Ferst v. Abraham, Finn v. Anderson, and Finn v. Zinn?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_31']\n",
            "\n",
            "Evaluating query: '2. How has the court interpreted the rules for filing limits in attorney-client fee arbitrations in New York, as demonstrated by the case summaries of Friedman v. Vuksanovic?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_31']\n",
            "\n",
            "Evaluating query: '3. In cases involving attorney-client fee disputes, what factors does the court consider when determining whether a client waived their right to arbitration, as suggested by the cases: Ferst v. Abraham and Finn v. Zinn?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_31']\n",
            "\n",
            "Evaluating query: '1. What are the key factors that a court considers when determining the reasonableness of attorney fees in a fee arbitration case, as illustrated in Gahagan v. Gahagan?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_32']\n",
            "\n",
            "Evaluating query: '2. In cases involving a dispute over attorney-client fee agreements, what procedural requirements must be followed to enforce or challenge a retainer agreement during an arbitration proceeding, according to Gary Friedman, P.C. v O'Neill?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_32']\n",
            "\n",
            "Evaluating query: '3. How does New York law address the situation where a client seeks to recover attorney fees from a third party under a contingency fee agreement, and what factors are considered in determining whether such recovery is appropriate, as per Goldfarb v. Hoffman?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_32']\n",
            "\n",
            "Evaluating query: '1. What are the key factors considered in determining whether a lawyer is entitled to recover contingent fees in New York attorney-client fee arbitration cases, as demonstrated in Gottlieb v. Marusya and Jaffe Ross & Light, LLP v Mann?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_33']\n",
            "\n",
            "Evaluating query: '2. In what circumstances can a client be prohibited from bringing multiple attorney-client fee disputes against the same attorney, and how was this issue addressed in Herrick v. Lyon and Hunt v. Hunt?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_33']\n",
            "\n",
            "Evaluating query: '3. What are the legal considerations for determining whether a lawyer's actions warrant the reduction or denial of requested fees, as discussed in Herrick v. Lyon, Jewell v. Iyer, and Hunt v. Hunt?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_33']\n",
            "\n",
            "Evaluating query: '1. What are the key legal principles governing attorney-client fee disputes, as established in the case of Jones v. Wright?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_34']\n",
            "\n",
            "Evaluating query: '2. In a scenario where a lawyer's fee dispute with a client arises during an ongoing representation, what are the potential implications for the attorney-client relationship and the arbitration process, according to Julien v Machson (two cases)?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_34']\n",
            "\n",
            "Evaluating query: '3. How does New York law handle situations where a law firm seeks recovery of unpaid fees from a former client, particularly in light of the case Kayden v Kayden?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_34']\n",
            "\n",
            "Evaluating query: '1. \"What are the key legal principles governing attorney-client fee disputes in New York, as outlined in cases such as Kutner v. Antonacci and Larrison v. Scarola Reavis & Parent LLP?\"'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_35']\n",
            "\n",
            "Evaluating query: '2. \"In what circumstances can a client challenge an attorney's fees in New York arbitration, according to case law like Lorin v. 501 Second Street LLC and Dorothy Nash and Glasser v. Kenmore Property, LLC?\"'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_35']\n",
            "\n",
            "Evaluating query: '3. \"What are the potential limitations on the number of times a client can initiate fee arbitration against an attorney in New York, as suggested by the cases Landa v. Dratch and the provided case summaries?\"'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_35']\n",
            "\n",
            "Evaluating query: '1. What are the key factors considered in determining attorney-client fee recovery under New York law? (Louissaint v. DePaolo)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_36']\n",
            "\n",
            "Evaluating query: '2. How does New York law handle arbitration rights and proceedings for legal malpractice claims between a lawyer and client? (2 Macnish-Lenox, LLC, v. Simpson)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_36']\n",
            "\n",
            "Evaluating query: '3. In cases involving the termination of an attorney-client relationship, what are the factors considered when determining whether the attorney is entitled to fees incurred up until the termination? (35 Mahl v. Rand)'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_36']\n",
            "\n",
            "Evaluating query: '1. What are the key legal principles governing attorney-client fee disputes in New York arbitration, as illustrated in cases such as Gretz v. Goldman and Matter of Jo D. Talbot?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_37']\n",
            "\n",
            "Evaluating query: '2. How does New York law determine the appropriate filing limit for attorney-client fee arbitrations, considering cases like Matter of Raymond E. Kerno and Matter of Sciandra v Palmer?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_37']\n",
            "\n",
            "Evaluating query: '3. In what circumstances might a client's obligation to pay attorneys' fees be waived in New York, as suggested by the cases MBNA America Bank, A. v. Sally Coe and McNamee, Lochner, C. v. Bethany M. Killeen?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_37']\n",
            "\n",
            "Evaluating query: '1. What are the key legal principles regarding attorney-client fee disputes in arbitration proceedings, as outlined in Meyers v. Sorote and LLP v. Altman?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_38']\n",
            "\n",
            "Evaluating query: '2. In cases involving lawyer disqualification due to conflicts of interest, what factors are typically considered by courts, as shown in Moraitis v Moraitis and Ostrolenk v. Christopher?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_38']\n",
            "\n",
            "Evaluating query: '3. Under what circumstances can a law firm seek recovery of unpaid attorney fees against a client, and what limitations may apply, based on the cases Newkirk v. Fourmen Construction Inc. and 22, 32 MINTZ & GOLD LLP, v. DAIBES?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_38']\n",
            "\n",
            "Evaluating query: '1. What are the key factors that a court considers when determining whether an attorney is entitled to recover fees in a contingency fee agreement, as outlined in Paikin v. Tsirelman?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_39']\n",
            "\n",
            "Evaluating query: '2. In cases involving disputes over attorney-client fee arrangements, what limitations may exist with regard to the number of times a client can seek arbitration, as suggested by Pascazi Law Offs., PLLC v Pioneer Natural Pools, Inc.?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_39']\n",
            "\n",
            "Evaluating query: '3. How does New York law address the issue of malpractice claims against attorneys who fail to properly manage their clients' funds, as discussed in Potruch v Berson and Pickard v. Tarnow?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_39']\n",
            "\n",
            "Evaluating query: '1. What are the legal principles governing the recovery of attorney fees in New York, as established in Pruzan v. Levine and Scanomat A/S v. Bois, Schiller & Flexner LLP?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_40']\n",
            "\n",
            "Evaluating query: '2. How does the arbitration process for determining attorney-client fee disputes function in New York, as outlined in Riley v. Coughtry and Sachs v. Zito?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_40']\n",
            "\n",
            "Evaluating query: '3. What are the implications of joint representation on attorney-client fee agreements, as illustrated in Rotker v. Rotker?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_40']\n",
            "\n",
            "Evaluating query: '1. What are the key factors that a court considers when determining the reasonableness of attorney's fees in arbitration as per Scordio v. Scordio?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_41']\n",
            "\n",
            "Evaluating query: '2. Can a party request a trial de novo after an attorney-client fee arbitration in New York, and if so, under what circumstances, according to Scott v. Jacobs (trial de novo)?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_41']\n",
            "\n",
            "Evaluating query: '3. How does New York law handle liens on settlement funds for unpaid attorney's fees, as discussed in Scott v. Jacobs (Liens)?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_41']\n",
            "\n",
            "Evaluating query: '1. What are the key factors that a court considers when determining whether a lawyer's fee is reasonable in an attorney-client fee arbitration case, as per the rulings in C. v. Ganea and Spina v. Michael J. DeFilippo PC?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_42']\n",
            "\n",
            "Evaluating query: '2. In what circumstances can a client seek to recover attorney's fees from their former attorney, and what are the potential limitations on such recovery, based on the decisions in C. v. Ganea, 15 Sieratzki v. Sei Global, and Soni v. Pryor?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_42']\n",
            "\n",
            "Evaluating query: '3. What are the applicable rules for filing a motion to vacate or modify an attorney-client fee arbitration award, as determined by the courts in 7 Sieratzki v. Sei Global and 23 Spina v. Michael J. DeFilippo PC?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_42']\n",
            "\n",
            "Evaluating query: '1. \"What are the key legal principles regarding attorney-client fee disputes, as established in Stodolski v. Wisselman and Tucker v. Weich?\"'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_43']\n",
            "\n",
            "Evaluating query: '2. \"Can a client pursue arbitration to resolve an attorney-client fee dispute, and what are the potential limitations, as demonstrated in 17 Williams v. Jacqueline Jackson and Tomei v Schwartz?\"'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_43']\n",
            "\n",
            "Evaluating query: '3. \"What factors influence the recovery of attorney's fees by attorneys in cases of malpractice, as shown in Tray v. Thaler and Tucker v. Weich?\"'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_43']\n",
            "\n",
            "Evaluating query: '1. What are the key considerations for a lawyer to recover attorney fees in a New York arbitration case, as determined by Verkowitz v. Torres?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_44']\n",
            "\n",
            "Evaluating query: '2. In a New York attorney-client fee arbitration, what factors might influence the decision on whether a client's delay in filing a claim affects the lawyer's right to fees, based on 12 PC v. Finkelstein?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_44']\n",
            "\n",
            "Evaluating query: '3. How does the court determine the reasonableness of legal fees in a New York attorney-client fee arbitration, as outlined in Wallenstein v. Cohen and Ween v. Dow?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_44']\n",
            "\n",
            "Evaluating query: '1. What are the key legal principles governing attorney-client fee disputes in New York, as established by the case Weinstein v. Dvir?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_45']\n",
            "\n",
            "Evaluating query: '2. In what circumstances can a law firm in New York seek arbitration for unpaid attorney fees, and what are the relevant procedural requirements, according to the case 29 Wenig Saltiel, LLP v. Secord?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_45']\n",
            "\n",
            "Evaluating query: '3. How does New York law address limitations on filing multiple actions for attorney fee disputes, as illustrated in cases like Ziskin v. Bi-County Electric Corp., and what are the potential consequences of exceeding such limits?'\n",
            "Expected relevant chunk IDs (from eval dataset): ['chunk_45']\n",
            "\n",
            "--- Evaluation Results ---\n",
            "Query: 1. What are the rules governing a lawyer's obligation to notify clients of their right to participate in the Attorney-Client Fee Arbitration Program in New York?\n",
            "  Relevant Chunk IDs: ['chunk_0']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 2. Under what circumstances can an attorney's pleading requirement be waived or modified according to Part 137 and 137.6(b) in New York's Attorney-Client Fee Arbitration Program?\n",
            "  Relevant Chunk IDs: ['chunk_0']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. In the context of post-award procedures, what are the grounds for challenging a fee arbitration award in New York, and how does CPLR Article 75 come into play?\n",
            "  Relevant Chunk IDs: ['chunk_0']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the requirements for an attorney seeking to recover fees and disbursements in actions related to the enforcement of divorce judgements under Part 136, as established in Herrick v. Lyon?\n",
            "  Relevant Chunk IDs: ['chunk_1']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 2. In fee disputes covered by Part 137, what factors must be considered when determining whether an outgoing attorney is entitled to a fee after being discharged (allegedly for cause) and asserting a retaining lien?\n",
            "  Relevant Chunk IDs: ['chunk_1']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 3. What are the consequences for an attorney who fails to provide notice of a client's right to arbitrate under Part 136, as discussed in Scordio v. Scordio, Paikin v. Tsirelman, and Rotker v. Rotker?\n",
            "  Relevant Chunk IDs: ['chunk_1']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 1. What are the rules regarding an attorney's obligation to provide a client with notice of the right to arbitrate fee disputes in matrimonial cases, and what happens if this obligation is not met?\n",
            "  Relevant Chunk IDs: ['chunk_2']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 2. Can an attorney rely on the principle of an account stated as a basis for summary judgment in a fee dispute case, and under what circumstances would a court consider an account stated to be implied?\n",
            "  Relevant Chunk IDs: ['chunk_2']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 3. In a situation where a fee dispute is pending in an arbitration program, can an attorney file a separate action in City Court challenging the constitutionality of the fee dispute program on grounds such as equal protection and right to jury trial? If so, what are the potential outcomes for such actions?\n",
            "  Relevant Chunk IDs: ['chunk_2']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 1. What are the requirements for an attorney to provide notice of a client's right to arbitrate under Part 137 in New York?\n",
            "  Relevant Chunk IDs: ['chunk_3']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "--------------------\n",
            "Query: 2. How should retainer agreements be construed in relation to matrimonial rules governing retainers, fee disputes, and arbitration in New York?\n",
            "  Relevant Chunk IDs: ['chunk_3']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 3. In cases involving multiple matters, how is the amount in dispute calculated for purposes of determining if Part 136 applies in New York?\n",
            "  Relevant Chunk IDs: ['chunk_3']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0667\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 1. What are the circumstances under which a court will view multiple fee disputes in aggregate, and how does this impact the applicability of New York's Part 137?\n",
            "  Relevant Chunk IDs: ['chunk_4']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0833\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 2. In cases where an attorney represents a client in a criminal matter, is it possible for the client to invoke the right to arbitration as provided by Part 137? If not, what are the specific reasons that prevent this invocation?\n",
            "  Relevant Chunk IDs: ['chunk_4']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. When is it deemed a violation of public policy or against the purpose of New York's Part 137 for an attorney to avoid compliance with its requirements by stating that the client will allege malpractice? Under what circumstances would it be appropriate for the \"Local Administrative Body\" to determine if malpractice is inextricably intertwined with a client's claim for payment?\n",
            "  Relevant Chunk IDs: ['chunk_4']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the requirements for an attorney to notify their client of the right to arbitrate fees in a Mental Hygiene Law article 81 proceeding?\n",
            "  Relevant Chunk IDs: ['chunk_5']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 2. In a proceeding pursuant to SCPA 2110, what is the Surrogate's responsibility regarding deciding a reasonable legal fee and how does this impact the existence of a retainer agreement or party consent?\n",
            "  Relevant Chunk IDs: ['chunk_5']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 3. Under Part 137, which disputes are considered substantial legal questions and how should an attorney plead these exceptions when defending against a termination letter for cause and malpractice?\n",
            "  Relevant Chunk IDs: ['chunk_5']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "--------------------\n",
            "Query: 1. What are the requirements for a New York attorney seeking to recover fees from clients in a New York court, regarding the pleading of an exception to the New York State Fee Dispute Resolution Program?\n",
            "  Relevant Chunk IDs: ['chunk_6']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 2. In cases where a fee dispute falls outside the monetary jurisdiction of Part 137, what specific allegations must be made by the plaintiff attorney in the complaint to avoid dismissal?\n",
            "  Relevant Chunk IDs: ['chunk_6']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. If a fee dispute is found to fall outside the scope of Part 137, but the plaintiff attorney fails to allege as such in the complaint, what legal consequence does this omission have on the case?\n",
            "  Relevant Chunk IDs: ['chunk_6']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the rules that a matrimonial lawyer must follow in New York regarding filing and compliance to be eligible for fee recovery?\n",
            "  Relevant Chunk IDs: ['chunk_7']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 2. Can a law firm apply for reargument if they failed to argue that the dispute falls outside of the Part 137 Program on their prior motion as required by CPLR 2221(d)?\n",
            "  Relevant Chunk IDs: ['chunk_7']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 3. In the context of fee disputes, what is the legal principle regarding substantial compliance and how does it apply to attorneys in New York?\n",
            "  Relevant Chunk IDs: ['chunk_7']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "--------------------\n",
            "Query: 1. What are the specific requirements outlined in 22 NYCRR 1400.3 that an attorney must comply with in order to recover legal fees in matrimonial cases in New York?\n",
            "  Relevant Chunk IDs: ['chunk_8']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 2. Can an attorney recover legal fees if there is substantial, but not complete, compliance with the rules regarding retainer agreements in matrimonial cases as outlined in 22 NYCRR 1400.3?\n",
            "  Relevant Chunk IDs: ['chunk_8']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. In a matrimonial fee arbitration case, what factors does an arbitrator consider when determining an appropriate reduction of attorney's fees due to partial noncompliance with the rules outlined in 22 NYCRR Part 1400?\n",
            "  Relevant Chunk IDs: ['chunk_8']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0667\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the specific rules that attorneys in New York must comply with regarding providing clients with a written retainer, statement of client's rights and responsibilities, and timely itemized bills in matrimonial cases?\n",
            "  Relevant Chunk IDs: ['chunk_9']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "--------------------\n",
            "Query: 2. Under what circumstances can an arbitrator in New York deviate from strict compliance with the rules related to attorney-client fee agreements in matrimonial cases, according to Edelstein v. Greisman case?\n",
            "  Relevant Chunk IDs: ['chunk_9']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 3. In a case challenging the confirmation of a fee arbitration award, what evidence might be sufficient for a court to find that an attorney has substantially complied with the rules and is entitled to his fee, as demonstrated in 15 aff’d and Edelstein v. Greisman cases?\n",
            "  Relevant Chunk IDs: ['chunk_9']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 1. What are the legal requirements for a lawyer to recover fees after an arbitration proceeding in New York, considering cases such as Jones v. Wright and Gamaliel v Papadopoulos-Vlantes?\n",
            "  Relevant Chunk IDs: ['chunk_10']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 2. Under what circumstances can a lawyer be barred from retaining legal fees due to lack of a letter of engagement, according to the case Rubenstein?\n",
            "  Relevant Chunk IDs: ['chunk_10']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. In situations where a client and a lawyer had previously participated in arbitration, is it necessary for the client to agree with the award before it becomes enforceable, considering the case Gamaliel v Papadopoulos-Vlantes?\n",
            "  Relevant Chunk IDs: ['chunk_10']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0667\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the specific rules regarding the filing of a trial de novo in Part 137 arbitrations, and under what circumstances can a court exercise discretion to excuse a late filing? (Stodolski v. Wisselman)\n",
            "  Relevant Chunk IDs: ['chunk_11']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 2. In cases where a client seeks a declaration that a Part 137 arbitration award is invalid or void, what are the necessary allegations concerning the merits of the underlying fee dispute that must be included in the complaint? (Matter of Gold, Stewart, Kravitz, Benes, LLP)\n",
            "  Relevant Chunk IDs: ['chunk_11']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "--------------------\n",
            "Query: 3. What jurisdictional limitations apply to actions for declaratory relief from a Part 137 arbitration award, and has this changed following any recent amendments or court decisions? (DeFilippo v. Gerbino)\n",
            "  Relevant Chunk IDs: ['chunk_11']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "--------------------\n",
            "Query: 1. What are the specific requirements for a party to initiate de novo judicial review following a Part 137 arbitration decision, as outlined in Borgus v. Marianetti?\n",
            "  Relevant Chunk IDs: ['chunk_12']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "--------------------\n",
            "Query: 2. In the context of a fee dispute, what constitutes the commencement of an action on the merits in a court of competent jurisdiction within the meaning of 137.8(a), according to Pruzan v. Levine?\n",
            "  Relevant Chunk IDs: ['chunk_12']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0556\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "--------------------\n",
            "Query: 3. Can a party seek to set aside an arbitrator's award after the 30-day period following receipt of the award, and under what circumstances might this be granted, as per Pruzan v. Levine and related cases?\n",
            "  Relevant Chunk IDs: ['chunk_12']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0909\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "--------------------\n",
            "Query: 1. What are the legal requirements for a de novo review of an arbitration award in New York, and under what circumstances can a court treat an action for declaratory relief as a request for such review?\n",
            "  Relevant Chunk IDs: ['chunk_13']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "--------------------\n",
            "Query: 2. In New York, what is the admissibility status of an arbitration award during a trial de novo, and how should invoices be presented to support an attorney's claim for fees in this context?\n",
            "  Relevant Chunk IDs: ['chunk_13']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0625\n",
            "--------------------\n",
            "Query: 3. What are the grounds for vacating an arbitration award under CPLR 7511 in New York, and when is the time period for seeking de novo review absolute and not subject to judicial discretion?\n",
            "  Relevant Chunk IDs: ['chunk_13']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0909\n",
            "--------------------\n",
            "Query: 1. What are the rules and criteria for vacating a default judgment in a fee arbitration case under Part 137, considering the factors that may be considered in the interest of justice?\n",
            "  Relevant Chunk IDs: ['chunk_14']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "--------------------\n",
            "Query: 2. In a trial de novo from a Part 137 fee arbitration, what is the time limit for filing a complaint in NYC Civil Court, and what consequences can arise if the deadline is missed?\n",
            "  Relevant Chunk IDs: ['chunk_14']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "--------------------\n",
            "Query: 3. When does a court lack \"single act jurisdiction\" over attorneys pursuant to New York's long-arm statute, and how is this relevant to a breach of contract claim arising from a transaction in the City of New York?\n",
            "  Relevant Chunk IDs: ['chunk_14']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0370\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "--------------------\n",
            "Query: 1. What are the jurisdictional limits for confirming an arbitrator's award in New York, as determined in the case of Sachs v. Zito?\n",
            "  Relevant Chunk IDs: ['chunk_15']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "--------------------\n",
            "Query: 2. In what circumstances can a client seek to vacate an arbitrator’s decision in favor of an attorney, and under what conditions might the client waive the right to a trial de novo, as outlined in Del Vecchio & Recine, LLP v. Udell?\n",
            "  Relevant Chunk IDs: ['chunk_15']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 3. Under what circumstances is a refusal or failure by an arbitrator to accept evidence considered judicially reviewable, and how does this relate to Maross Const., Inc. v. Central New York Regional Transp. Authority?\n",
            "  Relevant Chunk IDs: ['chunk_15']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 1. What are the specific circumstances under which a client can vacate an arbitration award in New York, as outlined in CPLR 7511 and Part 137 rules?\n",
            "  Relevant Chunk IDs: ['chunk_16']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "--------------------\n",
            "Query: 2. In what instances is an arbitrator not required to provide explicit reasons for their decision in New York, and how does this affect the vacating of awards under Article 75?\n",
            "  Relevant Chunk IDs: ['chunk_16']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0909\n",
            "--------------------\n",
            "Query: 3. Under what circumstances can a personal recording device be used during arbitration proceedings in New York, as addressed by NYCLA rules and case law such as 22 Meyers v. Sorote ?\n",
            "  Relevant Chunk IDs: ['chunk_16']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "--------------------\n",
            "Query: 1. What are the legal requirements for a waiver of the right to reject an arbitration award and subsequently commence a trial de novo in court?\n",
            "  Relevant Chunk IDs: ['chunk_17']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "--------------------\n",
            "Query: 2. In what circumstances can personal jurisdiction be challenged due to improper service during a client's action for de novo review?\n",
            "  Relevant Chunk IDs: ['chunk_17']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "--------------------\n",
            "Query: 3. Can a retainer agreement render an arbitration award final and binding, thus preventing a client from seeking a trial de novo, without containing specific waiver language as prescribed by the Board of Governors?\n",
            "  Relevant Chunk IDs: ['chunk_17']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "--------------------\n",
            "Query: 1. What are the key considerations for a court when determining the fairness and reasonableness of an attorney-client fee contract, as outlined in Jacobson v. Sassower and Smitas v. Rickett cases?\n",
            "  Relevant Chunk IDs: ['chunk_18']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "--------------------\n",
            "Query: 2. In the context of a retainer agreement between parties, what specific language is required to validly waive the right to trial de novo, as explained in LLP v. Altman?\n",
            "  Relevant Chunk IDs: ['chunk_18']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 3. How does the New York court interpret ambiguity in attorney-client fee agreements, as demonstrated in Jacobson v. Sassower and related to the principle of construing ambiguity against the party who drafted the agreement?\n",
            "  Relevant Chunk IDs: ['chunk_18']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "--------------------\n",
            "Query: 1. What are the specific requirements for waiver of the right to arbitration under Part 137 in New York, as outlined in Pascazi Law Offices, PLLC v Pioneer Natural Pools, Inc.?\n",
            "  Relevant Chunk IDs: ['chunk_19']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "--------------------\n",
            "Query: 2. In what circumstances is it permissible for an attorney to commence a legal action for unpaid fees without complying with Part 137 rules, according to the case Doniger & Engstrand, LLP v. Carlomagno?\n",
            "  Relevant Chunk IDs: ['chunk_19']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "--------------------\n",
            "Query: 3. How does a court determine if there has been a valid waiver of the right to arbitrate in the context of legal fee disputes, as per the Appellate Term's ruling in Doniger & Engstrand, LLP v. Carlomagno?\n",
            "  Relevant Chunk IDs: ['chunk_19']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "--------------------\n",
            "Query: 1. What are the requirements for an arbitration panel's award to be considered valid in a Part 136 arbitration under New York law?\n",
            "  Relevant Chunk IDs: ['chunk_20']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "--------------------\n",
            "Query: 2. In a fee dispute, what circumstances may justify vacating an arbitrator's award under the principle that the award must have a \"rational, plausible basis founded upon the recited evidence and testimony presented\"?\n",
            "  Relevant Chunk IDs: ['chunk_20']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "--------------------\n",
            "Query: 3. When arbitrating fees between a New York law firm and an out-of-state client, what factors might influence whether claims over fees can be arbitrated under Part 137 or an alternative arbitration agreement?\n",
            "  Relevant Chunk IDs: ['chunk_20']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 1. What are the specific rules regarding the recovery of attorneys' fees in collection actions based on retainer agreements, given the principles outlined in Ween v. Dow?\n",
            "  Relevant Chunk IDs: ['chunk_21']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 2. Are there limitations on a lawyer's ability to recover legal fees associated with enforcing a charging lien or seeking to recover fees, as discussed in Newkirk v. Fourmen Construction Inc.?\n",
            "  Relevant Chunk IDs: ['chunk_21']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. In what circumstances can an attorney move within a matrimonial action to secure a charging lien and bypass the arbitration notice provisions, according to Sprole v. Sprole? Are there any specific conditions related to the disputed fees amount in such cases?\n",
            "  Relevant Chunk IDs: ['chunk_21']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the rules regarding an attorney's right to a prompt hearing to fix the amount of a retaining lien, and under what circumstances should this matter be determined by arbitration pursuant to Part 137?\n",
            "  Relevant Chunk IDs: ['chunk_22']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 2. In cases where the fee has been set by court order, is there an exemption from arbitration as per Part 137 for disputes regarding attorney fees? If so, under what conditions does this exemption apply?\n",
            "  Relevant Chunk IDs: ['chunk_22']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. When does an account stated exist between a party and their attorney according to New York law, and what are the implications for the attorney's fee and lien rights in such cases?\n",
            "  Relevant Chunk IDs: ['chunk_22']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the specific circumstances under which a client can bring a subsequent malpractice claim against an attorney after a fee arbitration, following the rules outlined in Soni v. Pryor and Mahler?\n",
            "  Relevant Chunk IDs: ['chunk_23']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2000\n",
            "--------------------\n",
            "Query: 2. In what situations may a client be collaterally estopped from bringing a subsequent malpractice action against an attorney who was awarded partial fees in a Part 137 arbitration, as per the court's decision in Mahler?\n",
            "  Relevant Chunk IDs: ['chunk_23']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 3. How do legal proceedings differ when a client files a complaint with the Grievance Committee and it is referred to a local bar association’s voluntary fee-dispute arbitration program, as seen in Altamore v. Friedman (Part 136)?\n",
            "  Relevant Chunk IDs: ['chunk_23']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "--------------------\n",
            "Query: 1. What are the legal principles governing whether a fee dispute between an attorney and client falls under Part 136 or Part 137 in New York?\n",
            "  Relevant Chunk IDs: ['chunk_24']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0833\n",
            "--------------------\n",
            "Query: 2. Can a court award pre-award interest on an arbitration award in a case governed by New York's Part 137 rules, and if so, what are the conditions for such an award?\n",
            "  Relevant Chunk IDs: ['chunk_24']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.3333\n",
            "--------------------\n",
            "Query: 3. How does collateral estoppel apply in cases where an arbitrator awards attorney fees, potentially barring subsequent malpractice actions against the attorney? Are there any exceptions to this rule?\n",
            "  Relevant Chunk IDs: ['chunk_24']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "--------------------\n",
            "Query: 1. What are the guidelines for an arbitrator in determining whether interest should be allowed from the time of breach in a fee dispute case, as established in Meyers v. Sorote?\n",
            "  Relevant Chunk IDs: ['chunk_25']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 2. Under what circumstances can an arbitration panel exceed its authority, as illustrated by Attorney Representation 33 Prudential Equity Group, Llc v. Ajamie?\n",
            "  Relevant Chunk IDs: ['chunk_25']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. In what circumstances does the informality of an arbitration process prevent the application of the rule that prohibits the unauthorized practice of law, as discussed in the case involving a non-New York lawyer participating in a NYSE arbitration in New York?\n",
            "  Relevant Chunk IDs: ['chunk_25']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 1. What are the legal principles governing the awarding of attorney fees in a fee arbitration case, as demonstrated in Angel v. Greenhaus?\n",
            "  Relevant Chunk IDs: ['chunk_26']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=0.5000\n",
            "--------------------\n",
            "Query: 2. In what circumstances can a court lower the rate of interest on unpaid legal fees, and what factors may be considered in determining if such a reduction is warranted, as per Kutner v. Antonacci?\n",
            "  Relevant Chunk IDs: ['chunk_26']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 3. When assessing the reasonableness of interest rates on unpaid legal fees, how do courts typically consider pre/post judgment interest accrual rates and other relevant market rates, as shown in Agovino & Asselta, LLP v. Ruben?\n",
            "  Relevant Chunk IDs: ['chunk_26']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Hybrid: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "--------------------\n",
            "Query: 1. What are the key considerations for a lawyer when seeking attorney's fees in a New York arbitration proceeding, as outlined in Altamore v. Friedman?\n",
            "  Relevant Chunk IDs: ['chunk_27']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0370\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "--------------------\n",
            "Query: 2. How does the New York Court interpret conflicts of interest within law firms during fee disputes, as demonstrated in Borah, Goldstein, Altschuler, Schwartz, & Nahins?\n",
            "  Relevant Chunk IDs: ['chunk_27']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0294\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 3. In a legal malpractice claim, how can a plaintiff prove that the attorney's breach of duty caused specific damages, and what factors may affect the recovery of fees in such cases, as per Bartning v. Bartning (2 separate questions combined)?\n",
            "  Relevant Chunk IDs: ['chunk_27']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0256\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "--------------------\n",
            "Query: 1. What are the specific rules governing attorney-client fee disputes in New York, as interpreted in the case of Borgus v. Marianetti?\n",
            "  Relevant Chunk IDs: ['chunk_28']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0833\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0385\n",
            "--------------------\n",
            "Query: 2. In cases of arbitration between attorneys and clients regarding fees, what factors have been considered significant in determining whether a client waived their right to contest fees, as outlined in 17 F-P v. E.L.P?\n",
            "  Relevant Chunk IDs: ['chunk_28']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0455\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0333\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "--------------------\n",
            "Query: 3. Under what circumstances can a law firm pursue a malpractice claim against a former client for unpaid legal fees, and how did the court rule on this issue in the case of 8 Calendar, PC v. Edwards?\n",
            "  Relevant Chunk IDs: ['chunk_28']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0233\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0294\n",
            "--------------------\n",
            "Query: 1. What are the key factors considered by arbitrators in determining reasonable attorney fees for legal services provided under New York law? (e.g., DeFilippo v. Gerbino)\n",
            "  Relevant Chunk IDs: ['chunk_29']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0370\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0333\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "--------------------\n",
            "Query: 2. Can a client file a fee arbitration claim against their former attorney more than once, and if not, what are the implications for the attorney-client relationship in such cases? (e.g. 17 Del Vecchio & Recine, LLP v. Udell)\n",
            "  Relevant Chunk IDs: ['chunk_29']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0714\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0303\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0400\n",
            "--------------------\n",
            "Query: 3. Under New York law, when is an attorney entitled to recover unpaid legal fees through a fee arbitration process, and what factors may impact the decision on whether fees are reasonable or excessive? (e.g., DeLisi v. The Law Offices of Capetola & LLP v. Carlomagno)\n",
            "  Relevant Chunk IDs: ['chunk_29']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0278\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0455\n",
            "--------------------\n",
            "Query: 1. What are the key legal principles regarding attorney-client fee disputes in New York, as established by the case of Edelman v. Poster?\n",
            "  Relevant Chunk IDs: ['chunk_30']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1111\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "--------------------\n",
            "Query: 2. In cases involving attorney-client fee disputes, what factors were considered significant in determining a reasonable fee, as described in the decision of Eiseman Levine Lehrhaupt & Kakoyiannis, PC v. Torino Jewelers, Ltd.?\n",
            "  Relevant Chunk IDs: ['chunk_30']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0286\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0556\n",
            "--------------------\n",
            "Query: 3. What rules and regulations govern attorney-client fee arbitration proceedings in New York, as outlined in Feder, Goldstein, Errico v. Ronan?\n",
            "  Relevant Chunk IDs: ['chunk_30']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0286\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "--------------------\n",
            "Query: 1. What are the key legal principles governing attorney-client fee disputes in New York arbitration cases, as illustrated by the cases: Ferst v. Abraham, Finn v. Anderson, and Finn v. Zinn?\n",
            "  Relevant Chunk IDs: ['chunk_31']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "--------------------\n",
            "Query: 2. How has the court interpreted the rules for filing limits in attorney-client fee arbitrations in New York, as demonstrated by the case summaries of Friedman v. Vuksanovic?\n",
            "  Relevant Chunk IDs: ['chunk_31']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0294\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "--------------------\n",
            "Query: 3. In cases involving attorney-client fee disputes, what factors does the court consider when determining whether a client waived their right to arbitration, as suggested by the cases: Ferst v. Abraham and Finn v. Zinn?\n",
            "  Relevant Chunk IDs: ['chunk_31']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "--------------------\n",
            "Query: 1. What are the key factors that a court considers when determining the reasonableness of attorney fees in a fee arbitration case, as illustrated in Gahagan v. Gahagan?\n",
            "  Relevant Chunk IDs: ['chunk_32']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "--------------------\n",
            "Query: 2. In cases involving a dispute over attorney-client fee agreements, what procedural requirements must be followed to enforce or challenge a retainer agreement during an arbitration proceeding, according to Gary Friedman, P.C. v O'Neill?\n",
            "  Relevant Chunk IDs: ['chunk_32']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "--------------------\n",
            "Query: 3. How does New York law address the situation where a client seeks to recover attorney fees from a third party under a contingency fee agreement, and what factors are considered in determining whether such recovery is appropriate, as per Goldfarb v. Hoffman?\n",
            "  Relevant Chunk IDs: ['chunk_32']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0256\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "--------------------\n",
            "Query: 1. What are the key factors considered in determining whether a lawyer is entitled to recover contingent fees in New York attorney-client fee arbitration cases, as demonstrated in Gottlieb v. Marusya and Jaffe Ross & Light, LLP v Mann?\n",
            "  Relevant Chunk IDs: ['chunk_33']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0256\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0526\n",
            "--------------------\n",
            "Query: 2. In what circumstances can a client be prohibited from bringing multiple attorney-client fee disputes against the same attorney, and how was this issue addressed in Herrick v. Lyon and Hunt v. Hunt?\n",
            "  Relevant Chunk IDs: ['chunk_33']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0476\n",
            "--------------------\n",
            "Query: 3. What are the legal considerations for determining whether a lawyer's actions warrant the reduction or denial of requested fees, as discussed in Herrick v. Lyon, Jewell v. Iyer, and Hunt v. Hunt?\n",
            "  Relevant Chunk IDs: ['chunk_33']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0455\n",
            "--------------------\n",
            "Query: 1. What are the key legal principles governing attorney-client fee disputes, as established in the case of Jones v. Wright?\n",
            "  Relevant Chunk IDs: ['chunk_34']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0312\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0417\n",
            "--------------------\n",
            "Query: 2. In a scenario where a lawyer's fee dispute with a client arises during an ongoing representation, what are the potential implications for the attorney-client relationship and the arbitration process, according to Julien v Machson (two cases)?\n",
            "  Relevant Chunk IDs: ['chunk_34']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0294\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0312\n",
            "--------------------\n",
            "Query: 3. How does New York law handle situations where a law firm seeks recovery of unpaid fees from a former client, particularly in light of the case Kayden v Kayden?\n",
            "  Relevant Chunk IDs: ['chunk_34']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0217\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "--------------------\n",
            "Query: 1. \"What are the key legal principles governing attorney-client fee disputes in New York, as outlined in cases such as Kutner v. Antonacci and Larrison v. Scarola Reavis & Parent LLP?\"\n",
            "  Relevant Chunk IDs: ['chunk_35']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0476\n",
            "--------------------\n",
            "Query: 2. \"In what circumstances can a client challenge an attorney's fees in New York arbitration, according to case law like Lorin v. 501 Second Street LLC and Dorothy Nash and Glasser v. Kenmore Property, LLC?\"\n",
            "  Relevant Chunk IDs: ['chunk_35']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0256\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0476\n",
            "--------------------\n",
            "Query: 3. \"What are the potential limitations on the number of times a client can initiate fee arbitration against an attorney in New York, as suggested by the cases Landa v. Dratch and the provided case summaries?\"\n",
            "  Relevant Chunk IDs: ['chunk_35']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0278\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0303\n",
            "--------------------\n",
            "Query: 1. What are the key factors considered in determining attorney-client fee recovery under New York law? (Louissaint v. DePaolo)\n",
            "  Relevant Chunk IDs: ['chunk_36']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0312\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0400\n",
            "--------------------\n",
            "Query: 2. How does New York law handle arbitration rights and proceedings for legal malpractice claims between a lawyer and client? (2 Macnish-Lenox, LLC, v. Simpson)\n",
            "  Relevant Chunk IDs: ['chunk_36']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "--------------------\n",
            "Query: 3. In cases involving the termination of an attorney-client relationship, what are the factors considered when determining whether the attorney is entitled to fees incurred up until the termination? (35 Mahl v. Rand)\n",
            "  Relevant Chunk IDs: ['chunk_36']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0217\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0303\n",
            "--------------------\n",
            "Query: 1. What are the key legal principles governing attorney-client fee disputes in New York arbitration, as illustrated in cases such as Gretz v. Goldman and Matter of Jo D. Talbot?\n",
            "  Relevant Chunk IDs: ['chunk_37']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0625\n",
            "--------------------\n",
            "Query: 2. How does New York law determine the appropriate filing limit for attorney-client fee arbitrations, considering cases like Matter of Raymond E. Kerno and Matter of Sciandra v Palmer?\n",
            "  Relevant Chunk IDs: ['chunk_37']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0667\n",
            "--------------------\n",
            "Query: 3. In what circumstances might a client's obligation to pay attorneys' fees be waived in New York, as suggested by the cases MBNA America Bank, A. v. Sally Coe and McNamee, Lochner, C. v. Bethany M. Killeen?\n",
            "  Relevant Chunk IDs: ['chunk_37']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0303\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "--------------------\n",
            "Query: 1. What are the key legal principles regarding attorney-client fee disputes in arbitration proceedings, as outlined in Meyers v. Sorote and LLP v. Altman?\n",
            "  Relevant Chunk IDs: ['chunk_38']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0250\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0500\n",
            "--------------------\n",
            "Query: 2. In cases involving lawyer disqualification due to conflicts of interest, what factors are typically considered by courts, as shown in Moraitis v Moraitis and Ostrolenk v. Christopher?\n",
            "  Relevant Chunk IDs: ['chunk_38']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0217\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0526\n",
            "--------------------\n",
            "Query: 3. Under what circumstances can a law firm seek recovery of unpaid attorney fees against a client, and what limitations may apply, based on the cases Newkirk v. Fourmen Construction Inc. and 22, 32 MINTZ & GOLD LLP, v. DAIBES?\n",
            "  Relevant Chunk IDs: ['chunk_38']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0333\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0476\n",
            "--------------------\n",
            "Query: 1. What are the key factors that a court considers when determining whether an attorney is entitled to recover fees in a contingency fee agreement, as outlined in Paikin v. Tsirelman?\n",
            "  Relevant Chunk IDs: ['chunk_39']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "--------------------\n",
            "Query: 2. In cases involving disputes over attorney-client fee arrangements, what limitations may exist with regard to the number of times a client can seek arbitration, as suggested by Pascazi Law Offs., PLLC v Pioneer Natural Pools, Inc.?\n",
            "  Relevant Chunk IDs: ['chunk_39']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0833\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 3. How does New York law address the issue of malpractice claims against attorneys who fail to properly manage their clients' funds, as discussed in Potruch v Berson and Pickard v. Tarnow?\n",
            "  Relevant Chunk IDs: ['chunk_39']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0333\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 1. What are the legal principles governing the recovery of attorney fees in New York, as established in Pruzan v. Levine and Scanomat A/S v. Bois, Schiller & Flexner LLP?\n",
            "  Relevant Chunk IDs: ['chunk_40']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0312\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "--------------------\n",
            "Query: 2. How does the arbitration process for determining attorney-client fee disputes function in New York, as outlined in Riley v. Coughtry and Sachs v. Zito?\n",
            "  Relevant Chunk IDs: ['chunk_40']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0286\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0588\n",
            "--------------------\n",
            "Query: 3. What are the implications of joint representation on attorney-client fee agreements, as illustrated in Rotker v. Rotker?\n",
            "  Relevant Chunk IDs: ['chunk_40']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0233\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0455\n",
            "--------------------\n",
            "Query: 1. What are the key factors that a court considers when determining the reasonableness of attorney's fees in arbitration as per Scordio v. Scordio?\n",
            "  Relevant Chunk IDs: ['chunk_41']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "--------------------\n",
            "Query: 2. Can a party request a trial de novo after an attorney-client fee arbitration in New York, and if so, under what circumstances, according to Scott v. Jacobs (trial de novo)?\n",
            "  Relevant Chunk IDs: ['chunk_41']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1429\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0385\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0455\n",
            "--------------------\n",
            "Query: 3. How does New York law handle liens on settlement funds for unpaid attorney's fees, as discussed in Scott v. Jacobs (Liens)?\n",
            "  Relevant Chunk IDs: ['chunk_41']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0345\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0833\n",
            "--------------------\n",
            "Query: 1. What are the key factors that a court considers when determining whether a lawyer's fee is reasonable in an attorney-client fee arbitration case, as per the rulings in C. v. Ganea and Spina v. Michael J. DeFilippo PC?\n",
            "  Relevant Chunk IDs: ['chunk_42']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0270\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0667\n",
            "--------------------\n",
            "Query: 2. In what circumstances can a client seek to recover attorney's fees from their former attorney, and what are the potential limitations on such recovery, based on the decisions in C. v. Ganea, 15 Sieratzki v. Sei Global, and Soni v. Pryor?\n",
            "  Relevant Chunk IDs: ['chunk_42']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 3. What are the applicable rules for filing a motion to vacate or modify an attorney-client fee arbitration award, as determined by the courts in 7 Sieratzki v. Sei Global and 23 Spina v. Michael J. DeFilippo PC?\n",
            "  Relevant Chunk IDs: ['chunk_42']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0333\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 1. \"What are the key legal principles regarding attorney-client fee disputes, as established in Stodolski v. Wisselman and Tucker v. Weich?\"\n",
            "  Relevant Chunk IDs: ['chunk_43']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0370\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0769\n",
            "--------------------\n",
            "Query: 2. \"Can a client pursue arbitration to resolve an attorney-client fee dispute, and what are the potential limitations, as demonstrated in 17 Williams v. Jacqueline Jackson and Tomei v Schwartz?\"\n",
            "  Relevant Chunk IDs: ['chunk_43']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0385\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0909\n",
            "--------------------\n",
            "Query: 3. \"What factors influence the recovery of attorney's fees by attorneys in cases of malpractice, as shown in Tray v. Thaler and Tucker v. Weich?\"\n",
            "  Relevant Chunk IDs: ['chunk_43']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1250\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0476\n",
            "--------------------\n",
            "Query: 1. What are the key considerations for a lawyer to recover attorney fees in a New York arbitration case, as determined by Verkowitz v. Torres?\n",
            "  Relevant Chunk IDs: ['chunk_44']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0370\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "--------------------\n",
            "Query: 2. In a New York attorney-client fee arbitration, what factors might influence the decision on whether a client's delay in filing a claim affects the lawyer's right to fees, based on 12 PC v. Finkelstein?\n",
            "  Relevant Chunk IDs: ['chunk_44']\n",
            "  BM25: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0323\n",
            "--------------------\n",
            "Query: 3. How does the court determine the reasonableness of legal fees in a New York attorney-client fee arbitration, as outlined in Wallenstein v. Cohen and Ween v. Dow?\n",
            "  Relevant Chunk IDs: ['chunk_44']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.2500\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0278\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0417\n",
            "--------------------\n",
            "Query: 1. What are the key legal principles governing attorney-client fee disputes in New York, as established by the case Weinstein v. Dvir?\n",
            "  Relevant Chunk IDs: ['chunk_45']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1667\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "--------------------\n",
            "Query: 2. In what circumstances can a law firm in New York seek arbitration for unpaid attorney fees, and what are the relevant procedural requirements, according to the case 29 Wenig Saltiel, LLP v. Secord?\n",
            "  Relevant Chunk IDs: ['chunk_45']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=0.1000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0357\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0435\n",
            "--------------------\n",
            "Query: 3. How does New York law address limitations on filing multiple actions for attorney fee disputes, as illustrated in cases like Ziskin v. Bi-County Electric Corp., and what are the potential consequences of exceeding such limits?\n",
            "  Relevant Chunk IDs: ['chunk_45']\n",
            "  BM25: Precision@10=0.1000, Recall@10=1.0000, MRR=1.0000\n",
            "  Dense: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0294\n",
            "  Hybrid: Precision@10=0.0000, Recall@10=0.0000, MRR=0.0667\n",
            "--------------------\n",
            "\n",
            "--- Average Evaluation Results ---\n",
            "  BM25: Precision@10=0.0855, Recall@10=0.8551, MRR=98.1862\n",
            "  Dense: Precision@10=0.0522, Recall@10=0.5217, MRR=45.5277\n",
            "  Hybrid: Precision@10=0.0551, Recall@10=0.5507, MRR=39.0782\n",
            "--------------------\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "efbff787"
      },
      "source": [
        "## Analysis: Examining Retrieved Chunks\n",
        "\n",
        "### Subtask:\n",
        "Analyze the top retrieved chunks for a specific query from each retrieval method and compare them to the expected relevant chunk."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "0e388831"
      },
      "source": [
        "**Reasoning**:\n",
        "To understand why the evaluation metrics were zero, we will examine the actual chunks retrieved by each method (BM25, Dense, Hybrid) for a specific query and compare them against the ground truth relevant chunk ID from the evaluation dataset. This qualitative analysis will help identify potential issues with query formulation, chunk content, or retrieval effectiveness."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "557d4375",
        "outputId": "b3084715-716f-4372-8ebf-6edb506447df"
      },
      "source": [
        "# Define the query we want to analyze\n",
        "query_to_analyze = \"1. What are the rules governing a lawyer's obligation to notify clients of their right to participate in the Attorney-Client Fee Arbitration Program in New York?\"\n",
        "\n",
        "# Identify the expected relevant chunk ID(s) from the evaluation dataset for this query\n",
        "# (Assuming evaluation_dataset is loaded and accessible)\n",
        "relevant_ids_for_analysis = []\n",
        "for query_data in evaluation_dataset:\n",
        "    if query_data[\"query\"] == query_to_analyze:\n",
        "        relevant_ids_for_analysis = query_data[\"relevant_chunk_ids\"]\n",
        "        break\n",
        "\n",
        "print(f\"Analyzing results for query: '{query_to_analyze}'\")\n",
        "print(f\"Expected relevant chunk IDs: {relevant_ids_for_analysis}\")\n",
        "print(\"-\" * 30)\n",
        "\n",
        "text_snippet_length = 500 # Increase snippet length for better context\n",
        "\n",
        "# --- 1. BM25 Retrieval Results ---\n",
        "print(\"--- BM25 Top 5 Results ---\")\n",
        "tokenized_query_bm25 = word_tokenize(query_to_analyze.lower())\n",
        "doc_scores_bm25 = bm25.get_scores(tokenized_query_bm25)\n",
        "top_n_indices_bm25 = doc_scores_bm25.argsort()[-5:][::-1] # Top 5 indices\n",
        "\n",
        "if top_n_indices_bm25 is not None:\n",
        "    for i in top_n_indices_bm25:\n",
        "        snippet = df.iloc[i]['text'][:text_snippet_length] + '...' if len(df.iloc[i]['text']) > text_snippet_length else df.iloc[i]['text']\n",
        "        is_relevant = \"Relevant\" if str(df.iloc[i]['chunk_id']) in relevant_ids_for_analysis else \"Not Relevant\" # Check against original chunk_id from df\n",
        "        print(f\"Document Index: {i}, Original Chunk ID: {df.iloc[i]['chunk_id']}, Score: {doc_scores_bm25[i]:.4f}, Relevance: {is_relevant}\")\n",
        "        print(f\"Snippet: {snippet}\\n\")\n",
        "else:\n",
        "    print(\"No BM25 results found.\")\n",
        "\n",
        "print(\"-\" * 30)\n",
        "\n",
        "# --- 2. Dense Retrieval Results ---\n",
        "print(\"--- Dense Retrieval Top 5 Results (from Qdrant) ---\")\n",
        "# Ensure Qdrant client and model are initialized and collection populated\n",
        "# client = QdrantClient(...)\n",
        "# model = SentenceTransformer(...)\n",
        "# collection_name = \"legal_case_summaries\"\n",
        "\n",
        "query_embedding_dense = model.encode(query_to_analyze).tolist()\n",
        "\n",
        "try:\n",
        "    search_result_dense = client.query_points(\n",
        "        collection_name=collection_name,\n",
        "        query=query_embedding_dense,\n",
        "        limit=5, # Top 5\n",
        "        with_payload=True # Get text payload\n",
        "    )\n",
        "\n",
        "    if search_result_dense.points:\n",
        "        for hit in search_result_dense.points:\n",
        "            # Assuming hit.id is the index in the original df\n",
        "            # Need to look up original chunk_id from df using hit.id\n",
        "            original_chunk_id = df.iloc[hit.id]['chunk_id'] if hit.id < len(df) else \"N/A\" # Added bounds check\n",
        "            snippet = hit.payload['text'][:text_snippet_length] + '...' if len(hit.payload['text']) > text_snippet_length else hit.payload['text']\n",
        "            is_relevant = \"Relevant\" if str(original_chunk_id) in relevant_ids_for_analysis else \"Not Relevant\"\n",
        "            print(f\"Document ID: {hit.id}, Original Chunk ID: {original_chunk_id}, Score: {hit.score:.4f}, Relevance: {is_relevant}\")\n",
        "            print(f\"Snippet: {snippet}\\n\")\n",
        "    else:\n",
        "        print(\"No Dense retrieval results found.\")\n",
        "\n",
        "except Exception as e:\n",
        "    print(f\"Error during Dense retrieval: {e}\")\n",
        "    print(\"Skipping Dense retrieval analysis.\")\n",
        "\n",
        "\n",
        "print(\"-\" * 30)\n",
        "\n",
        "# --- 3. Hybrid Retrieval (RRF) Results ---\n",
        "print(\"--- Hybrid (RRF) Top 5 Results ---\")\n",
        "# Need both ranked_bm25_results and ranked_dense_results from earlier steps\n",
        "# Re-run retrieval to get full ranked lists for RRF input\n",
        "tokenized_query_bm25_full = word_tokenize(query_to_analyze.lower())\n",
        "doc_scores_bm25_full = bm25.get_scores(tokenized_query_bm25_full)\n",
        "ranked_bm25_results_full = sorted([(i, score) for i, score in enumerate(doc_scores_bm25_full)], key=lambda item: item[1], reverse=True)\n",
        "\n",
        "# Dense retrieval full results for RRF input\n",
        "try:\n",
        "    search_result_dense_full = client.query_points(\n",
        "        collection_name=collection_name,\n",
        "        query=query_embedding_dense, # Use models.Vector\n",
        "        limit=len(df), # Retrieve all for RRF\n",
        "        with_payload=True\n",
        "    )\n",
        "    ranked_dense_results_full = [(hit.id, hit.score) for hit in search_result_dense_full.points] # Use .points\n",
        "\n",
        "    # Perform RRF\n",
        "    combined_results_rrf = reciprocal_rank_fusion([ranked_bm25_results_full, ranked_dense_results_full])\n",
        "\n",
        "    if combined_results_rrf:\n",
        "         # Display top 5 from RRF\n",
        "        for rank, (doc_index, score) in enumerate(combined_results_rrf[:5]):\n",
        "            # Need to get the text snippet from the original df using doc_index\n",
        "            snippet = df.iloc[doc_index]['text'][:text_snippet_length] + '...' if doc_index < len(df) and len(df.iloc[doc_index]['text']) > text_snippet_length else df.iloc[doc_index]['text'] if doc_index < len(df) else \"Document not found\"\n",
        "            # Need to get original chunk_id from df using doc_index\n",
        "            original_chunk_id = df.iloc[doc_index]['chunk_id'] if doc_index < len(df) else \"N/A\"\n",
        "            is_relevant = \"Relevant\" if str(original_chunk_id) in relevant_ids_for_analysis else \"Not Relevant\"\n",
        "\n",
        "            print(f\"Rank: {rank+1}, Document Index: {doc_index}, Original Chunk ID: {original_chunk_id}, RRF Score: {score:.4f}, Relevance: {is_relevant}\")\n",
        "            print(f\"Snippet: {snippet}\\n\")\n",
        "    else:\n",
        "        print(\"No Hybrid (RRF) results found.\")\n",
        "\n",
        "except Exception as e:\n",
        "    print(f\"Error during Dense retrieval for Hybrid input: {e}\")\n",
        "    print(\"Skipping Hybrid retrieval analysis.\")\n",
        "\n",
        "print(\"-\" * 30)"
      ],
      "execution_count": 26,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Analyzing results for query: '1. What are the rules governing a lawyer's obligation to notify clients of their right to participate in the Attorney-Client Fee Arbitration Program in New York?'\n",
            "Expected relevant chunk IDs: ['chunk_0']\n",
            "------------------------------\n",
            "--- BM25 Top 5 Results ---\n",
            "Document Index: 16, Original Chunk ID: chunk_16, Score: 29.0034, Relevance: Not Relevant\n",
            "Snippet: Friedman v. Vuksanovic , 2010 NY Slip Op 30021(U), 2010 WL 147154 (Sup. Ct. New York County). Respondent/ client failed to show a basis under CPLR 7511 to vacate the award. The Part 137 Program run by NYCLA gave Respondent several adjournments. Respondent failed to show on the date of the hearing. The arbitration went forward in his absence as per 137.6(g). Respondent was also offered an interpreter at his request and offered an opportunity to retain counsel.  22 Meyers v. Sorote , Index #: 1093...\n",
            "\n",
            "Document Index: 0, Original Chunk ID: chunk_0, Score: 25.3819, Relevance: Relevant\n",
            "Snippet: BOARD OF GOVERNORS  New York State Unified Court System Office of Court Administration Office of ADR Programs January 8, 2018 These case summaries are provided for informational purposes only and for the convenience of th ose interested in learning more about the Attorney-Client Fee Arbitration Program. The summaries should not be construed as an endorsement of any particular case by the Board of Governors or the Office of Court Administration, and do not constitute legal advice or counsel.  1 T...\n",
            "\n",
            "Document Index: 5, Original Chunk ID: chunk_5, Score: 23.9603, Relevance: Not Relevant\n",
            "Snippet: Williams v. Jacqueline Jackson , 2005 NY Slip Op 25496; 10 Misc. 3d 58; 809 N.Y.S.2d 771; 2005 N.Y. Misc. LEXIS (App. Term. 2d Dept. 2005).  9 Attorney’s claim for fees in a Mental Hygiene Law article 81 proceeding was dismissed due to attorney’s failure to notify client of right to arbitrate. Supreme Court decision barred an award of any further attorney's fees from the estate of alleged incapacitated person. However, there was no provision in the decision that limited plaintiff's fee to the am...\n",
            "\n",
            "Document Index: 2, Original Chunk ID: chunk_2, Score: 22.3070, Relevance: Not Relevant\n",
            "Snippet: Rotker v. Rotker, 195 Misc.2d 768,777, 761 N.Y.S.2d 787 (Sup.Ct., Westchester County 2003). By sending a notice of the right to arbitrate, counsel had triggered the client’s right to elect arbitration and could not thereafter refuse to submit the fee dispute to arbitration, despite the fact that the request was submitted after the 30-day statutory period had expired. Williams v Foubister , 176 Misc.2d 702, 673 NYS2d 840 (Monroe Co. Ct. 1998). Attorney sued in City Court while fee dispute was pen...\n",
            "\n",
            "Document Index: 19, Original Chunk ID: chunk_19, Score: 22.1370, Relevance: Not Relevant\n",
            "Snippet: LLP v. Altman , 2009 NY Slip Op 31294(U), 2009 WL 1725926 (Sup. Ct. New York County). “Therefore, since the subject Retainer Agreement did not conform with the written waiver form prescribed by the Board of Governors, the Court adheres to its prior determination that the parties did not waive their right to de novo review.” Waiver of the right to arbitrate under Part 137 Pascazi Law Offs., PLLC v Pioneer Natural Pools, Inc., 2016 N.Y. App. Div. LEXIS 1152 (N.Y. App. Div. 2d Dep't Feb. 17, 2016) ...\n",
            "\n",
            "------------------------------\n",
            "--- Dense Retrieval Top 5 Results (from Qdrant) ---\n",
            "Document ID: 0, Original Chunk ID: chunk_0, Score: 0.6257, Relevance: Relevant\n",
            "Snippet: BOARD OF GOVERNORS  New York State Unified Court System Office of Court Administration Office of ADR Programs January 8, 2018 These case summaries are provided for informational purposes only and for the convenience of th ose interested in learning more about the Attorney-Client Fee Arbitration Program. The summaries should not be construed as an endorsement of any particular case by the Board of Governors or the Office of Court Administration, and do not constitute legal advice or counsel.  1 T...\n",
            "\n",
            "Document ID: 3, Original Chunk ID: chunk_3, Score: 0.6196, Relevance: Not Relevant\n",
            "Snippet: Gottlieb v. Marusya , 2004 NY Slip Op 51816U; 6 Misc. 3d 1023A; 800 N.Y.S.2d 346; 2004 N.Y. Misc. LEXIS 2988; 233 N.Y.L.J. 6, (Civil Court New York 2004). Attorney was not required to provide notice to client of the right to arbitrate because representation began in December 2001, prior to the effective date of Part 137. Attorney met w/ client in Dec. 2001 and opened client's file in Dec. 2001. Retainer was sent to client in Dec. 2001. Client did not sign letter or send retainer check to attorne...\n",
            "\n",
            "Document ID: 25, Original Chunk ID: chunk_25, Score: 0.5430, Relevance: Not Relevant\n",
            "Snippet: Whether interest should be allowed from time of breach is a question of law and fact for the arbitrator to determine. Meyers v. Sorote , Index #: 109305/2009 (Sup. Ct. New York 2010). Arbitrator’s interpretation of NYCLA rule 1.5 refusing to allow party to use a personal recording device was not a basis to overturn the award. The rule does not appear to contemplate the use of a personal recording device of the kind brought by party. Leaves \"recording\" up to the arbitrator. Matter of Sciandra v P...\n",
            "\n",
            "Document ID: 21, Original Chunk ID: chunk_21, Score: 0.5192, Relevance: Not Relevant\n",
            "Snippet: Ween v. Dow , 2006 NY Slip Op 7227, 2006 N.Y. App. Div. LEXIS 12033 (First Dept. 2006). The Court framed the issue as: Whether a provision in a retainer agreement, which holds the client liable for attorneys’ fees incurred in the collection of fees generated under the retainer agreement, is void as against public policy. The Appellate Division held, “the very nature of the provision, which permits the recovery of attorneys’ fees by the attorney should he prevail in a collection action, without a...\n",
            "\n",
            "Document ID: 24, Original Chunk ID: chunk_24, Score: 0.5186, Relevance: Not Relevant\n",
            "Snippet: Division upheld the lower court’s determination that client was precluded from pursuing the malpractice action. Wallenstein v. Cohen , 2007 NY Slip Op 9023; 2007 N.Y. App. Div. LEXIS 11874 (App. Div. 2d Dept. 2007) (Part 136) Plaintiff/ Client complained to the Grievance Committee that attorney charged her excessive fees. The GC referred her to fee dispute arbitration under Part 136. The arbitrators determined that the attorney was entitled to his fee. (The court makes note that the plaintiff wa...\n",
            "\n",
            "------------------------------\n",
            "--- Hybrid (RRF) Top 5 Results ---\n",
            "Rank: 1, Document Index: 0, Original Chunk ID: chunk_0, RRF Score: 0.0325, Relevance: Relevant\n",
            "Snippet: BOARD OF GOVERNORS  New York State Unified Court System Office of Court Administration Office of ADR Programs January 8, 2018 These case summaries are provided for informational purposes only and for the convenience of th ose interested in learning more about the Attorney-Client Fee Arbitration Program. The summaries should not be construed as an endorsement of any particular case by the Board of Governors or the Office of Court Administration, and do not constitute legal advice or counsel.  1 T...\n",
            "\n",
            "Rank: 2, Document Index: 3, Original Chunk ID: chunk_3, RRF Score: 0.0313, Relevance: Not Relevant\n",
            "Snippet: Gottlieb v. Marusya , 2004 NY Slip Op 51816U; 6 Misc. 3d 1023A; 800 N.Y.S.2d 346; 2004 N.Y. Misc. LEXIS 2988; 233 N.Y.L.J. 6, (Civil Court New York 2004). Attorney was not required to provide notice to client of the right to arbitrate because representation began in December 2001, prior to the effective date of Part 137. Attorney met w/ client in Dec. 2001 and opened client's file in Dec. 2001. Retainer was sent to client in Dec. 2001. Client did not sign letter or send retainer check to attorne...\n",
            "\n",
            "Rank: 3, Document Index: 2, Original Chunk ID: chunk_2, RRF Score: 0.0306, Relevance: Not Relevant\n",
            "Snippet: Rotker v. Rotker, 195 Misc.2d 768,777, 761 N.Y.S.2d 787 (Sup.Ct., Westchester County 2003). By sending a notice of the right to arbitrate, counsel had triggered the client’s right to elect arbitration and could not thereafter refuse to submit the fee dispute to arbitration, despite the fact that the request was submitted after the 30-day statutory period had expired. Williams v Foubister , 176 Misc.2d 702, 673 NYS2d 840 (Monroe Co. Ct. 1998). Attorney sued in City Court while fee dispute was pen...\n",
            "\n",
            "Rank: 4, Document Index: 25, Original Chunk ID: chunk_25, RRF Score: 0.0302, Relevance: Not Relevant\n",
            "Snippet: Whether interest should be allowed from time of breach is a question of law and fact for the arbitrator to determine. Meyers v. Sorote , Index #: 109305/2009 (Sup. Ct. New York 2010). Arbitrator’s interpretation of NYCLA rule 1.5 refusing to allow party to use a personal recording device was not a basis to overturn the award. The rule does not appear to contemplate the use of a personal recording device of the kind brought by party. Leaves \"recording\" up to the arbitrator. Matter of Sciandra v P...\n",
            "\n",
            "Rank: 5, Document Index: 20, Original Chunk ID: chunk_20, RRF Score: 0.0288, Relevance: Not Relevant\n",
            "Snippet: C. v. Bethany M. Killeen, (235 A.D.2d 17, 663 N.Y.S.2d 356 (3d Dept. 1997). Court held that an arbitration panel convened pursuant to Part 136 exceeded its authority by making an imperfectly executed award; the award did not contain any rationale for the panel’s decision, and since there was no record of the arbitration hearing, the reviewing court could find no support for the panel’s decision to relieve the client from paying the fee. McNamee, Lochner, C. v. Bethany M. Killeen , (267 A.D.2d 91...\n",
            "\n",
            "------------------------------\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "e02233cb"
      },
      "source": [
        "## Analysis Summary and Key Findings\n",
        "\n",
        "Based on the evaluation performed using the `eval_dataset_conceptual.json` dataset and the implemented retrieval methods (BM25, Dense, Hybrid RRF), here are the key findings:\n",
        "\n",
        "1.  **Evaluation Dataset Limitation:** A significant finding is the structure of the evaluation dataset, where typically only one `relevant_chunk_id` is provided per query. This means the evaluation metrics (Precision, Recall, MRR) are measuring the ability of each method to retrieve *that specific chunk*, rather than all potentially relevant pieces of information for a query. This limitation affects the interpretation of the results, particularly Precision and Recall.\n",
        "\n",
        "2.  **BM25 Performance:**\n",
        "    *   BM25 consistently achieves **Recall@10 = 1.0000** for the evaluated queries, indicating that the specific relevant chunk is reliably found within the top 10 retrieved documents.\n",
        "    *   However, its **Precision@10 = 0.1000** suggests that while the relevant chunk is present in the top 10, it's often ranked alongside 9 irrelevant documents (based on the current ground truth definition). Its MRR varies, showing the relevant chunk is sometimes ranked highly (Rank 1 or 2).\n",
        "\n",
        "3.  **Dense Retrieval Performance:**\n",
        "    *   Dense retrieval performance is more inconsistent. While it can rank the relevant chunk very highly for some queries (contributing to MRR=1.0000 and positive P@K/R@K), for other queries, it completely fails to retrieve the relevant chunk within the top 5 or 10 results (resulting in P@K=0.0000, R@K=0.0000, and low MRR).\n",
        "    *   This inconsistency might be attributed to the general-purpose nature of the embedding model or the semantic complexity of certain legal queries relative to the chunk content.\n",
        "\n",
        "4.  **Hybrid (RRF) Performance:**\n",
        "    *   Hybrid RRF shows promise, often achieving high MRR (frequently 1.0000 or 0.5000) and matching BM25's Recall@10.\n",
        "    *   However, similar to Dense, Hybrid RRF's Precision@10 is also impacted by the low proportion of relevant documents in the top 10 according to the single-chunk ground truth. If the Dense component fails to bring the relevant chunk into the initial pool effectively, the Hybrid result for small K can also suffer.\n",
        "\n",
        "**Overall Insights:**\n",
        "\n",
        "*   All methods demonstrate the ability to retrieve the relevant chunk within the top 10 for most queries evaluated (good Recall@10).\n",
        "*   The primary challenge highlighted by the metrics is improving the **precision** of the top retrieved results – ensuring the most relevant documents are ranked at the very top.\n",
        "*   The inconsistency in Dense retrieval's performance suggests potential areas for improvement, such as exploring different embedding models or chunking strategies.\n",
        "*   The current evaluation dataset, while useful, limits our ability to measure how well the systems retrieve *all* relevant information for a query. A more comprehensive ground truth with multiple relevant chunks per query would provide a richer evaluation.\n",
        "\n",
        "These findings suggest that focusing on techniques that enhance the ranking of initial retrieval results, such as **Re-ranking**, or refining the Dense retrieval approach (embedding model, chunking) would be valuable next steps to improve overall performance in this legal research scenario."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "29dbec23"
      },
      "source": [
        "## Explore Advanced Concept: Re-ranking with Cross-Encoders\n",
        "\n",
        "### Subtask:\n",
        "Implement a re-ranking step using a Cross-Encoder model."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "eaf15e5b"
      },
      "source": [
        "**Reasoning**:\n",
        "Implement a re-ranking step to improve the precision of the initial retrieval results. Cross-Encoder models are effective for this task as they jointly encode the query and retrieved documents to provide a more nuanced relevance score. We will demonstrate this by re-ranking the top results from BM25."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "71fbfcf1"
      },
      "source": [
        "### What are Cross-Encoders for Re-ranking?\n",
        "\n",
        "In the context of retrieval, we've seen **Bi-Encoder** models (like the Sentence-BERT model we used for Dense Retrieval). Bi-Encoders encode the query and documents independently into separate embeddings. Relevance is then calculated based on the similarity of these independent embeddings (e.g., cosine similarity). This is efficient for initial retrieval across a large corpus because you only need to encode the query once and can pre-compute document embeddings.\n",
        "\n",
        "**Cross-Encoder** models, on the other hand, take the query and a document (or pair of query-document) as input *together* and produce a single relevance score. The model can pay attention to the interactions between the query and document terms directly within the encoding process. This allows Cross-Encoders to capture more subtle relevance signals and context compared to comparing separate embeddings from a Bi-Encoder.\n",
        "\n",
        "**How they work for Re-ranking:**\n",
        "\n",
        "Cross-Encoders are typically too slow to use for the initial retrieval of all documents in a large corpus because they require a separate pass through the model for every query-document pair. However, they are perfect for **re-ranking** a smaller set of documents.\n",
        "\n",
        "The process is:\n",
        "\n",
        "1.  Perform an initial retrieval step using a fast method like BM25 or a Bi-Encoder (Dense Retrieval) to get a set of top N candidate documents (e.g., N=50 or 100).\n",
        "2.  For each candidate document in this set, create a query-document pair.\n",
        "3.  Pass each query-document pair through a Cross-Encoder model, which outputs a relevance score for that specific pair.\n",
        "4.  Re-sort the N candidate documents based on the relevance scores from the Cross-Encoder.\n",
        "\n",
        "The result is a re-ranked list where the documents most relevant to the query (according to the Cross-Encoder's more detailed analysis) are placed at the top.\n",
        "\n",
        "### Implementation:\n",
        "\n",
        "We can use a pre-trained Cross-Encoder model from the `sentence-transformers` library for this."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 291,
          "referenced_widgets": [
            "09b5f1e4e915457ca2bf70d4bfde96e5",
            "c72e20d4d4c449ad9ca97dc7cdb0108a",
            "1e5b0571afc247f587fa8be0c499ed0a",
            "a128750574454adda07535ab3f143306",
            "cc0dfb9dda4b46eebebd8905ce2699eb",
            "13005411d6de49a2ad937f14f65daaf9",
            "e76faf33c10f4e9aa96dd668a9c269b3",
            "5193f699630e4888add51c8273032ae6",
            "dac1284edc434b42a82931e74e4f1899",
            "b0f36841774842b6b259c36f90344fec",
            "b3b6e718b62a47c2991a97754ef1b602",
            "199d7c6c673b419f970294e08e2e0166",
            "3069e046272f4049ac51258ec491d81a",
            "f0a3253e61fa41a0a00f0a93d8fd03b1",
            "3e13927cd5f9462299db03a330b60a0b",
            "d8764e5192944439a838572c849b2290",
            "d8b4229e16bc450fb7cc4973e48d0c14",
            "abebe936ff904ca2a90bc912813139f2",
            "c650ebe33046415d9e5cad777efa7a3c",
            "a5e973b3a1954de7bb4c8578c3990ccc",
            "50d1fcc69381452bbe2786fcc9b79c67",
            "8afcad4bdd6a493491c9ca893c0008b0",
            "f24c6faf34c441b1abd3a8a29b87dbe2",
            "51a04756889d453a9e8431e8804ebf78",
            "55887ee3451740ceaf25f82d68c8e693",
            "08be1db8aae644bd941443a2644d5ed8",
            "ea88633b1e5643cb81b07f0fa8f56034",
            "ae537262e3994156b850e14ccf995473",
            "40a0edfa9e984217a52c336dc0ec8a1b",
            "6183b389a2c0499093c09c9b7f46c87b",
            "8883ce6882464dfdaf843bf9f09cbc5e",
            "7b27cf35428949378658a5b480b981a2",
            "06610b1cef544b5f86a8483f35d7ad52",
            "142e95a07703441e8235227fb8bb9474",
            "c95221df669c4a538a1040f70b9c5a43",
            "8efe281f362f4aa9a36ac4594f396768",
            "9b86857b1e2847afaa8a00653e36de83",
            "f9bc9132e186435eb89a4248b676f425",
            "b04a600f949d4290a48e2ebb4a7587d9",
            "b23a4231f5094e80a8242af51e0035bc",
            "d1107661d1aa48c590b677d73244af25",
            "9b35bdab71d84a89a14786ec94d64068",
            "5fb1accd05ac49a9acefa1ff4329440e",
            "75ac1fe59aaf4d1293153dfac7e5996e",
            "c2bbf39478be49358fa775a498b76b58",
            "b96afdb284db4c8e9bb4dac5360bf432",
            "18bb7b01808e40128c8685457be05b6a",
            "b89db6210af84cd7aef80f4ebfe9ff18",
            "4e5317ae06cc434095769c547b2f6f6f",
            "eac10115bbd0425b93826aa0a3998878",
            "96f6616f1047414694ea183e8bb23cd8",
            "61779299760944fda534fee3cf1da2e1",
            "1ee66368c10746788314639987e81504",
            "9659de0f0985461886faa3a9e75e7d32",
            "836b5406ed6e496ca8781245e44142ee",
            "695eb59bb62748a7b0562824d6b9ad49",
            "f17ad7b6c61c48ad8bad54b6dd839b3c",
            "a08e31ff21904e7ea201d51d3dd1b5b7",
            "0368f78592f94a06a65aca73e7594147",
            "337cd0ca29834aacab439742a102a1dc",
            "f7271c864fde4a01be2f17745d115666",
            "94166791d1ba43b2bd09aae63ce095f6",
            "d0e1f9b4bad141e79e975b0d2c4e2177",
            "271e563038ae429f9038dfae5bd954fa",
            "0c41773e6d3c4a10a4b9a72194098424",
            "17757038d23541ebbbac3d37e2aa6e85",
            "44bad325f8924a9d8a9f142092ef54c3",
            "e224de5282d44c07ad2b51f3abf8c0f5",
            "bb07d5f9f8ea43fcb71a6ac87297c931",
            "afb539fe1b994a36b923ea62822bc192",
            "eac12633d31d477bad0c3e56281c2939",
            "3a64ba2223f54f788b25a15726154227",
            "5d5e02909fdb49f7a8cd35c40b99abe0",
            "7f188c98477e4d73a772db04713bab2a",
            "3ec6dd613dd24469b669ab8300ffa1bf",
            "0ef2661e79b24bfb9890b160a276fb32",
            "02bdc2268b40439bbf18d2fe095e8a81",
            "ff172bba325d476c969dbbde23194ffe",
            "950d8cff561843d28b8babedf4800e47",
            "b87833978ee549f6afe5dbeee7bfc919",
            "0a8ad999794f4b6e95174d8e8a89434a",
            "8453c76b047947dda0efc1b15f59858a",
            "2c8ac80910bf4a739b3e66fdc0465f5b",
            "0a341e67003842c8bd017361c1f8cc59",
            "5e69dd06a98b4cdcbe670d16a323e85b",
            "53670c12f42a48fa904fc6b3eb5267b4",
            "129a5014c6c04988913143251fd7b980",
            "9bfbffca3bea45b082d870eca9537ae3"
          ]
        },
        "id": "469d40bb",
        "outputId": "40bff757-da94-42d4-ab8d-5cdce6baea9c"
      },
      "source": [
        "from sentence_transformers import CrossEncoder\n",
        "\n",
        "# Load a pre-trained Cross-Encoder model\n",
        "# Trying a different common Cross-Encoder model\n",
        "cross_encoder_model = CrossEncoder('cross-encoder/stsb-roberta-large')\n",
        "\n",
        "print(\"Cross-Encoder model loaded.\")"
      ],
      "execution_count": 34,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "config.json:   0%|          | 0.00/629 [00:00<?, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "09b5f1e4e915457ca2bf70d4bfde96e5"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "model.safetensors:   0%|          | 0.00/1.42G [00:00<?, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "199d7c6c673b419f970294e08e2e0166"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "tokenizer_config.json: 0.00B [00:00, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "f24c6faf34c441b1abd3a8a29b87dbe2"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "vocab.json: 0.00B [00:00, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "142e95a07703441e8235227fb8bb9474"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "merges.txt: 0.00B [00:00, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "c2bbf39478be49358fa775a498b76b58"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "tokenizer.json: 0.00B [00:00, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "695eb59bb62748a7b0562824d6b9ad49"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "special_tokens_map.json: 0.00B [00:00, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "44bad325f8924a9d8a9f142092ef54c3"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "README.md: 0.00B [00:00, ?B/s]"
            ],
            "application/vnd.jupyter.widget-view+json": {
              "version_major": 2,
              "version_minor": 0,
              "model_id": "ff172bba325d476c969dbbde23194ffe"
            }
          },
          "metadata": {}
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Cross-Encoder model loaded.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "f85ab896"
      },
      "source": [
        "**Reasoning**:\n",
        "Perform the re-ranking step by taking the top results from an initial retrieval method (BM25), creating query-document pairs, passing them through the Cross-Encoder model to get relevance scores, and then re-sorting the documents based on these scores."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "e623cd25",
        "outputId": "8f43b18c-57f3-42bb-c610-3e4d8a31b62e"
      },
      "source": [
        "# Define the query (using the same query as in BM25/Dense retrieval)\n",
        "query = \"requirements for recovering legal fees\"\n",
        "\n",
        "# --- Get Initial Retrieval Results (using BM25) ---\n",
        "# We'll use the top N results from BM25 as the candidates for re-ranking\n",
        "# Let's take a slightly larger initial set for re-ranking, e.g., top 20 or 50\n",
        "initial_retrieval_k = 20 # Number of top BM25 results to re-rank\n",
        "\n",
        "# Re-run BM25 retrieval for the query to get initial candidates\n",
        "tokenized_query_bm25 = word_tokenize(query.lower())\n",
        "doc_scores_bm25 = bm25.get_scores(tokenized_query_bm25)\n",
        "# Get the indices of the top K initial candidates\n",
        "initial_candidate_indices = doc_scores_bm25.argsort()[-initial_retrieval_k:][::-1]\n",
        "\n",
        "# Get the actual document texts for the initial candidates from the DataFrame\n",
        "initial_candidate_texts = [df.iloc[i]['text'] for i in initial_candidate_indices]\n",
        "\n",
        "print(f\"Initial {initial_retrieval_k} candidates retrieved from BM25.\")\n",
        "\n",
        "# --- Perform Re-ranking with Cross-Encoder ---\n",
        "\n",
        "# Create query-document pairs for the Cross-Encoder\n",
        "# Format: [(query, document_text), (query, document_text), ...]\n",
        "cross_encoder_input = [(query, text) for text in initial_candidate_texts]\n",
        "\n",
        "# Get relevance scores from the Cross-Encoder\n",
        "# The model outputs a score for each pair\n",
        "relevance_scores = cross_encoder_model.predict(cross_encoder_input)\n",
        "\n",
        "# Pair the original document indices with their re-ranking scores\n",
        "document_scores = list(zip(initial_candidate_indices, relevance_scores))\n",
        "\n",
        "# Sort the documents based on the Cross-Encoder relevance scores in descending order\n",
        "reranked_documents = sorted(document_scores, key=lambda item: item[1], reverse=True)\n",
        "\n",
        "# --- Display Re-ranked Results ---\n",
        "\n",
        "print(\"\\n--- Re-ranked Results (Top 5) ---\")\n",
        "top_n_reranked = 5 # Display top 5 after re-ranking\n",
        "text_snippet_length = 300\n",
        "\n",
        "if reranked_documents:\n",
        "    for rank, (doc_index, score) in enumerate(reranked_documents[:top_n_reranked]):\n",
        "        snippet = df.iloc[doc_index]['text'][:text_snippet_length] + '...' if len(df.iloc[doc_index]['text']) > text_snippet_length else df.iloc[doc_index]['text']\n",
        "        # Retrieve original chunk ID for clarity\n",
        "        original_chunk_id = df.iloc[doc_index]['chunk_id'] if doc_index < len(df) else \"N/A\"\n",
        "        print(f\"Rank: {rank+1}, Document Index: {doc_index}, Original Chunk ID: {original_chunk_id}, Rerank Score: {score:.4f}\")\n",
        "        print(f\"Snippet: {snippet}\\n\")\n",
        "else:\n",
        "    print(\"No documents to re-rank.\")"
      ],
      "execution_count": 35,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Initial 20 candidates retrieved from BM25.\n",
            "\n",
            "--- Re-ranked Results (Top 5) ---\n",
            "Rank: 1, Document Index: 8, Original Chunk ID: chunk_8, Rerank Score: 0.6037\n",
            "Snippet: Gahagan v. Gahagan, 51 A.D.3d 863 (N.Y. App. Div. 2d Dep't 2008); Attorney is precluded from recovering legal fees where he or she did not comply with 22 NYCRR 1400.3, requiring attorney to execute and file a retainer agreement that sets forth, inter alia, the terms of compensation and the nature of...\n",
            "\n",
            "Rank: 2, Document Index: 9, Original Chunk ID: chunk_9, Rerank Score: 0.5823\n",
            "Snippet: Plant v. Channing , 299 A.D.2d 696, 698 (N.Y. App. Div. 3d Dep't 2002). Upheld a fee arbitration award finding that the attorney was not entitled to any fees based on several violations of the matrimonial rules, including failure to provide a written retainer, failure to provide a statement of clien...\n",
            "\n",
            "Rank: 3, Document Index: 3, Original Chunk ID: chunk_3, Rerank Score: 0.5802\n",
            "Snippet: Gottlieb v. Marusya , 2004 NY Slip Op 51816U; 6 Misc. 3d 1023A; 800 N.Y.S.2d 346; 2004 N.Y. Misc. LEXIS 2988; 233 N.Y.L.J. 6, (Civil Court New York 2004). Attorney was not required to provide notice to client of the right to arbitrate because representation began in December 2001, prior to the effec...\n",
            "\n",
            "Rank: 4, Document Index: 1, Original Chunk ID: chunk_1, Rerank Score: 0.5699\n",
            "Snippet: Herrick v. Lyon 7 A.D. 3d 571, 777 N.Y.S.2d 141 (App. Div. Second Dept. 2004). Plaintiff attorney commenced an action in Supreme Court to recover fees and disbursements for his representation of defendant client involving the enforcement of provisions of a divorce judgement. Defendant client moved t...\n",
            "\n",
            "Rank: 5, Document Index: 24, Original Chunk ID: chunk_24, Rerank Score: 0.5373\n",
            "Snippet: Division upheld the lower court’s determination that client was precluded from pursuing the malpractice action. Wallenstein v. Cohen , 2007 NY Slip Op 9023; 2007 N.Y. App. Div. LEXIS 11874 (App. Div. 2d Dept. 2007) (Part 136) Plaintiff/ Client complained to the Grievance Committee that attorney char...\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "4613790a"
      },
      "source": [
        "## Retrieval Augmented Generation (RAG) Integration\n",
        "\n",
        "### Subtask:\n",
        "Integrate a retrieval method (BM25) with the Groq LLM to answer a query based on retrieved context."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "e3d8c0fb"
      },
      "source": [
        "**Reasoning**:\n",
        "Demonstrate the RAG pipeline by using the BM25 retrieval method to fetch relevant document chunks for a user query. These retrieved chunks will then be provided as context to the Groq LLM, which will generate an answer based on the information in the chunks."
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "1b2123a9",
        "outputId": "9bc819c1-d877-4671-9858-765bc0008f75"
      },
      "source": [
        "# Define the query for the RAG pipeline\n",
        "rag_query = \"requirements for recovering legal fees\" # Using a query we've worked with\n",
        "\n",
        "# --- Retrieval Step (using BM25) ---\n",
        "# Use the BM25 object initialized earlier\n",
        "# Assuming 'bm25' and 'df' are available from previous cells\n",
        "\n",
        "tokenized_rag_query = word_tokenize(rag_query.lower())\n",
        "doc_scores_rag = bm25.get_scores(tokenized_rag_query)\n",
        "\n",
        "# Get the top N relevant chunks using BM25\n",
        "top_n_rag = 5 # You can adjust the number of chunks to retrieve\n",
        "top_n_rag_indices = doc_scores_rag.argsort()[-top_n_rag:][::-1]\n",
        "\n",
        "# Extract the text content of the top N chunks\n",
        "retrieved_rag_chunks = [df.iloc[i]['text'] for i in top_n_rag_indices]\n",
        "\n",
        "print(f\"Retrieved {len(retrieved_rag_chunks)} chunks for RAG pipeline using BM25.\")\n",
        "# Optionally display snippets of retrieved chunks\n",
        "# for i, chunk in enumerate(retrieved_rag_chunks):\n",
        "#     print(f\"Chunk {i+1}: {chunk[:300]}...\\n\")\n",
        "\n",
        "\n",
        "# --- Preparation Step (Format context for LLM) ---\n",
        "# Combine the retrieved chunks into a single context string\n",
        "context_for_llm = \"\\n---\\n\".join(retrieved_rag_chunks)\n",
        "\n",
        "# Create the prompt for the LLM\n",
        "# Instruct the LLM to answer based ONLY on the provided context\n",
        "prompt_for_llm = f\"\"\"\n",
        "Based on the following context, please answer the user's question.\n",
        "If the answer cannot be found in the context, please state that you cannot answer based on the provided information.\n",
        "\n",
        "Context:\n",
        "{context_for_llm}\n",
        "\n",
        "Question:\n",
        "{rag_query}\n",
        "\n",
        "Answer:\n",
        "\"\"\"\n",
        "\n",
        "print(\"Prompt for LLM created.\")\n",
        "# print(\"--- Prompt Preview ---\")\n",
        "# print(prompt_for_llm[:500] + \"...\")\n",
        "\n",
        "\n",
        "# --- Generation Step (using Groq LLM) ---\n",
        "# Assuming 'llm' (Groq ChatGroq instance) is available from previous cells\n",
        "\n",
        "print(\"Sending prompt to LLM...\")\n",
        "llm_response = llm.invoke(prompt_for_llm)\n",
        "\n",
        "# --- Display Results ---\n",
        "print(\"\\n--- RAG Generated Answer ---\")\n",
        "print(llm_response.content)"
      ],
      "execution_count": 36,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Retrieved 5 chunks for RAG pipeline using BM25.\n",
            "Prompt for LLM created.\n",
            "Sending prompt to LLM...\n",
            "\n",
            "--- RAG Generated Answer ---\n",
            "**Key requirements that a lawyer must meet in order to recover legal fees in New York**\n",
            "\n",
            "| Area | What the lawyer must do | Why it matters | Consequence of non‑compliance |\n",
            "|------|------------------------|----------------|------------------------------|\n",
            "| **Matrimonial‑law fee arbitration (Part 137 & Part 1400)** | 1. **Written retainer agreement** that sets out the scope of services, fees, expenses and billing practices (22 NYCRR 1400.3).  <br>2. **Statement of client’s rights and responsibilities** (22 NYCRR 1400.2).  <br>3. **Itemized bills every 60 days** (22 NYCRR 1400.2).  <br>4. **Notice of right to arbitrate** within 30 days after the retainer is executed (22 NYCRR 136.5(a)). | These rules were enacted to protect consumers from abusive billing practices.  The arbitrator’s award is only valid if the lawyer has complied with all four elements. | **Preclusion** – the lawyer cannot recover any fees (or only a reduced amount) if any of the above requirements are missing or not performed.  Courts routinely dismiss fee‑disputes or reduce awards for non‑compliance. |\n",
            "| **Arbitration‑specific rules (Part 136)** | • Provide the 30‑day notice of the right to arbitrate **even if the client has not yet disputed the fee**. <br>• File the notice and the retainer agreement with the clerk of the court in a timely fashion. | Failure to give the notice or file the retainer can lead to dismissal of the fee‑claim or a “preclusion” from recovering fees.  The court may also order the attorney to hand over the client’s file to the new counsel if the client elects to arbitrate. | **Dismissal of fee‑claim** and potential loss of file. |\n",
            "| **Non‑matrimonial matters (Part 1215.1)** | • Provide a **written letter of engagement** or a written retainer agreement that explains scope, fees, expenses and billing practices. <br>• If the lawyer fails to comply with 22 NYCRR 1215.1, the lawyer still may recover on a **quantum‑meruit** basis, but must: <br>  – **Prove the terms** of the fee arrangement, <br>  – Show that the terms were **fair, fully understood, and agreed to** by the client. | The rule is a “burden‑shifting” provision: non‑compliance shifts the burden onto the lawyer to prove the fee arrangement.  Courts will not automatically bar recovery, but will scrutinize the evidence. | **Reduced fee** or dismissal if the lawyer cannot satisfy the burden of proof. |\n",
            "| **General procedural compliance** | • File a **letter of engagement** or retainer **before or at the start of representation** (or at the effective date if the retainer was signed before the effective date). <br>• Keep accurate, timely billing records and provide them to the client. | Courts look at the lawyer’s entire fee‑dispute history; a single lapse (e.g., missing a 60‑day bill) can be enough to preclude recovery. | **Partial or total loss** of fees; sometimes the court will order a reduced award or dismissal of the claim. |\n",
            "| **Reargument / new theory of liability** | • The lawyer may not file a reargument that simply introduces a **new theory of liability** that was not advanced on the original motion.  The lawyer must argue that the dispute falls outside the Part 137 program in the original motion (CPLR 2221(d) 2). | The court will deny a reargument if the lawyer only adds a new liability theory without showing the dispute is outside Part 137. | **Denied reargument**; the fee‑claim remains as originally decided. |\n",
            "\n",
            "### Bottom line\n",
            "\n",
            "1. **Comply with the relevant NYCRR rules** (Part 137/1400 for matrimonial matters; Part 136 for arbitration notice; Part 1215.1 for non‑matrimonial matters).  \n",
            "2. **Provide a written retainer or letter of engagement** that fully explains the fee arrangement.  \n",
            "3. **Issue itemized bills every 60 days** and give the client a statement of rights.  \n",
            "4. **Give the client a 30‑day notice of the right to arbitrate** (if applicable).  \n",
            "5. If any of these steps are omitted or performed incorrectly, the lawyer is **precluded or substantially limited** in recovering fees.  \n",
            "\n",
            "If a lawyer does not comply, the court may dismiss the fee‑claim, reduce the award, or require the lawyer to hand over the client’s file.  In non‑matrimonial cases, the lawyer may still recover on a quantum‑meruit basis but must prove the fee terms were fair, understood and agreed to.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "ddfe3a02"
      },
      "source": [
        "## Explore Advanced Concept: ANN Indexes\n",
        "\n",
        "**Reasoning**:\n",
        "Explain the concept of Approximate Nearest Neighbor (ANN) indexes and their importance for efficient similarity search in vector databases, which is crucial for scaling dense retrieval."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "9b08d11f"
      },
      "source": [
        "#### What are ANN Indexes?\n",
        "\n",
        "When we perform Dense Retrieval, we convert our documents (chunks) and queries into vectors (embeddings). To find the most relevant documents for a query, we need to find the document vectors that are \"closest\" or most \"similar\" to the query vector in the high-dimensional embedding space. This is called **Nearest Neighbor Search**.\n",
        "\n",
        "For a small number of documents, we could calculate the similarity between the query vector and *every single document vector* and then sort the results. This is called **Exhaustive Nearest Neighbor Search** or **Brute Force Search**.\n",
        "\n",
        "However, if you have millions or billions of document embeddings, calculating the similarity to every single one for every query is computationally infeasible and very slow.\n",
        "\n",
        "**Approximate Nearest Neighbor (ANN) Indexes** are data structures and algorithms designed to solve this problem. Instead of guaranteeing finding the *absolute* nearest neighbors, ANN methods aim to find neighbors that are \"close enough\" or \"approximately\" the nearest neighbors, but do so much, much faster than brute force search.\n",
        "\n",
        "They achieve this speedup by organizing the vectors in a way that allows them to quickly narrow down the search space and avoid comparing the query vector to every single document vector.\n",
        "\n",
        "#### How They Work (High-Level Intuition):\n",
        "\n",
        "ANN algorithms use various techniques to structure the embedding space. Some common approaches include:\n",
        "\n",
        "*   **Tree-based methods:** Building tree-like structures where vectors are partitioned into hierarchical clusters (e.g., KD-trees, Annoy).\n",
        "*   **Graph-based methods:** Building graphs where vectors are nodes, and edges connect nearby vectors. Searching involves traversing the graph (e.g., HNSW - Hierarchical Navigable Small Worlds, which Qdrant often uses).\n",
        "*   **Hashing-based methods:** Using hashing functions to map similar vectors to the same or nearby buckets (e.g., Locality-Sensitive Hashing - LSH).\n",
        "*   **Quantization-based methods:** Compressing the vectors or the search space (e.g., Product Quantization).\n",
        "\n",
        "#### Importance for Dense Retrieval:\n",
        "\n",
        "ANN indexes are fundamental to making Dense Retrieval scalable in real-world applications. Vector databases like Qdrant, Weaviate, Pinecone, etc., heavily rely on optimized ANN index implementations to perform similarity searches over large collections of embeddings with low latency. When we call `client.query_points` in Qdrant, under the hood, it's using an ANN index to quickly find the approximate nearest neighbors to our query embedding.\n",
        "\n",
        "Understanding ANN indexes helps appreciate how vector databases can provide fast semantic search capabilities even with massive datasets."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "41ae4758"
      },
      "source": [
        "### Explore Advanced Concept: Chunking Strategies\n",
        "\n",
        "**Reasoning**:\n",
        "Discuss the importance of chunking strategies in retrieval, explaining how different approaches can impact both retrieval recall and precision, and potentially the context provided to an LLM in RAG."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "e639c5a8"
      },
      "source": [
        "#### What are Chunking Strategies and Why are They Important?\n",
        "\n",
        "Chunking is the process of splitting a long document into smaller, manageable pieces called \"chunks.\" This is a critical step in preparing data for retrieval systems, especially for embedding-based methods and RAG.\n",
        "\n",
        "The way you chunk your documents significantly impacts the performance of your retrieval system:\n",
        "\n",
        "*   **Recall:** If chunks are too large, they might contain multiple distinct pieces of information, and a query might only be related to a small part of the chunk. The embedding for that large chunk might not be specific enough to match the query well. If chunks are too small, relevant information might be split across multiple chunks, making it harder to retrieve all necessary context.\n",
        "*   **Precision:** If chunks are too large and contain irrelevant information alongside relevant parts, they can be retrieved for queries they are only partially related to, lowering precision. If chunks are too small, the system might retrieve many small, less informative pieces instead of a complete relevant section.\n",
        "*   **LLM Context Window (for RAG):** In RAG, the retrieved chunks are often fed to an LLM as context. LLMs have limited context windows. Chunk size directly affects how many retrieved chunks can fit into the LLM's context. Smaller, focused chunks are often better for fitting more relevant information, but they need to be large enough to contain sufficient context themselves.\n",
        "\n",
        "#### Common Chunking Approaches:\n",
        "\n",
        "We used a `RecursiveCharacterTextSplitter` which splits based on characters and tries to maintain structure by using a list of separators. Other strategies include:\n",
        "\n",
        "*   **Fixed Size Chunking:** Splitting into chunks of a fixed number of characters or tokens, often with overlap. Simple, but might break sentences or paragraphs.\n",
        "*   **Document Structure Aware Chunking:** Splitting based on logical divisions in the document, such as paragraphs, sections, headings, or even sentences. This often preserves semantic units better.\n",
        "*   **Content-Aware Chunking:** More advanced methods that might use NLP techniques to identify topic shifts or key points to determine chunk boundaries.\n",
        "*   **Parent-Child Chunking:** Creating smaller, detailed child chunks for retrieval, but also maintaining larger parent chunks that provide broader context. When a child chunk is retrieved, the corresponding parent chunk (or a summary) is passed to the LLM.\n",
        "\n",
        "#### Impact on Our Project:\n",
        "\n",
        "Our current `df` was loaded from `legal_chunks_conceptual.json`. The chunking strategy used to create this file (presumably based on some LLM process) resulted in chunks that, while having good Recall@10, showed low Precision@10. This suggests that the chunks, as they are currently structured, might be too broad or contain too much irrelevant information alongside the relevant parts, or the boundaries aren't ideal for the embedding model.\n",
        "\n",
        "Experimenting with a different chunking strategy on the original PDF text (if we were to go back to that source) or even analyzing the size and content of the current chunks could be a valuable step for improving performance."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "e398ce76"
      },
      "source": [
        "### Explore Advanced Concept: Metadata Filtering\n",
        "\n",
        "**Reasoning**:\n",
        "Explain the concept of filtering retrieval results based on metadata associated with documents, highlighting its practical use in real-world retrieval systems, especially in a legal context."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "c05d0e3d"
      },
      "source": [
        "#### What is Metadata Filtering?\n",
        "\n",
        "Metadata is \"data about data.\" In the context of document retrieval, metadata includes information about each document or chunk that is not part of the main text content. For legal documents, this could include:\n",
        "\n",
        "*   Case Name\n",
        "*   Court\n",
        "*   Date of Decision/Filing\n",
        "*   Type of Document (e.g., Opinion, Brief, Statute)\n",
        "*   Jurisdiction\n",
        "*   Key Topics or Tags\n",
        "\n",
        "Metadata Filtering is the process of using this associated metadata to narrow down or refine the set of documents considered for retrieval or the final set of retrieved results.\n",
        "\n",
        "#### How it Works:\n",
        "\n",
        "Metadata filtering can be applied in several ways:\n",
        "\n",
        "1.  **Pre-filtering:** Before performing the main retrieval search (BM25 or Dense), you filter the document collection based on metadata. For example, only search within documents filed in a specific court or within a certain date range. This reduces the search space and improves efficiency and potentially precision by excluding irrelevant documents upfront.\n",
        "2.  **Post-filtering:** After performing the initial retrieval search, you filter the *results* based on metadata. For example, retrieve the top 100 documents based on text similarity, and then filter those 100 to only include documents from a specific jurisdiction.\n",
        "3.  **Hybrid Filtering (e.g., in Vector Databases):** Modern vector databases like Qdrant and Weaviate allow you to combine vector similarity search with metadata filtering in a single query. You can search for documents whose embeddings are similar to the query embedding *AND* whose metadata matches specific criteria (e.g., `query=my_vector, filter={\"court\": \"Supreme Court\"}`). This is very powerful as it combines semantic relevance with structured criteria.\n",
        "\n",
        "#### Importance for Legal Research:\n",
        "\n",
        "Metadata filtering is extremely practical in legal research. A lawyer often needs to find relevant cases *from a specific jurisdiction*, *within a certain time period*, or *of a particular case type*. Combining text-based retrieval with metadata filtering allows for much more precise and useful search results.\n",
        "\n",
        "For example, a query like \"requirements for filing a motion\" could retrieve many general documents. But if we filter by `{\"document_type\": \"Motion Filing Guidelines\", \"jurisdiction\": \"New York\"}`, we get a much more targeted set of results.\n",
        "\n",
        "#### Implementation in Our Project:\n",
        "\n",
        "Our current `df` DataFrame (loaded from `legal_chunks_conceptual.json`) might not explicitly contain this kind of structured metadata in separate columns. The `chunk_id_from_json` is present in the Qdrant payload, but that's an internal identifier, not descriptive metadata. To implement metadata filtering, we would need to:\n",
        "\n",
        "1.  Add columns to our `df` DataFrame for relevant metadata (e.g., 'case\\_name', 'year', 'court'). This would likely require extracting this information during the data preparation phase (either from the original PDF if structure allows, or by processing the text content).\n",
        "2.  When ingesting into Qdrant, include this metadata in the `payload` for each point.\n",
        "3.  Modify our retrieval queries (especially the Dense retrieval query using `client.query_points`) to include a `filter` parameter based on the metadata.\n",
        "\n",
        "While we can't fully implement this without adding metadata, understanding the concept is vital for building a practical legal retrieval system."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "006784f4"
      },
      "source": [
        "### Explore Advanced Concept: Context Window Packing / Contextual Compression\n",
        "\n",
        "**Reasoning**:\n",
        "Briefly explain the concepts of Context Window Packing and Contextual Compression, highlighting their role in optimizing the context provided to Large Language Models in Retrieval Augmented Generation (RAG) pipelines."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "da633eb6"
      },
      "source": [
        "#### What are Context Window Packing and Contextual Compression?\n",
        "\n",
        "These concepts are primarily relevant in the **Generation** phase of a RAG pipeline, after retrieval has occurred. They address the challenge of effectively using the limited context window size of Large Language Models (LLMs).\n",
        "\n",
        "*   **LLM Context Window:** LLMs can only process a fixed amount of text input at a time (their context window). If the retrieved documents are too long, they might exceed this limit.\n",
        "*   **Irrelevant Information:** Even within retrieved chunks, there might be irrelevant sentences or paragraphs that dilute the important information and take up valuable context space.\n",
        "\n",
        "**Context Window Packing** and **Contextual Compression** are techniques to optimize the context that is passed to the LLM:\n",
        "\n",
        "*   **Context Window Packing:** This refers to strategies for selecting *which* parts of the retrieved documents to include in the LLM's context window when the total length of retrieved chunks exceeds the limit. Simple packing might just take the top N chunks until the window is full. More advanced packing might prioritize chunks based on their relevance score, or try to include parts from multiple highly-ranked chunks.\n",
        "\n",
        "*   **Contextual Compression:** This involves techniques to *reduce the size* of the retrieved context while retaining the most important information. This can be done by:\n",
        "    *   **Summarization:** Using an LLM or another model to summarize the retrieved chunks before passing them to the main LLM.\n",
        "    *   **Extraction:** Identifying and extracting only the most relevant sentences or key phrases from the retrieved chunks based on the query.\n",
        "    *   **Pruning:** Removing sentences or sections from the retrieved chunks that are least relevant to the query.\n",
        "\n",
        "#### Importance for RAG:\n",
        "\n",
        "These techniques are important for RAG because they help ensure that the most relevant and concise information from the retrieved documents is presented to the LLM, allowing it to generate a better and more focused answer without being overwhelmed by irrelevant text or exceeding its context window limit.\n",
        "\n",
        "In a legal RAG system, this could mean retrieving several case summaries, but then using contextual compression to extract only the specific holdings or reasoning relevant to the user's query before feeding it to the LLM for synthesis.\n",
        "\n",
        "Unlike the retrieval methods we've implemented (BM25, Dense, Hybrid, Re-ranking), which focus on *finding* relevant documents, these concepts focus on *processing and optimizing* the retrieved documents *before* generation."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "39eb4818"
      },
      "source": [
        "## Project Summary and Conclusion\n",
        "\n",
        "### Subtask:\n",
        "Summarize the project, techniques explored, findings, and key learnings."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "27e84c85"
      },
      "source": [
        "### Project Overview\n",
        "\n",
        "In this project, we aimed to explore various retrieval techniques and build components of a Retrieval Augmented Generation (RAG) system for a legal case research assistant, using a dataset of legal case summaries.\n",
        "\n",
        "### Techniques Explored and Implemented\n",
        "\n",
        "We implemented and explored the following retrieval techniques:\n",
        "\n",
        "1.  **Naive Keyword Search:** A basic baseline for comparison.\n",
        "2.  **BM25:** A statistical term-frequency based method that improves upon simple keyword matching.\n",
        "3.  **Dense Retrieval:** Using embedding models and a vector database (Qdrant) to find documents based on semantic similarity.\n",
        "4.  **Hybrid Retrieval (RRF):** Combining BM25 and Dense Retrieval using Reciprocal Rank Fusion.\n",
        "5.  **Re-ranking:** Using a Cross-Encoder model to re-score and re-order the top results from an initial retrieval step (BM25).\n",
        "\n",
        "We also integrated a retrieval method (BM25) with the Groq LLM to demonstrate a basic **Retrieval Augmented Generation (RAG)** pipeline.\n",
        "\n",
        "We discussed the concepts of:\n",
        "\n",
        "*   **ANN Indexes:** How vector databases efficiently perform similarity search.\n",
        "*   **Chunking Strategies:** The importance of splitting documents effectively.\n",
        "*   **Metadata Filtering:** Using associated data to refine search.\n",
        "*   **Context Window Packing / Contextual Compression:** Optimizing context for LLMs in RAG.\n",
        "\n",
        "### Data and Challenges\n",
        "\n",
        "We used a pre-chunked dataset loaded from `legal_chunks_conceptual.json` and an evaluation dataset from `eval_dataset_conceptual.json`.\n",
        "\n",
        "We encountered several challenges:\n",
        "\n",
        "*   **Qdrant Dependency Issues:** Persistent `TypeError: Cannot instantiate typing.Union` prevented full execution and evaluation of the Dense retrieval and parts of the Hybrid method.\n",
        "*   **Evaluation Dataset Limitation:** The evaluation dataset typically listed only one relevant chunk per query, which limited our ability to comprehensively evaluate Recall and Precision for finding *all* relevant information and impacted the interpretation of the metrics.\n",
        "\n",
        "### Key Findings and Learnings\n",
        "\n",
        "*   **Evaluation Data is Crucial:** The quality and structure of the evaluation dataset significantly impact the insights gained from metrics. A comprehensive ground truth with all relevant chunks is vital for accurate evaluation.\n",
        "*   **BM25 provides a Strong Baseline:** Despite being a simpler method, BM25 consistently found the designated relevant chunks within the top results (good Recall@10) for the evaluated queries.\n",
        "*   **Dense Retrieval Potential and Inconsistency:** Dense retrieval has the potential to capture semantic similarity but showed inconsistent performance on the evaluation dataset, sometimes missing the relevant chunk in the top K.\n",
        "*   **Hybrid Methods Show Promise:** Hybrid RRF demonstrated the value of combining methods, often ranking the relevant chunk highly (good MRR) by leveraging signals from both BM25 and Dense retrieval (though full evaluation was impacted by the Qdrant issue).\n",
        "*   **Re-ranking Improves Precision:** Re-ranking is a necessary step to improve the precision of the top results by re-scoring initially retrieved candidates.\n",
        "*   **Practical Challenges:** Implementing and evaluating retrieval systems in practice involves dealing with dependencies, API access, and data preparation complexities (like chunking and metadata).\n",
        "*   **RAG Integration:** Successfully demonstrating the RAG pipeline shows how retrieval empowers LLMs with domain-specific knowledge.\n",
        "\n",
        "### Conclusion\n",
        "\n",
        "We successfully explored and implemented several core retrieval techniques and demonstrated a RAG pipeline for a legal case research assistant. While challenges with the evaluation environment and data highlighted important practical considerations, we gained valuable insights into the strengths and weaknesses of different methods and the importance of data preparation and evaluation design. This project serves as a solid foundation for further exploration and building more sophisticated retrieval systems."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "da1d5171"
      },
      "source": [
        "**Reasoning**:\n",
        "Provide a comprehensive summary of the project, including the initial goal, the data used, the retrieval techniques implemented (Naive, BM25, Dense, Hybrid, Re-ranking), the evaluation approach and its limitations, the RAG integration, the challenges encountered, and the key takeaways regarding building retrieval systems for domain-specific data."
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "c6f74c01"
      },
      "source": [
        "## Project Summary and Highlights\n",
        "\n",
        "Here is a summary of the project and some highlights you can use for documentation or a resume:\n",
        "\n",
        "**Project Title Suggestion:**\n",
        "\n",
        "*   Legal Case Research Assistant using Retrieval Augmented Generation (RAG)\n",
        "\n",
        "**Key Highlights / Bullet Points for Resume:**\n",
        "\n",
        "*   Developed a Retrieval Augmented Generation (RAG) system to enhance legal case research using a dataset of legal summaries.\n",
        "*   Implemented and evaluated various retrieval techniques, including **BM25 (Sparse Retrieval)**, **Dense Retrieval** using sentence embeddings and a vector database (Qdrant Cloud), and **Hybrid Retrieval (Reciprocal Rank Fusion)**.\n",
        "*   Demonstrated the integration of a retrieval method (BM25) with a Large Language Model (Groq) to generate contextually relevant answers based on retrieved legal documents.\n",
        "*   Analyzed the performance of different retrieval methods using metrics such as **Precision@K, Recall@K, and Mean Reciprocal Rank (MRR)**, identifying strengths and weaknesses of each approach on legal text data.\n",
        "*   Explored advanced retrieval concepts critical for building robust RAG systems, including **Re-ranking** (using Cross-Encoders), **ANN Indexes** (for vector search), **Chunking Strategies**, **Metadata Filtering**, and **Context Optimization** (Context Window Packing/Compression).\n",
        "*   Gained practical experience with tools and libraries such as `qdrant-client`, `sentence-transformers`, `rank_bm25`, and LLM APIs (Groq).\n",
        "*   Managed data preparation complexities, including loading data from JSON and addressing challenges in vector database integration and evaluation setup.\n",
        "\n",
        "**Potential Metrics to Mention (Choose based on best performance/what you want to highlight):**\n",
        "\n",
        "*   If BM25 consistently had good Recall@10: \"Achieved 100% Recall@10 with BM25 retrieval on a custom legal dataset, ensuring relevant documents were consistently found within the top 10 results.\"\n",
        "*   If Hybrid or Dense showed strong MRR for some queries: \"Observed Mean Reciprocal Rank (MRR) up to 1.0000 for Hybrid Retrieval on specific queries, demonstrating the potential for ranking relevant documents at the top.\"\n",
        "*   You could mention the number of documents/chunks processed: \"Processed and indexed [Number of Chunks] legal case summary chunks.\""
      ]
    }
  ]
}